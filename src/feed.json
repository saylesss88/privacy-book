{
  "version": "https://jsonfeed.org/version/1.1",
  "title": "privacy-book",
  "home_page_url": "/",
  "feed_url": "/feed.json",
  "description": "An mdBook-generated site",
  "items": [
    {
      "id": "/android/RethinkDNS_Guide.html",
      "url": "/android/RethinkDNS_Guide.html",
      "title": "RethinkDNS",
      "content_html": "<h1>RethinkDNS</h1>\n<details>\n<summary> ‚úîÔ∏è Click to Expand Table of Contents</summary>\n<!-- toc -->\n</details>\n<p><img src=\"../images/rethinkdns.cleaned.png\" alt=\"RethinkDNS Logo\" /></p>\n<blockquote>\n<p>I‚Äôm not affiliated with RethinkDNS in any way, I‚Äôm just a technologist and\nprivacy advocate.</p>\n</blockquote>\n<h3>üîë Key Terms</h3>\n<details>\n<summary> ‚úîÔ∏è Click to Expand Key Terms </summary>\n<ul>\n<li>\n<p><strong>HTTP</strong> (HyperText Transfer Protocol): The standard protocol used by web\nbrowsers and servers to transfer web pages and related resources over the\ninternet.</p>\n</li>\n<li>\n<p><strong>HTTPS</strong>: HTTP encrypted using TLS is often referred to as HTTPS.\nTLS-encrypted web traffic is by convention exchanged on port 443 by default,\nwhile unencrypted HTTP uses port 80 by default.</p>\n</li>\n<li>\n<p><strong>TLS</strong> (Transport Layer Security) is an encryption protocol and is the\nstandard for enabling two networked applications or devices to exchange\ninformation privately and robustly.</p>\n</li>\n<li>\n<p><strong>Mixed content</strong>: is when an otherwise secure website uses resources fetched\nvia HTTP or other insecure protocols.</p>\n</li>\n<li>\n<p><strong>IP</strong> (Internet Protocol): The address system of the internet that routes\ndata packets from source to destination devices. IP operates at the network\nlayer and does not guarantee delivery order or error checking, which is\nhandled by TCP.</p>\n</li>\n<li>\n<p><strong>IP Address</strong> (Internet Protocol Address): A unique numeric label assigned to\neach device on a network, used to identify and locate the device for\ncommunication.</p>\n</li>\n<li>\n<p><strong>Subnet</strong> (Subnet Range): represents a block of IP addresses grouped together\nunder a single rule. Instead of allowing or blocking individual IP addresses\none by one, you define a subnet to include a wide range of IPs within that\nblock.(Useful for apps that you <code>Isolate</code>).</p>\n</li>\n<li>\n<p><strong>Host</strong>: Any device connected to a network with an IP address, capable of\nsending and receiving data, including computers, phones, or servers.</p>\n</li>\n<li>\n<p><strong>Client</strong>: A device or software (often your computer or phone) that initiates\nrequests to servers to access resources or services, forming the client-server\nmodel of communication.</p>\n</li>\n<li>\n<p><strong>Port</strong>: A port in networking is a virtual communication endpoint managed by\na computer‚Äôs operating system that helps direct network traffic to specific\napps or services. While an IP address identifies a device on a network, ports\nallow the system to know exactly which app or service should handle the\nincoming or outgoing data. Web traffic commonly uses port 80 (HTTP) or 443\n(HTTPS), so when data arrives for those ports, it‚Äôs routed to the web server\napplication on the device. When we block port 80, we block insecure HTTP\nconnections.</p>\n</li>\n<li>\n<p><strong>TCP</strong> (Transmission Control Protocol) is responsible for maintaining a\nconnection through a handshake and putting the packets in the correct order.\nTCP will also ask for missing pieces and is known as a reliable but slow\nprotocol.</p>\n</li>\n<li>\n<p><strong>UDP</strong> (User Datagram Protocol) (UDP/IP): is a fast protocol used across the\ninternet for time-sensitive transmissions such as DNS lookups or VoIP. UDP\nallows a computer to send data straight to another without requiring a\nhandshake.</p>\n</li>\n<li>\n<p><strong>DNS</strong> (Domain Name System): stores domain information in a distributed\ndatabase and translates domain names into IP addresses and vice versa. This\nenables us to only have to remember simple domain names rather than complex IP\naddresses.</p>\n</li>\n</ul>\n<blockquote>\n<p>Domain Name</p>\n<pre><code class=\"language-text\">ssd.eff.org\n |   |   |\n |   |  top-level domain\n |   |\n |   second-level domain\n |\nsubdomain\n</code></pre>\n<p>‚òùÔ∏è The hierarchy is read from right to left, the TLD is the highest-level\ndomain (<code>.org</code> here), the second-level domain (<code>eff</code>) is directly to the left\nof the TLD, and anything further left (like <code>ssd</code>) is a subdomain under that\nsecond-level domain.</p>\n</blockquote>\n<ul>\n<li>\n<p><strong>DNS Server</strong>: When you search for a domain name (rethinkdns.com) it triggers\na DNS lookup. Several different types of DNS servers typically work together\nto complete a single DNS lookup.</p>\n</li>\n<li>\n<p><strong>DNS Resolver</strong>: is a server or software component that translates domain\nnames into IP addresses that devices use to communicate.</p>\n</li>\n<li>\n<p><strong>Unicast DNS</strong>: The traditional DNS setup where each DNS server is assigned a\nunique, single IP address. DNS queries from clients are directed to this\nspecific server regardless of the clients location.</p>\n</li>\n<li>\n<p><strong>Anycast DNS</strong>: Anycast allows a single IP address to be used by multiple\nservers. In Anycast DNS, a DNS query can be answered by any one of several DNS\nservers, usually the one closest to the user by geographic or network\nproximity. This setup reduces latency, increases the availability of DNS\nresolution services, and offers protection against DNS flood DDoS attacks by\ndistributing traffic across multiple servers.</p>\n</li>\n<li>\n<p><strong>Recursive resolver</strong> (DNS recursor): is typically the first stop in the\nseries of the above servers.</p>\n</li>\n<li>\n<p><strong>Iterative resolver</strong>: In an iterative DNS query, each DNS server responds\ndirectly to the client with a referral to another server, and the client\ncontinues querying successive servers until it receives the IP address for the\nrequested domain.</p>\n</li>\n<li>\n<p><strong>Proxy</strong>: A proxy, in relation to Orbot with Rethink, is an intermediary\nservice that routes internet traffic from your device through the Tor network\nto provide privacy and anonymity.</p>\n</li>\n<li>\n<p><strong>HTTP(S) Proxy</strong>: An HTTP proxy is an intermediary server that forwards\nHTTP/HTTPS web traffic from a client (e.g., a browser or app) to destination\nservers, allowing for privacy, filtering, or routing control while masking the\nuser‚Äôs IP. HTTP proxies only work with web traffic (HTTP/HTTPS).</p>\n</li>\n<li>\n<p><strong>SOCKS5</strong> (Socket Secure 5): Is an internet proxy protocol that transfers\ninfo from one server to another while redirecting the user‚Äôs IP address. It\nsupports both UDP and TCP and can actually improve speed in some cases.</p>\n</li>\n<li>\n<p><a href=\"https://github.com/pi-hole/pi-hole\">pi-hole</a>: a DNS sinkhole that protects\nyour devices content without installing any client-side software.</p>\n</li>\n<li>\n<p><a href=\"https://github.com/evilsocket/opensnitch\">OpenSnitch</a>: is a GNU/Linux\napplication firewall.</p>\n</li>\n<li>\n<p><em>proxifier</em>: a proxifier acts as a proxy client, routing specific application\ntraffic through proxy servers without encrypting data or providing global IP\nmasking.</p>\n</li>\n<li>\n<p><em>VPN</em> (Virtual Private Network): a VPN creates an encrypted tunnel that routes\nall network traffic from your device through a remote server, masking your IP\naddress and securing your entire connection.</p>\n</li>\n<li>\n<p>WireGuard: a modern VPN encryption protocol, its fast and has gained\nwidespread adoption among VPN providers.</p>\n</li>\n<li>\n<p>OpenVPN: an older, more mature VPN protocol that uses SSL/TLS for encryption.\nIt‚Äôs known for being very reliable and highly configurable but tends to be\nslower and more complex than WireGuard. Good VPNs often give you the choice\nbetween protocols.</p>\n</li>\n<li>\n<p><code>Bypass DNS and Firewall</code>: Bypass the DNS and Firewall for this app, <strong>this\nonly works with Rethink‚Äôs DNS</strong>.</p>\n</li>\n<li>\n<p><code>Bypass Universal</code>: Bypass the Universal firewall for this app.</p>\n</li>\n<li>\n<p><code>Exclude</code>: The app is excluded from the dns and firewall, Rethink is unaware\nof this app.</p>\n</li>\n<li>\n<p><code>Isolate</code>: When an app is isolated, only trusted IPs are allowed. (i.e., IPs\nor domains you explicitly set trust rules for).</p>\n</li>\n<li>\n<p>üõú(Unmetered Wi-Fi): Wi-Fi settings, either blocked or allowed.</p>\n</li>\n<li>\n<p>üì∂ (Metered mobile): Mobile data settings, either blocked or allowed.</p>\n</li>\n</ul>\n</details>\n<hr />\n<h2><a href=\"#rethinkdns-overview\">RethinkDNS Overview</a></h2>\n<ul>\n<li>\n<p><code>Bypass DNS and Firewall</code>: Bypass the DNS and Firewall for this app, <strong>this\nonly works with Rethink‚Äôs DNS</strong>.</p>\n</li>\n<li>\n<p><code>Bypass Universal</code>: Bypass the Universal firewall for this app.</p>\n</li>\n<li>\n<p><code>Exclude</code>: The app is excluded from the dns and firewall, Rethink is unaware\nof this app.</p>\n</li>\n<li>\n<p><code>Isolate</code>: When an app is isolated, only trusted IPs are allowed. (i.e., IPs\nor domains you explicitly set trust rules for).</p>\n</li>\n<li>\n<p>üõú(Unmetered Wi-Fi): Wi-Fi settings, either blocked or allowed.</p>\n</li>\n<li>\n<p>üì∂ (Metered mobile): Mobile data settings, either blocked or allowed.</p>\n</li>\n</ul>\n<p>The DNS mode routes all DNS traffic generated by all apps to <strong>any</strong> user chosen\nDNS-over-HTTPS, DNS-over-TLS, DNSCrypt, or Oblivious DNS-over-HTTPS resolver.</p>\n<p>Firewalls like Rethink that block both UDP and TCP connections are usually\nsufficient because nearly all applications rely on these two protocols for their\nnetworking and communication. Almost every app communicates over TCP or UDP, so\nblocking these protocols effectively restricts most network traffic from and to\napps, preventing them from connecting without permission.</p>\n<p>I will share how I use RethinkDNS, obviously feel free to make changes based on\nyour threat model and needs.</p>\n<p>Different versions of the RethinkDNS have different features and capabilities.\nThe best version in my opinion is the F-Droid version.</p>\n<ul>\n<li><a href=\"https://f-droid.org/en/\">F-Droid Download</a></li>\n</ul>\n<hr />\n<h2>Getting Started</h2>\n<h3>DNS</h3>\n<p>I was surprised to see that GrapheneOS recommends that people use their own\n‚Äúnetwork provided DNS servers for general purpose usage‚Äù (i.e., Your ISPs DNS).\nThey say that ‚Äúusing the network-provided DNS servers is the best way to blend\nin with other users‚Äù. Network and web sites can fingerprint and track users\nbased on non-default DNS configurations.\n‚Äì<a href=\"https://grapheneos.org/faq#default-dns\">grapheneos default-dns</a></p>\n<p>Given that it is a fact that many ISPs are known to share this data and do other\nprivacy disrespecting things, I would personally rather make it harder for them.\nI included this because they are the experts and the choice is yours, I use a\ncustom DNS myself. I guess since so many people virtue-signal saying that they\n‚Äúhave nothing to hide‚Äù(a reckless, privileged notion) that not many people truly\ncare about privacy and are likely using the default. The more people that we can\nconvince to use privacy respecting tools, the better it is for everybody.</p>\n<p>Recommended Resolvers:</p>\n<details>\n<summary> ‚úîÔ∏è Click to Expand recommended resolvers </summary>\n<p>These are just the providers I‚Äôve researched personally and not in a specific\norder. It‚Äôs recommended to regularly test and switch between DNS providers as\nlocation and network conditions play a factor. There are DNS benchmarking tools\navailable to either download or use in-browser.</p>\n<p>A few examples:</p>\n<ul>\n<li>\n<p><a href=\"https://dnsspeedtest.online/\">https://dnsspeedtest.online/</a></p>\n</li>\n<li>\n<p><a href=\"https://www.grc.com/dns/benchmark.htm\">https://www.grc.com/dns/benchmark.htm</a></p>\n</li>\n</ul>\n<hr />\n<ul>\n<li>\n<p><strong>Quad9</strong> is known to enforce strong standards in cryptography and was the\nfirst to use DNSSEC cryptographic validation.</p>\n<ul>\n<li><a href=\"https://quad9.net/privacy/policy/\">Quad9 privacy policy</a></li>\n</ul>\n</li>\n<li>\n<p>Mullvad DNS</p>\n<ul>\n<li><a href=\"https://mullvad.net/en/help/privacy-policy\">Mullvad privacy policy</a></li>\n</ul>\n</li>\n<li>\n<p>NextDNS</p>\n<ul>\n<li><a href=\"https://nextdns.io/privacy\">NextDNS privacy policy</a></li>\n</ul>\n</li>\n<li>\n<p>Cloudflare publishes regular transparency reports and undergoes independent\naudits and have a great blog explaining the technology which is a major plus.\nGrapheneOS sets Cloudflare as the fallback due to their good privacy policy,\nand widespread usage.</p>\n<ul>\n<li><a href=\"https://www.cloudflare.com/privacypolicy/\">Cloudflare Privacy Policy</a></li>\n</ul>\n</li>\n<li>\n<p>RethinkDNS: Their DNS code is open source so anyone can audit it themselves.\nThey do not collect PII nor seek to profile its users, transparency is great.</p>\n<ul>\n<li><a href=\"https://rethinkdns.com/privacy\">DNS Privacy Policy for stub resolvers</a></li>\n<li><a href=\"https://fly.io/legal/privacy-policy/\">Fly.io privacy policy for the recursive resolver</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"https://www.privacyguides.org/en/dns/\">PrivacyGuides DNS Recommendations</a></p>\n</li>\n</ul>\n</details>\n<p>Throughout this article, I‚Äôll be discussing the <strong>RethinkDNS Android App</strong>.\nWe‚Äôll later reference the <strong>DNS Blocklist configuring website</strong>, which is\navailable at <a href=\"https://rethinkdns.com/configure\">rethinkdns.com/configure</a>.</p>\n<blockquote>\n<p>‚ùó NOTE: When you switch to an encrypted DNS resolver, you are shifting your\ntrust from your ISP‚Äôs DNS servers to the third-party DNS provider you choose.\nEncryption protects your DNS queries from being seen or intercepted by\noutsiders, like your ISP or network eavesdroppers, which improves privacy.\nHowever, the DNS resolver itself still sees all your queries and could\npotentially log, analyze, or misuse that data.</p>\n</blockquote>\n<p>That said, it‚Äôs quite common for ISPs to engage in practices that compromise\nuser privacy. Do some research, whats their business model, privacy policy, etc.\nUnfortunately, with a VPN you are also just shifting the trust. Don‚Äôt blindly\nchoose a VPN either.</p>\n<ul>\n<li><a href=\"https://cyberinsider.com/internet-service-providers-isp-privacy-data-collection/\">ISP data-collection</a></li>\n</ul>\n<p><code>Configure -&gt; DNS -&gt; Other DNS</code>:</p>\n<ul>\n<li>\n<p>Choose the type of resolver you want, I use DNSCrypt. Once you click you can\nchoose the specific resolver you want such as Quad9. You may notice that it\nsays <code>Failed: using fallback DNS</code>. This is only because we haven‚Äôt turned it\non yet, we will recheck this once we turn it on.</p>\n</li>\n<li>\n<p>If you want a relay in a specific country, you can click the <code>Relays</code> tab. For\nDNSCrypt you are given the choice between the Netherlands, France, Sweden, Los\nAngeles, and Singapore. You might do this if you were trying to circumvent\ncensorship.</p>\n</li>\n</ul>\n<p><strong>Rules</strong> set the following:</p>\n<ul>\n<li>\n<p><code>Advanced DNS filtering (experimental)</code>: Assign unique IP per DNS request.</p>\n</li>\n<li>\n<p><code>Prompt on blocklist updates</code>: This is for if you use Rethink‚Äôs custom\nblocklists.</p>\n</li>\n<li>\n<p><code>Prevent DNS leaks</code>: When enabled, Rethink captures all packets on port 53 and\nforwards it to a user-set DNS endpoint.</p>\n</li>\n</ul>\n<p>Leave all the <code>Advanced</code> defaults unless you plan on setting up a SOCKS5 proxy,\nin which case you will want to enable <code>Configure -&gt; DNS -&gt; Never proxy DNS</code>.</p>\n<hr />\n<p>F-Droid Specific:</p>\n<ul>\n<li>\n<p><code>Split DNS (experimental)</code>: Forward DNS queries from proxied apps to the\nproxy‚Äôs DNS servers.</p>\n</li>\n<li>\n<p><code>Treat DNS rules as firewall rules (experimental)</code>: DNS blocking will be\nbypassed during resolution; the decision will be made at connection time.</p>\n</li>\n<li>\n<p>Set <code>Use fallback DNS as bypass</code>: where it always uses your fallback DNS for\nbypassed apps, domains and IPs.</p>\n</li>\n<li>\n<p>You can also set <code>Use System DNS for undelgated domains</code> which is generally\nsafe to enable and useful if access to local network devices or custom\ninternal domains is needed.</p>\n</li>\n</ul>\n<hr />\n<p><strong>Blocklists</strong>:</p>\n<p>This is a cool feature, similar to NextDNS if I understand correctly. Since it‚Äôs\na system-wide DNS filter it applys to any app that is run through Rethink, not\nonly your browser, <strong>every app</strong>.</p>\n<p>Blocklists are available when you use Rethink‚Äôs DNS.</p>\n<p><code>Configure -&gt; DNS -&gt; Rethink DNS</code>:</p>\n<ul>\n<li>\n<p>Choose between <code>Sky</code> with higher uptime and a stub resolver at cloudflare.com,\nOR <code>Max</code> which is more private and has its recursive resolver at fly.io.</p>\n</li>\n<li>\n<p>Choose between the preconfigured blocklists, OR Click <code>RDNS Plus</code>, <code>EDIT</code>,\n<code>ADVANCED</code>, Search blocklists: <code>hagezi</code>, <code>Multi Pro++ (HaGeZi)</code>,\n<code>APPLY (RDNS PLUS)</code></p>\n</li>\n<li>\n<p>You can manually Check for an update to the blocklists, which you should\nbecause they are updated regularly with new identified threats. You can also\nenable <code>Prompt on blocklist update</code>.</p>\n</li>\n<li>\n<p><a href=\"https://github.com/hagezi/dns-blocklists/wiki/FAQ#sources\">hagezi which version should I use?</a></p>\n</li>\n<li>\n<p><a href=\"https://oisd.nl/\">oisd</a></p>\n</li>\n</ul>\n<hr />\n<p><strong>F-Droid &amp; Github Versions</strong></p>\n<p>When on the F-Droid and GitHub versions of the Rethink, you can download\nblocklists from <code>Configure -&gt; DNS -&gt; On-device blocklists</code>, and have them setup\nfor <strong>any</strong> DNS upstream.</p>\n<p>There is a known bug where it sometimes when you click <code>DOWNLOAD BLOCKLISTS</code> it\njust keeps listening and never receives anything. The GitHub <code>v05.5n</code> was\naffected by this.</p>\n<p>This <strong>does work</strong> on the F-Droid version.</p>\n<p>For example, if you want to use ODoH with the HAGEZI Blocklist you could:</p>\n<p>Go to <code>Configure -&gt; DNS -&gt; Other DNS</code>, Choose <code>ODoH</code> with <code>Cloudflare</code>. Start\nit.</p>\n<p>Now in <code>Configure -&gt; DNS -&gt; RULES</code>, tap <code>On-device blocklists</code>, and click the\ndisabled logo, then click <code>DOWNLOAD BLOCKLISTS</code>. Once the download is complete,\nyou can select <code>Configure</code> and select <code>ADVANCED</code> and search for HAGEZI, choose\nMULTI PRO++ and maybe oisd small, then press <code>APPLY (ON-DEVICE)</code>.</p>\n<p>Now any app that doesn‚Äôt bypass Rethink will use your chosen blocklists, denying\naccess to malicious URLs.</p>\n<p>The HAGEZI blocklists are respected for being updated frequently. There are\ndifferent levels with MULTI PRO++ (HAGEZI) being the highest and 4 other lest\nstrict levels.</p>\n<hr />\n<h3>Network</h3>\n<p>Settings explained:</p>\n<ul>\n<li>\n<p><strong>Loopback proxy forwarder apps</strong>: Enable when you want all of your devices\nproxy-related traffic to also flow through Rethinks encrypted tunnel. It\nensures apps that proxy DNS/HTTP/SOCKS traffic don‚Äôt leak outside the VPN.</p>\n</li>\n<li>\n<p><strong>Do not route Private IPs</strong>: Prevents routing traffic destined for private IP\naddress ranges (like 192.168.x.x, 10.x.x.x) through the tunnel. Instead, this\ntraffic goes directly over the local network or system default route. Most\nuseful when you want devices on your local network (NAS, printers, etc.) to be\nreachable by apps on your phone without routing the traffic through Rethinks\ntunnel, improving performance and reliability of local connections but\npossibly reducing privacy.</p>\n</li>\n<li>\n<p><strong>Loopback (experimental)</strong>: When enabled, this routes RethinkDNS‚Äôs own\ninternal traffic, such as blocklist downloads, connectivity checks, and DNS\nqueries made by the app itself, back into the encrypted tunnel through the\nloopback device.</p>\n</li>\n</ul>\n<table><thead><tr><th>Setting</th><th>Function</th><th>When to Use</th></tr></thead><tbody>\n<tr><td>Loopback Proxy Forwarder Apps</td><td>Route proxy-forwarder app traffic back into Rethink VPN tunnel</td><td>When you want consistent VPN/privacy coverage for proxies</td></tr>\n<tr><td>Do Not Route Private IPs</td><td>Avoid routing local network/private IP traffic through VPN (send directly)</td><td>To access local devices without VPN bottlenecks</td></tr>\n<tr><td>Loopback (Experimental)</td><td>Route Rethink‚Äôs own app traffic (updates/checks) back through VPN tunnel</td><td>To fully protect app‚Äôs own DNS/blocklist traffic</td></tr>\n</tbody></table>\n<p>NOTE: The above settings are disabled by default because some are experimental\nand can easily break functionality. I have found that the settings below give\nthe most functionality without breakage üëáÔ∏è:</p>\n<p><code>Configure -&gt; Network</code>:</p>\n<ul>\n<li>\n<p>Set <code>Use all available networks</code> to ON. This enables Wifi and mobile data to\nbe used at the same time by Rethink. (Optional, may use more battery)</p>\n</li>\n<li>\n<p><strong>Set your IP version</strong>: The default is <code>IPv4</code>, you can choose between\n<code>IPv6 (experimental)</code> and <code>Auto (experimental)</code>.</p>\n</li>\n<li>\n<p><strong>Choose fallback DNS</strong>: When your user-preferred DNS is not reachable,\nfallback DNS will used.</p>\n<ul>\n<li>With the F-Droid version in <code>Configure -&gt; DNS -&gt; ADVANCED</code>. You can enable\n<code>Use fallback DNS as bypass</code>, which always uses fallback DNS for bypassed\napps, domains, and IPs.</li>\n</ul>\n</li>\n<li>\n<p>I personally disable <code>Enable network visibility</code>, just keep in mind that some\napps may break.</p>\n<ul>\n<li>‚ÄúShutting this off prevents apps from accessing all available networks,\nstopping them from bypassing Rethinks tunnel‚Äù. This caused issues with the\nbrowser when turned off.(Some audio/video conference apps like Zoom and Meet\nrequire this)</li>\n</ul>\n</li>\n</ul>\n<hr />\n<h3>Firewall</h3>\n<p><code>Configure -&gt; Firewall -&gt; Universal firewall rules</code> and set the following to ON:</p>\n<ul>\n<li>\n<p><code>Block all apps when device is locked</code></p>\n</li>\n<li>\n<p><code>Block when DNS is bypassed</code></p>\n</li>\n<li>\n<p><code>Block port 80 (insecure HTTP) traffic</code></p>\n</li>\n</ul>\n<p>You can get more restrictive from here, but it will take some manual\nintervention to get everything working correctly.</p>\n<p>Keep your firewall rules in mind when you‚Äôre configuring per app settings. If\nthe Universal firewall blocks all apps when the device is locked, do you want\nthis app affected by this or do you want to let it Bypass the Universal\nfirewall?</p>\n<hr />\n<h2>Turn ON DNS and Firewall</h2>\n<p><code>Home</code> üè†:</p>\n<ul>\n<li>Click the big <code>Start</code> button on the bottom of the screen and leave it set to\nthe default <code>DNS and Firewall (default)</code></li>\n</ul>\n<p>Now that we‚Äôve started the DNS and Firewall, we can go back to\n<code>Configure -&gt; DNS</code> and ensure the provider we chose started successfully. You\ncan also experiment with different types of resolvers, make sure to wait for\nbelow the chosen resolver to say <code>Connected</code>.</p>\n<p>Now, all apps on your device by default allow both Wi-Fi and mobile data access\n<strong>through the RethinkDNS encrypted tunnel</strong>. Try some of your most used Apps to\nsee if they function correctly.</p>\n<p>RethinkDNS‚Äôs firewall blocks or restricts any network traffic that isn‚Äôt\nexplicitly allowed. Although by default all apps are allowed network access,\nsome apps require special permissions or bypasses due to their network behavior.\nMany apps rely on multiple external services, backend APIs, etc. that may be\nblocked by the firewall.</p>\n<hr />\n<h3>Apps that Don‚Äôt work</h3>\n<p>I will use Reddit as an example, the process is the same for any app. Reddit‚Äôs\napp and website rely on multiple third-party services and external domains\nbeyond just <code>reddit.com</code> itself.</p>\n<p>For apps that don‚Äôt work it‚Äôs important to ensure that your Android systems\n<code>Private DNS</code> is set to <code>Automatic</code>.</p>\n<p><code>Home -&gt; Apps</code>:</p>\n<p>Search for <code>Reddit</code>, click on it and the Firewall Rules For Reddit will pop up.\nSince it is already allowed <code>Unmetered</code> and <code>Metered</code> connections and still\ndoesn‚Äôt work, we can try one setting at a time until it does work and this is\nthe same process for other Apps that aren‚Äôt working.</p>\n<ul>\n<li>\n<p>First, you should check your logs and see why it‚Äôs being blocked. Look at the\ndomains involved and set trust rules for said domains. (start by trusting\nreddit.com). Check the logs again, add any domains that were blocked related\nto reddit. If it is unclear why networking still isn‚Äôt working, you can:</p>\n</li>\n<li>\n<p><code>Bypass Universal</code>, this allows it to bypass any Universal Firewall rules you\nhave set.</p>\n</li>\n<li>\n<p>If you‚Äôre using Rethink‚Äôs DNS, you can try allowing the app to\n<code>Bypass DNS &amp; Firewall</code>. Try the app again, does it work? If not:</p>\n</li>\n<li>\n<p>You can also <code>Isolate</code> an App, you then have to set up <em>trust | allow</em> rules\nfor domains or IPs over a period of time which can take a while. You can go to\n<code>Apps</code> and search for the app in question, click on it and at the bottom of\nthe screen you‚Äôll see <code>IP Logs</code>, and <code>Domain Logs</code> to help with this.</p>\n</li>\n<li>\n<p><code>Exclude</code> the app. This makes RethinkDNS completely unaware of the app and is\noften what is required for Reddit. It is my understanding that after you\n<code>Exclude</code> Reddit for example, your systems Automatic Secure DNS will pick it\nup.</p>\n</li>\n</ul>\n<hr />\n<h3>Other Methods</h3>\n<p>Rather than watching the logs and setting trust rules over time, you could use\ntools like <code>nslookup</code> and <code>dig</code> to resolve said domain and reveal IP ranges\nused.</p>\n<pre><code class=\"language-bash\">nslookup reddit.com\nServer:         127.0.0.1\nAddress:        127.0.0.1#53\n\nNon-authoritative answer:\nName:   reddit.com\nAddress: 151.101.129.140\nName:   reddit.com\nAddress: 151.101.193.140\nName:   reddit.com\nAddress: 151.101.1.140\nName:   reddit.com\nAddress: 151.101.65.140\nName:   reddit.com\nAddress: 2a04:4e42::396\nName:   reddit.com\nAddress: 2a04:4e42:600::396\nName:   reddit.com\nAddress: 2a04:4e42:200::396\nName:   reddit.com\nAddress: 2a04:4e42:400::396\n</code></pre>\n<p>Resolving a domain (like <code>reddit.com</code>) using tools like <code>nslookup</code> or <code>dig</code>\nreveals multiple IPs because large services use multiple servers across CDNs and\nnetworks for redundancy and performance.</p>\n<p>You can then run <code>whois</code> on one of those IPs (e.g., <code>whois 151.101.129.140</code>) to\nidentify the subnet ranges owned by Reddit‚Äôs CDN provider (Fastly in this case),\nwhich helps when setting up subnet range allow rules in Rethink.</p>\n<details>\n<summary> ‚úîÔ∏è Click to Expand `whois` Example Output </summary>\n<pre><code class=\"language-bash\">whois 151.101.129.140\n\n#\n# ARIN WHOIS data and services are subject to the Terms of Use\n# available at: https://www.arin.net/resources/registry/whois/tou/\n#\n# If you see inaccuracies in the results, please report at\n# https://www.arin.net/resources/registry/whois/inaccuracy_reporting/\n#\n# Copyright 1997-2025, American Registry for Internet Numbers, Ltd.\n#\n\n\nNetRange:       151.101.0.0 - 151.101.255.255\nCIDR:           151.101.0.0/16\nNetName:        SKYCA-3\nNetHandle:      NET-151-101-0-0-1\nParent:         RIPE-ERX-151 (NET-151-0-0-0-0)\nNetType:        Direct Allocation\nOriginAS:\nOrganization:   Fastly, Inc. (SKYCA-3)\nRegDate:        2016-02-01\nUpdated:        2021-12-14\nRef:            https://rdap.arin.net/registry/ip/151.101.0.0\n\n\nOrgName:        Fastly, Inc.\nOrgId:          SKYCA-3\nAddress:        PO Box 78266\nCity:           San Francisco\nStateProv:      CA\nPostalCode:     94107\nCountry:        US\nRegDate:        2011-09-16\nUpdated:        2025-03-25\nRef:            https://rdap.arin.net/registry/entity/SKYCA-3\n\n\nOrgNOCHandle: FNO19-ARIN\nOrgNOCName:   Fastly Network Operations\nOrgNOCPhone:  +1-415-404-9374\nOrgNOCEmail:  noc@fastly.com\nOrgNOCRef:    https://rdap.arin.net/registry/entity/FNO19-ARIN\n\nOrgTechHandle: FRA19-ARIN\nOrgTechName:   Fastly RIR Administrator\nOrgTechPhone:  +1-415-518-9103\nOrgTechEmail:  rir-admin@fastly.com\nOrgTechRef:    https://rdap.arin.net/registry/entity/FRA19-ARIN\n\nOrgAbuseHandle: ABUSE4771-ARIN\nOrgAbuseName:   Abuse Account\nOrgAbusePhone:  +1-415-496-9353\nOrgAbuseEmail:  abuse@fastly.com\nOrgAbuseRef:    https://rdap.arin.net/registry/entity/ABUSE4771-ARIN\n\n\n#\n# ARIN WHOIS data and services are subject to the Terms of Use\n# available at: https://www.arin.net/resources/registry/whois/tou/\n#\n# If you see inaccuracies in the results, please report at\n# https://www.arin.net/resources/registry/whois/inaccuracy_reporting/\n#\n# Copyright 1997-2025, American Registry for Internet Numbers, Ltd.\n</code></pre>\n<blockquote>\n<p>‚ö†Ô∏è Use caution when setting trust rules for subnet ranges, as this grants\naccess to all services hosted within that range, potentially including\nservices unrelated to the one you intend to access. Best practice is to first\nattempt to trust the specific domain name (e.g., reddit.com), which is\ngenerally the most granular and secure method. Only consider trusting broader\nsubnet ranges (like 151.101.0.0/16) as a last resort if domain-based rules\nfail to resolve connectivity issues for the intended service.</p>\n</blockquote>\n<p>We can see that:</p>\n<ul>\n<li>The subnet range for that IP: <code>151.101.0.0 - 151.101.255.255</code> (CIDR notation:\n<code>151.101.0.0/16</code>)</li>\n</ul>\n<p>So as a starting point to get Reddit working we could trust the following subnet\nrange:</p>\n<ul>\n<li>\n<p>IPv4: <code>151.101.0.0/16</code></p>\n</li>\n<li>\n<p>This subnet covers the full range from <code>151.101.0.0</code> to <code>151.101.255.255</code>,\nwhich includes all related IPs Reddit uses via Fastly‚Äôs CDN.</p>\n</li>\n<li>\n<p>The owning organization: <code>Fastly, Inc.</code> &amp; More‚Ä¶</p>\n</li>\n</ul>\n</details>\n<hr />\n<h3>Firefox Encrypted DNS through Rethink</h3>\n<p>First, make sure you can visit a few sites in Firefox. If you can, then your\nbrowser traffic should be routed through the Rethink tunnel, we will check here.\nIf you can‚Äôt, go to <code>Home -&gt; Apps</code> and search for Firefox, is networking\nenabled?</p>\n<p><strong>RethinkDNS Settings</strong></p>\n<p>For the best experience routing your browser traffic through your custom\nendpoint (e.g., DNSCrypt) on both Wi-Fi and mobile data ensure the following are\nset:</p>\n<ul>\n<li>Do not turn on <code>Block any app not in use</code> in the Universal firewall. After\nsome Log digging, I found that this causes the browser to fail more often than\nnot.</li>\n<li><code>Configure -&gt; Network -&gt; Enable network visibility</code> set to ON. I had\nexperimented with turning this off and certain websites wouldn‚Äôt load when on\nWi-Fi and none would load on mobile data. Turning it back on seemed to fix\nboth with no leaks detected.</li>\n</ul>\n<p>Double check that in Rethink‚Äôs <code>Configure -&gt; DNS -&gt; Prevent DNS leaks</code> is ON, as\nwell as the Universal Firewalls <code>Block when DNS is bypassed</code> ON.</p>\n<hr />\n<p><strong>Firefox Settings</strong></p>\n<blockquote>\n<p>In Firefox, plug <code>about:config</code> into the URL bar and scroll down to\n<code>network.trr.mode</code> and change its value to <code>3</code> to prevent leaking DNS queries\nto the System resolver. Also in <code>about:config</code> scroll down to\n<code>media.peerconnection.enabled</code>, double-click to set it to false to prevent\nWebRTC leaks.</p>\n</blockquote>\n<p>IronFox no longer lets you adjust the <code>network.trr.mode</code> in <code>about:config</code>, you\nadjust the <code>trr.mode</code> through the DNS over HTTPS settings. Set it to\n<code>Default Protection</code> or <code>OFF</code> and check for dns leaks. Fennec also has issues\nwith setting <code>network.trr.mode 3</code> and falls back to insecure methods. I would\nsuggest using the built in DNS over HTTPS for Fennec on max protection.</p>\n<ul>\n<li>The trade-off is that disabling WebRTC also disables any websites or apps\nusing WebRTC for real-time communication (like video calls or chat functions)\nfrom working correctly.\n<a href=\"https://en.wikipedia.org/wiki/WebRTC\">Wikipedia WebRTC</a></li>\n</ul>\n<p>In Firefox <code>Settings -&gt; Privacy &amp; Security</code>, set <code>DNS over HTTPS</code> to\n<code>Default Protection</code> or <code>OFF</code>, this enables Firefox to use RethinkDNS‚Äôs DNSCrypt\nresolver or whatever you chose.</p>\n<hr />\n<p><strong>Checking for DNS Leaks</strong></p>\n<p>Go to:</p>\n<pre><code class=\"language-text\">https://dnsleaktest.com\n</code></pre>\n<p>Also crosscheck with:</p>\n<pre><code class=\"language-text\">https://ipleak.net\n</code></pre>\n<p><code>ipleak.net</code> may show many more servers but as long as they are all related to\nyour resolver (i.e., WoodyNet for Quad9) you are not leaking to your ISP or\nother third-parties.</p>\n<p>For DNSCrypt with Quad9 Security, <code>dnsleaktest</code> found 5 servers all with the ISP\n<code>WoodyNet</code> indicating success through Quad9. Quad9 relies on Packet Clearing\nHouse, that‚Äôs where the <code>WoodyNet</code> name comes from.</p>\n<p>When on mobile data, when going to <code>https://dnsleaktest.com</code> the results may\nshow more servers. As long as they are all the same ISP you‚Äôre good.</p>\n<p>A different solution could be to experiment with more strict RethinkDNS settings\nand just use the browsers built-in DNS over HTTPS on max protection. Having more\nstrict defaults for Rethink with all of your apps and configuring your browser\nseparate may be a better option, the choice is yours.</p>\n<p>When hunting down a solution you can go to <code>Configure -&gt; Logs</code>, then try to\nvisit the site that wouldn‚Äôt work while watching the logs. You should see\n<code>Firefox</code> pop up, click it, in the top right of the pop up should be the reason\nit was blocked.</p>\n<ul>\n<li><a href=\"https://privacytests.org/\">PrivacyTests.org</a>, tests different browsers in\ndifferent privacy categories.</li>\n</ul>\n<hr />\n<h3><a href=\"#duckduckgo\">DuckDuckGo</a></h3>\n<p>I also tested DuckDuckGo with its stock configuration and <code>dnsleaktest.com</code>\nshowed that DDGs traffic was successfully tunneled through Rethink to Quad9s‚Äô\nservers.</p>\n<p><code>dnsleaktest.com</code> showed all <code>WoodyNet</code> ISPs indicating success.</p>\n<hr />\n<h4><a href=\"#chromium-based-browsers-brave\">Chromium Based Browsers (Brave)</a></h4>\n<p>For Brave, if you want your DNS routed through Rethink you have to turn\n<code>Use secure DNS</code> off.</p>\n<p>I also had to set Brave to <em>Bypass Universal</em></p>\n<blockquote>\n<p>NOTE: Brave has been known to have some spyware in the past, though most of it\ncan be opted out of.</p>\n</blockquote>\n<hr />\n<h3><a href=\"#more-fine-grained-control--enhanced-privacy\">More Fine Grained Control &amp; Enhanced Privacy</a></h3>\n<p>In this section we will switch from a default allow to a default deny; blocking\nnetwork access to every app. We will then go through and only enable networking\nfor the apps that we need and trust.</p>\n<details>\n<summary> ‚úîÔ∏è Click to Expand Android Privacy Tips for the paranoid </summary>\n<p>If you don‚Äôt like the idea of someone forcing you to unlock your phone so they\ncan sift through your data:</p>\n<ul>\n<li>\n<p>It‚Äôs often recommended to <strong>not</strong> use biometrics as they can be forcibly be\ntaken from you while a password typically can‚Äôt.</p>\n</li>\n<li>\n<p><a href=\"https://en.wikipedia.org/wiki/Cellebrite\">Cellebrite</a> relies on your phone\nbeing in AFU mode which is After first unlock.</p>\n</li>\n</ul>\n<p><strong>BFU</strong>: Before First Unlock. This refers to the state right after a device\nrestarts. Since you haven‚Äôt entered your password yet, the system has not\nunlocked the phone‚Äôs storage, so its contents remain encrypted.</p>\n<p><strong>AFU</strong>: After First Unlock. In this state, the device has been unlocked at\nleast once since it was powered on, even if it is currently locked. The\nencryption keys are loaded into RAM, making the device‚Äôs stored data more\naccessible and increasing the potential attack surface compared to the BFU\nstate.</p>\n<ul>\n<li>\n<p>Set the Auto optimization (Auto Restart) to the shortest amount of time\npossible. When your phone first reboots it is in BFU mode which is Before\nfirst unlock mode. Biometrics are usually disabled in this mode and the\nencryption keys are <strong>not</strong> saved in RAM making the attack surface much\nsmaller.(i.e., they typically have to guess the password or brute-force it)</p>\n<ul>\n<li>That said, if someone gets your phone while it‚Äôs in AFU mode they will only\nhave the amount of time until your next auto reboot to try to extract your\ndata.</li>\n</ul>\n</li>\n<li>\n<p>You can also try to reduce the number of unlock attempts before the device\nwipes. The default is typically 20 attempts, I haven‚Äôt found a way to lower\nthis.</p>\n</li>\n<li>\n<p>You can‚Äôt really trust Airplane mode on anything but GrapheneOS. If you are\nable to remove your battery, do that when it matters.</p>\n</li>\n<li>\n<p>In your <code>About phone</code> section, name your device something that doesn‚Äôt expose\nanything useful about yourself.</p>\n</li>\n<li>\n<p>Set a pin for your phones sim card to prevent sim swaps.</p>\n</li>\n<li>\n<p>Consider something like mint mobile or visible, they often let you register\nwith only a spoofed email address.</p>\n</li>\n</ul>\n<p>Bluetooth is inherently insecure and broadcasts information about your device\nconstantly. Walmart and other stores have started using Bluetooth to see hot\nzones to strategically place adds on the most traveled areas.</p>\n<ul>\n<li>\n<p><a href=\"https://www.edgescan.com/bluetooth-and-the-invisible-security-threat-youre-probably-not-listening-to/\">Bluetooth the invisible threat</a></p>\n</li>\n<li>\n<p><a href=\"https://www.forbes.com/sites/alexvakulov/2025/02/20/11-types-of-bluetooth-attacks-and-how-to-protect-your-devices/\">Types of bluetooth attacks</a></p>\n</li>\n<li>\n<p>Turn off Wi-Fi, Bluetooth, Location, Nearby device scanning, etc. when not in\nuse or needed. Your weather app doesn‚Äôt need your location 24/7, find one that\nlets you manually enter your location and time zone.</p>\n</li>\n<li>\n<p>Use a password manager rather than using the one built into the browser, I\nlike BitWarden for sync and KeepassDX for self storage. Since you don‚Äôt have\nto remember the passwords, have it generate long complex unique passwords for\neach app.</p>\n<ul>\n<li>You can use KeepassDX to store a complex password for Bitwarden that is kept\n100% offline so your synced passwords are better protected.</li>\n</ul>\n</li>\n</ul>\n<hr />\n<p><strong>Google</strong></p>\n<p>In <code>Settings -&gt; Google</code> in\n<code>Google services -&gt; All services -&gt; Privacy &amp; security</code> Select <code>Ads</code> and either\nReset advertising ID every so often, or Delete advertising ID but know the\nconsequences of the latter.</p>\n<p>In the same <code>All services</code> area, click <code>Usage &amp; diagnostics</code> to disable it.</p>\n<p>Turn off <code>Improve Location Accuracy</code></p>\n<p>Go to your accounts <code>Manage your Google Account</code>, <code>Data &amp; privacy</code> and disable\nall the Activity tracking (Pause it or turn it off).</p>\n<p>If you rely on Google services, in the <code>Data &amp; privacy</code> section, it is helpful\nto run a <code>Privacy Checkup</code>.</p>\n<p>When you‚Äôre done, always go to <code>Settings -&gt; Accounts and backup</code> and remove the\nGoogle account.</p>\n<p>I recommended that you <strong>remove Android System SafetyCore</strong>.</p>\n<ul>\n<li>\n<p><a href=\"https://www.protectstar.com/en/blog/android-system-safetycore-hidden-installation-and-what-you-should-know\">What is SafetyCore and why you should delete it</a></p>\n</li>\n<li>\n<p><a href=\"https://www.kaspersky.com.au/blog/what-are-android-safetycore-and-key-verifier/34736/\">Google forcing Android System SafetyCore on users to scan for nudes</a></p>\n</li>\n</ul>\n<hr />\n<p><strong>F-Droid</strong></p>\n<p>F-Droid is a free and open-source app store for Android that only distributes\nopen-source software, without ads, proprietary code, or user tracking. All apps\nare vetted for privacy and transparency, making it a strong alternative to\nGoogle Play.</p>\n<p>No registration or account is required, further protecting privacy.</p>\n<p>Google restricts apps that remove Google services or modify their core features\nto disable their data collection strategies. This is why you won‚Äôt find many\nprivacy by default browsers in Google Play. Browsers like IronFox and Cromite\nare solid options that disable telemetry and more that are available outside of\nthe Play ecosystem.</p>\n<p>I personally use IronFox as my default and have been happy with it so far. It\ncomes with uBlock installed by default which I recommend that you learn how to\nget the most out of. With Firefox fingerprint protection, a few about:config\ntweaks, and uBlock you can accomplish what used to take 6 extensions to do. See:\n<a href=\"#ublock-origin\">uBlock Origin</a></p>\n<p>For more compartmentalization, Brave Browser now has an F-Droid repository that\ncan be added.</p>\n<p>Open F-Droid, in Settings click Repositories, click +, and for the Brave\nofficial repository add the following:</p>\n<blockquote>\n<p>NOTE: If you don‚Äôt want to add a repo, you can use the FFUpdater app to\ninstall privacy friendly browsers including brave.</p>\n</blockquote>\n<pre><code class=\"language-text\">https://brave-browser-apk-release.s3.brave.com/fdroid/repo\n</code></pre>\n<p>Or you can visit\n<a href=\"https://brave-browser-apk-release.s3.brave.com/fdroid/repo/index.html\">https://brave-browser-apk-release.s3.brave.com/fdroid/repo/index.html</a> and scan\nthe QR code.</p>\n<p>Another app that I recently discovered on F-Droid is the\n<a href=\"https://f-droid.org/en/packages/de.marmaro.krt.ffupdater/\">FFUpdater</a> app. It\nenables you to install and update different privacy friendly browsers as well as\nupdating FairEmail, K-9 Mail/Thunderbird, and Orbot in a privacy respecting way.</p>\n<ul>\n<li>\n<p>FairEmail is great, it has many privacy features including support for\nencryption,reformatting messages to prevent phishing, and more.</p>\n</li>\n<li>\n<p>To install apps through FFUpdater tap the phone logo with the down arrow on\nthe top right of the screen.</p>\n</li>\n</ul>\n<p>Aurora Store is an open-source client for Google Play that respects user privacy\nand lets you download and update proprietary apps with an anonymous account. You\ncan use F-Droid for open-source apps and Aurora for proprietary apps.</p>\n<p>I would recommend against Obtainium, the dev is a piece of shit and you can do\nanything it can do easily without it. Discoverium is a fork run by someone else,\nmight be an option.</p>\n<p>Another option I came across that I haven‚Äôt tried yet is\n<a href=\"https://zapstore.dev/\">Zapstore</a> It‚Äôs a decentralized, permissionless app store\nthat lets you support devs without PII.</p>\n<ul>\n<li><a href=\"https://www.eff.org/deeplinks/2019/01/stop-tracking-my-emails\">EFF stop-tracking-my-emails</a></li>\n</ul>\n<hr />\n<p><strong>Share Files and more anonymously</strong>:</p>\n<ul>\n<li><a href=\"https://onionshare.org/\">OnionShare</a></li>\n</ul>\n<p><strong>Sharing Images</strong>:</p>\n<ul>\n<li>Clean metadata before sharing pics, I personally use\n<a href=\"https://github.com/Crazy-Marvin/MetadataRemover\">Metadata Remover</a></li>\n</ul>\n<hr />\n<p><strong>SearXNG</strong></p>\n<p>While we‚Äôre on the topic of browsers, it‚Äôs worth considering a privacy-focused\nmetasearch engine like SearXNG. SearXNG anonymizes your search queries and\nremoves any identifying data before passing them along to Google or other search\nengines. This way, you can receive top-quality search results while keeping your\nprivacy intact</p>\n<p>To get started find a few <a href=\"https://searx.space/\">local instances</a> and\n<a href=\"https://searx.neocities.org/nojs.html\">others</a> and either bookmark them for\nquick access or do what I do and add them to use as your default search engine.</p>\n<p>In Firefox go to <code>about:preferences#search</code>, scroll to the bottom and click\n<code>Add</code>. Name it whatever you want and for the URL add one of the local instances\nfollowed by <code>search?q=%s</code> for example, for an instance in the US with A+\nratings:</p>\n<pre><code class=\"language-text\">https://searx.ankha.ac/search?q=%s\n</code></pre>\n<p>Then click <code>Add Engine</code>, and back near the top of the page you can set one\ninstance as your default search engine and another for private windows. I have\nhad a good experience so far using SearXNG with the occasional problem that is\nsolved by using a different instance.</p>\n<blockquote>\n<p>‚ùóÔ∏è Note: When using a public SearXNG instance from someone you don‚Äôt know, you\nare trusting the operator since they can see the IP address making the\nsearches and might keep logs. The site https://searx.space/ provides helpful\ndetails to choose instances based on trust and location. If you want the\nhighest level of privacy and full control, running your own instance is the\nbest option‚Äîthough it requires more setup. Using public instances is a great\nway to get started and improve privacy compared to regular search engines.</p>\n</blockquote>\n<p><strong>Browser compartmentalization</strong> is a technique where you use multiple browsers\nto separate different types of online activities. Instead of doing all browsing\nin a single browser, you dedicate specific browsers to distinct tasks, for\nexample, one browser for email and banking, another for social media, and a\nthird for casual web surfing. This separation makes it difficult for websites\nand trackers to link your activities across different contexts because cookies,\ntrackers, and browsing data are isolated within each browser.</p>\n<ul>\n<li>AI and social media Apps often require extensive permissions and deep access\nto your device data and can run background processes that you can‚Äôt easily\nmonitor. If you avoid the apps and only access AI and social media in your\nbrowser you get the benefits of browser sandboxing, tracking prevention,\ncookie controls and more. You gain more benefits by using the\ncompartmentalization technique explained above, possibly one for AI and one\nfor social media.</li>\n</ul>\n<hr />\n<p>The following website lists the tracking protection mechanisms implemented by\nthe major browsers and browser engines:</p>\n<ul>\n<li><a href=\"https://www.cookiestatus.com/\">Cookie Status</a></li>\n</ul>\n<hr />\n<details>\n<summary> ‚úîÔ∏è Click to Expand uBlock Guide </summary>\n<h2>uBlock Origin</h2>\n<p>Arkenfox and Betterfox are JavaScript configuration files used to harden/control\nFirefox settings on a computer.</p>\n<p><a href=\"https://github.com/yokoffing/BetterFox?tab=readme-ov-file\">BetterFox</a> does a\ngreat job explaining how to use uBlock with solid recommendations.</p>\n<ul>\n<li><a href=\"https://github.com/yokoffing/filterlists?tab=readme-ov-file#guidelines\">BetterFox uBlock filterlists</a></li>\n</ul>\n<p>If you wanted to apply the\n<a href=\"https://github.com/yokoffing/filterlists/blob/main/privacy_essentials.txt\">Privacy Essentials</a>\nlist you would click\n<a href=\"https://subscribe.adblockplus.org/?location=https://raw.githubusercontent.com/yokoffing/filterlists/main/privacy_essentials.txt&amp;title=Privacy%20Essentials\">subscribe</a>,\nwhich launches the uBlock asset viewer where you can see all of the domains that\nwill be blocked before clicking <code>Subscribe</code> again to apply them.</p>\n<h3>Adding other lists</h3>\n<ul>\n<li>\n<p><a href=\"https://github.com/hagezi/dns-blocklists\">Hagezi dns-blocklists</a></p>\n</li>\n<li>\n<p><a href=\"https://github.com/ppfeufer/adguard-filter-list\">adguard-filter-list</a></p>\n</li>\n</ul>\n<p>Click the uBlock logo, Settings, Filter lists, scroll to the bottom and choose\nImport‚Ä¶, Paste the url of your chosen list, and click Apply changes.</p>\n<p>For example, <a href=\"https://github.com/arkenfox/user.js/\">Arkenfox</a> suggests adding\nthe Actually Legitimate URL Shortener Tool. Add\n<a href=\"https://raw.githubusercontent.com/DandelionSprout/adfilt/master/LegitimateURLShortener.txt\">https://raw.githubusercontent.com/DandelionSprout/adfilt/master/LegitimateURLShortener.txt</a>\nto the Import‚Ä¶ section and click Apply changes. If you scroll up, you‚Äôll see\nthat it was added and chosen.</p>\n<p>Setup your <a href=\"https://github.com/gorhill/uBlock/wiki/Blocking-mode\">Blocking mode</a></p>\n<p>Many opt for\n<a href=\"https://github.com/gorhill/uBlock/wiki/Blocking-mode:-medium-mode\">medium mode</a>.\nTo do so you need to:</p>\n<p><strong>Settings pane</strong>:</p>\n<ul>\n<li>Open the dashboard, and choose I am an advanced user.</li>\n</ul>\n<p><strong>Filter lists pane</strong>:</p>\n<ul>\n<li>\n<p>All of uBO‚Äôs filter lists: checked</p>\n</li>\n<li>\n<p>EasyList: checked</p>\n</li>\n<li>\n<p>Peter Lowe‚Äôs Ad server list: checked</p>\n</li>\n<li>\n<p>EasyPrivacy: checked</p>\n</li>\n<li>\n<p>Online Malicious URL Blocklist: checked</p>\n</li>\n</ul>\n<p><strong>My rules pane (4th pane from the left)</strong>:</p>\n<p>Underneath Temporary rules add, you literally type this in:</p>\n<ul>\n<li>\n<p>Add <code>* * 3p-script block</code></p>\n</li>\n<li>\n<p>Add <code>* * 3p-frame block</code></p>\n</li>\n<li>\n<p>Click <code>Save</code></p>\n</li>\n<li>\n<p>Click <code>&lt;- Commit</code> (Not required on phone)</p>\n</li>\n<li>\n<p>Setting medium mode on your phone is likely overkill because it‚Äôs not super\nquick to switch broken sites to easy mode as it is on a computer.</p>\n</li>\n</ul>\n<p><strong>Fallback to\n<a href=\"https://github.com/gorhill/uBlock/wiki/Blocking-mode:-easy-mode\">easy mode</a></strong></p>\n<p>Click the uBlock logo while on the site you want to use easy mode on. You‚Äôll see\nthe power button to the top right, the Global rules and the Local rules which\nstart 3 boxes from the left. Click the box under the Local rules for 3rd-party\nscripts. The box will change colors, dark gray = NOOP (No Operation). This tells\nuBO to ignore the aggressive global block for this site, and let the normal\nfilter lists handle the blocking.</p>\n<p>Click the padlock to make the rules NOOP rules permanent.</p>\n<p>You can also disable JavaScript in Settings as needed replacing the need for\nNoScript.</p>\n</details>\n<ul>\n<li>\n<p><a href=\"https://github.com/gorhill/uBlock/wiki\">uBlock Wiki</a></p>\n</li>\n<li>\n<p><a href=\"https://arstechnica.com/gadgets/2025/09/f-droid-calls-for-regulators-to-stop-googles-crackdown-on-sideloading/\">Ars Technica F-Droid &amp; sideloading restrictions</a></p>\n</li>\n<li>\n<p><a href=\"https://f-droid.org/en/2025/09/29/google-developer-registration-decree.html\">F-Droid and Google‚Äôs Developer Registration Decree</a></p>\n</li>\n</ul>\n</details>\n<hr />\n<h2>Default Deny</h2>\n<p>If you read the following GrapheneOS discussion forum written by an RDNS dev:</p>\n<ul>\n<li><a href=\"https://discuss.grapheneos.org/d/12728-proton-apps-pinging-google-api-sending-reports-back-after-opting-out/54\">GrapheneOS Discussion Forum on Rethink</a></li>\n</ul>\n<p>The post suggests you go to <code>Home -&gt; Apps</code> and right under <code>Showing all apps</code>\nclick on the grayed out üõúüì∂ to set a rule to <strong>block both Metered and Unmetered\nconnections to all apps by default</strong>. This will block both Wi-Fi and mobile data\nconnections to <strong>all apps</strong> on your device.</p>\n<p>The point here is that not every App on your device needs network access all the\ntime or at all in some cases.</p>\n<p>Search for the apps you use/trust and:</p>\n<ul>\n<li>\n<p>start by enabling Wi-Fi üõú and mobile-data üì∂ as well as Bypass Universal so\nyour required apps aren‚Äôt blocked right when the screen shuts off or affected\nby the firewall.</p>\n</li>\n<li>\n<p>Next, check your logs and see why it‚Äôs being blocked. Look at the domains\ninvolved and set trust rules for said domains. If it is unclear why networking\nstill isn‚Äôt working, you can:</p>\n</li>\n<li>\n<p>If you‚Äôre using Rethink‚Äôs DNS, you can try allowing the app to\n<code>Bypass DNS &amp; Firewall</code>. Try the app again, does it work? If not:</p>\n</li>\n<li>\n<p>You can also <code>Isolate</code> an App, you then have to set up <em>trust | allow</em> rules\nfor domains or IPs over a period of time which can take a while.</p>\n</li>\n<li>\n<p><code>Exclude</code> the app. This makes RethinkDNS completely unaware of the app and is\noften what is required for Reddit. It is my understanding that after you\n<code>Exclude</code> an App, your systems Automatic Secure DNS will pick it up.</p>\n</li>\n</ul>\n<p>A few apps that typically need network access on Android:</p>\n<ul>\n<li>\n<p>Google Play services (<code>com.google.android.gms</code>): push notifications, safety\nchecks, etc.</p>\n</li>\n<li>\n<p>Google Play Store (<code>com.android.vending</code>) app updates and downloads</p>\n</li>\n<li>\n<p>Android System (usually UID 1000, often <code>android</code> or <code>system</code>): Core OS\nconnectivity checks, NTP time sync, and network management. Blocking can cause\n‚Äúno internet‚Äù errors.</p>\n</li>\n<li>\n<p>Android System WebView (<code>com.google.android.webview</code>): Renders web contents in\napps.</p>\n</li>\n<li>\n<p>Download Manager (<code>com.android.providers.downloads</code>): Manages file downloads\nfrom apps/browser. Without it, downloads stall.</p>\n</li>\n<li>\n<p>Media Storage</p>\n</li>\n<li>\n<p>Settings</p>\n</li>\n</ul>\n<hr />\n<h3><a href=\"#tor\">Tor</a></h3>\n<p>Tor itself is a network and software that anonymizes traffic by encrypting it\nand bouncing it though a series of volunteer-operated relays around the world\nbefore reaching the destination. Orbot uses this Tor network to encrypt and\nanonymize internet traffic for Android apps.</p>\n<p>Orbot routes app traffic through Tor but doesn‚Äôt provide the same kind of\ntraffic isolation and sandboxing that Tor browser offers on desktop. Be aware of\nthe limitations and use Tor Browser on a hardened system or specialized software\nsuch as Tails or Whonix when anonymity truly matters.</p>\n<p>If you want to learn how Tor works, I suggest reading the following in this\norder:</p>\n<ol>\n<li>\n<p><a href=\"https://www.privacyguides.org/articles/2025/04/30/in-praise-of-tor/\">PrivacyGuides In Praise of Tor</a></p>\n</li>\n<li>\n<p><a href=\"https://www.privacyguides.org/en/advanced/tor-overview/\">PrivacyGuides Tor Overview</a></p>\n</li>\n<li>\n<p><a href=\"https://ssd.eff.org/module/how-to-use-tor\">EFF How to: Use Tor</a></p>\n</li>\n</ol>\n<p><strong>Tor is at risk, and needs our help</strong>. Despite its strength and history, Tor\nisn‚Äôt safe from the same attacks oppressive regimes and misinformed legislators\ndirect at encryption and many other privacy-enhancing\ntechnologies.‚Äì<a href=\"https://www.privacyguides.org/articles/2025/04/30/in-praise-of-tor/#how-to-support-tor\">How to Support Tor</a></p>\n<details>\n<summary>\n‚úîÔ∏è Click to Expand Tor Section\n</summary>\n<blockquote>\n<p>‚ùóÔ∏è WARNING: Tor gets much of its funding from the US government and is not\nimmune to vulnerabilities or misconfigurations.Tor Browser is <strong>not</strong> the most\nsecure browser, anonymity and security can often be at odds with each other.\nHaving the exact same browser as many other people isn‚Äôt the best security\npractice, but it is great for anonymity. Tor is also based on Firefox Esr,\nwhich only receives patches for vulnerabilities considered Critical or High\nwhich can be taken advantage of.</p>\n</blockquote>\n<p>Tor Project has also done some sketchy/questionable things lately such as\nremoving user agent spoofing which made every user appear as if they were using\nthe same version of Windows. This decision reduces anonymity and is questionable\nat best, seems to me there ought to be a very good reason for doing this which I\ncan‚Äôt find. Tor is still one of the best anonymity solutions, just stay informed\nand cautious.</p>\n<p>The following is a summary of some of the Tor Overview, all credit goes to them.\nIt is important to spread the word when you can!</p>\n<p>If you are fortunate to live outside of oppressive regimes with extreme\ncensorship, using Tor for every day, mundane activities is likely safe and won‚Äôt\nput you on any harmful ‚Äúlist.‚Äù Even if it did, you‚Äôd be in good company, these\nlists mostly contain great people working tirelessly to defend human rights and\nonline privacy worldwide.</p>\n<p>By using Tor regularly for ordinary browsing, you help strengthen the network,\nmaking it more robust and anonymous for everyone. This collective support makes\nstaying private easier for activists, journalists, and anyone facing online\nsurveillance or censorship. The writer of the PrivacyGuides article mentions\nusing Tor when he needs to access Google Maps to protect his privacy</p>\n<p>So, consider embracing Tor not only for sensitive browsing but also for daily\nroutine tasks. Every user adds valuable noise to the network, helping protect\nprivacy and freedom for all.</p>\n</details>\n<hr />\n<h3><a href=\"#setting-up-orbot-with-a-tcp-only-proxy\">Setting up Orbot with a TCP-only Proxy</a></h3>\n<p><img src=\"../images/orbot.png\" alt=\"Orbot Logo\" /></p>\n<ul>\n<li>Helpful guide, <a href=\"https://thecyberexpress.com/what-is-orbot/\">What is Orbot?</a></li>\n</ul>\n<p>TCP-Only Proxies forward all TCP-level connections from selected apps to Orbot.</p>\n<p>TCP-Only Proxies work best for Apps that use multiple TCP protocols beyond just\nbasic web browsing (HTTP/HTTPS) like messaging apps (Signal), search apps (DDG),\netc. Because it proxies all TCP traffic, it can cause some apps to slow down or\nbreak if they expect direct DNS or UDP.</p>\n<p>First install Orbot, Open <code>Orbot -&gt; More -&gt; Orbot Settings</code> and turn on\n<code>Power User Mode</code>. <strong>This is important</strong>, if you forget this Rethinks auto Orbot\nwill not let you choose between SOCKS and HTTP proxies.</p>\n<p>You should also check <code>Allow Background Starts</code> ON.</p>\n<p>In <code>Configure -&gt; Proxy -&gt; Setup Orbot</code>:</p>\n<ul>\n<li>\n<p>Click <code>Add / Remove 0 apps</code>, search for an app that you want to run through\nOrbot. For simple testing I chose DuckDuckGo with a TCP-only Proxy.</p>\n</li>\n<li>\n<p>In <code>Home -&gt; Apps</code> search for <code>Orbot</code> and set <code>Orbot -&gt; Bypass Universal</code> ON</p>\n</li>\n<li>\n<p>On the first time starting Orbot through Rethink, you‚Äôll have to click the\n<code>Configure -&gt; Proxy -&gt; Setup Orbot -&gt; Orbot&gt;</code> to <code>Connect</code> as well as grant\ninitial permissions. After you start Orbot successfully, check out Rethinks\n<code>Home</code> and below the STOP button should say <code>Protected With Tor</code>.</p>\n</li>\n</ul>\n<p>Open DuckDuckGo and go to:</p>\n<pre><code class=\"language-text\">https://dnsleaktest.com\n# CrossCheck\nhttps://ipcheck.net\n</code></pre>\n<blockquote>\n<p>‚ùó You may see that ipleaktest initially shows a Tor exit relay location such\nas the Netherlands, once you complete a Standard Test, it still shows WoodyNet\nISPs. Since I configured Rethink to use DNSCrypt with Quad9 this is completely\nexpected. This confirms that my DNS traffic is not leaking to my ISP and is\nproperly anonymized through Tor and Quad9. As long as you don‚Äôt see your\nactual ISP‚Äôs servers in the results, your setup is working as intended.</p>\n</blockquote>\n<p>Now you can add more apps that would benefit from anonymity such as FairEmail,\nRSS feeds, and crypto wallets. I believe for Signal, it requires that you to set\nup the SOCKS5 proxy to work correctly which is pretty straightforward.</p>\n<p>Look into an RSS Feed, they give you complete control of the content you\nconsume, no algorithm involved!</p>\n<p>This can also be useful on public Wi-Fi or other insecure networks.</p>\n<ul>\n<li>\n<p>You can also open Orbot and <code>Choose How to Connect</code>, if you want to hide Tor\nuse.</p>\n</li>\n<li>\n<p>If you live in an area where Tor use isn‚Äôt discriminated against, consider\nActivating your Orbot <code>Kindness</code> tab so others that are in oppressive regimes\ncan use your device as a bridge. This is a great way to give back!</p>\n</li>\n</ul>\n<hr />\n<h2><a href=\"#setting-up-a-socks5-proxy\">Setting up a SOCKS5 Proxy</a></h2>\n<p>If you have Orbot set up through auto mode, you‚Äôll have to disable it.</p>\n<p>Open <code>Orbot -&gt; More</code>: Near the bottom of the screen you‚Äôll see <code>HTTP: 8118</code>, and\n<code>SOCKS: 9050</code>, these are the Port numbers. We will compare these to Rethinks\ndefaults. (They match).</p>\n<p>Back in Rethink, <code>Configure -&gt; Proxy -&gt; Setup SOCKS5 Proxy</code>.</p>\n<p>In the App dropdown choose <code>Orbot</code>.</p>\n<ul>\n<li>\n<p>Hostname: <code>127.0.0.1</code></p>\n</li>\n<li>\n<p>Port Number: <code>9050</code></p>\n</li>\n<li>\n<p>Leave the rest of the defaults and Hit <code>Set</code></p>\n</li>\n<li>\n<p>Go <code>Home</code>, below the STOP button you should see <code>Protected With SOCKS Proxy</code>.\nNow all of your devices traffic that doesn‚Äôt bypass Rethink is routed through\nthe SOCKS5 proxy.</p>\n</li>\n<li>\n<p>In <code>Configure -&gt; DNS</code> and turn <code>Never proxy DNS</code> ON</p>\n</li>\n<li>\n<p>Open your browser and visit <code>https://dnsleaktest.com</code>, your public IP should\nno longer be your ISPs.</p>\n</li>\n<li>\n<p>SOCKS5 alone doesn‚Äôt encrypt the traffic; it only proxies or routes it. Orbot\nuses SOCKS5 to let apps route traffic into the Tor network. Once inside the\nTor network, the traffic is encrypted in layers.</p>\n</li>\n<li>\n<p>There is a misconception that Orbot is a ‚Äúfree VPN‚Äù. It‚Äôs actually part of an\nanonymity network designed to hide your identity by sending your traffic\nthrough multiple servers. And the SOCKS5 proxy that Orbot uses isn‚Äôt a VPN\neither, it simply directs certain app traffic through a proxy server without\ncreating a full encrypted tunnel from your device like a VPN does.</p>\n</li>\n</ul>\n<hr />\n<h2>WireGuard/VPN</h2>\n<p>Keep your goals in mind before paying for a VPN, some allow you to pay with cash\nanonymously such as Mullvad VPN and a few others. Remember that you are\ntransferring trust, from your ISP to the VPN provider.</p>\n<p><code>Configure -&gt; Proxy -&gt; Setup WireGuard -&gt; +</code>:</p>\n<p>With the WireGuard protocol, the provider usually gives you either a QR Code, or\na configuration file (e.g., <code>.conf</code> file) which is a plaintext file that\ncontains what is needed. You download that file and Click <code>IMPORT</code> which brings\nup your phones filesystem.</p>\n<p>Alternatively, the <code>CREATE</code> option for advanced users who are setting up their\nown WireGuard network, typically if you host your own VPN server.</p>\n<p>After this is setup you should always verify that your traffic is encrypted\n(hidden IP) and your DNS queries are protected (no leaks).</p>\n<p>You could:</p>\n<ol>\n<li>\n<p>First check what your IP address is before enabling WireGuard at\n<code>whatismyipaddress.com</code> or <code>ipleak.net</code>, take note of your Public IP, ISP,\nand City/Country this is your real info that the VPN needs to hide.</p>\n</li>\n<li>\n<p>Connect to your Wireguard/VPN server. Choose the server location you want and\ngo back to check again.</p>\n</li>\n<li>\n<p>Check for leaks, go to <code>dnsleaktest.com</code> and run a Standard test. If you\ndon‚Äôt see your Public IP listed anywhere, you don‚Äôt have a leak.</p>\n</li>\n</ol>\n<p><strong>Fixing DNS Leaks</strong>:</p>\n<ul>\n<li>\n<p>Use WireGuard in Simple mode.</p>\n</li>\n<li>\n<p>Or, use <code>Configure -&gt; DNS -&gt; Split DNS</code> with WireGuard in\n<code>Advanved + Lockdown</code> mode (if running on Android 12+)</p>\n</li>\n</ul>\n<p>To ensure your DNS requests go through your VPN, check\n<code>Configure -&gt; Logs -&gt; DNS</code>. Tap on the entries that appear there, which should\nbring up a bottomsheet with more info about the request and how it was handled.\nRequests handled by WireGuard are shown with sub-text ‚Äúresolved x min ago by\nwg‚Ä¶‚Äù ‚Äìcelzero</p>\n<hr />\n<p><strong>Proton VPN</strong></p>\n<p>This works for ProtonVPN Free as well.</p>\n<p>Written by celzero\n<a href=\"https://www.reddit.com/r/rethinkdns/comments/163e83l/proton_vpn/\">Here</a></p>\n<ol>\n<li>\n<p>On your Android, visit https://account.protonvpn.com/downloads</p>\n</li>\n<li>\n<p>Scroll to WireGuard</p>\n</li>\n</ol>\n<ul>\n<li>\n<p>Give it a name</p>\n</li>\n<li>\n<p>Select Android</p>\n</li>\n<li>\n<p>Enable VPN options as needed.</p>\n</li>\n<li>\n<p>Press Create or tap on Download.</p>\n</li>\n</ul>\n<ol start=\"3\">\n<li>Open Rethink, goto Configure -&gt; Proxy -&gt; Setup WireGuard</li>\n</ol>\n<ul>\n<li>\n<p>Tap on the ‚Äú+‚Äù button</p>\n</li>\n<li>\n<p>Choose Import</p>\n</li>\n<li>\n<p>Select the downloaded configuration file</p>\n</li>\n</ul>\n<ol start=\"4\">\n<li>\n<p>If the import is successful, you should see a new profile prefixed wg added\nto the list.</p>\n</li>\n<li>\n<p>Tap on that <code>wg</code> entry.</p>\n</li>\n</ol>\n<ul>\n<li>\n<p>In the new screen that opens up, tap on Add / Remove applications.</p>\n</li>\n<li>\n<p>Select apps that should be part of this particular WireGuard profile.</p>\n</li>\n<li>\n<p>Go back.</p>\n</li>\n</ul>\n<ol start=\"6\">\n<li>Enable / disable that wg profile as desirable.</li>\n</ol>\n<ul>\n<li>On my phone, when I saved the VPN profile, it automatically added <code>.txt</code> to\nthe end of the file causing the import to fail. I was able to open my phones\ndocuments and long hold the file to rename it, afterwards I was able import\nit.</li>\n</ul>\n<hr />\n<p><strong>SIMPLE</strong></p>\n<p>When you enable: <code>Configure -&gt; Proxy -&gt; Setup WireGuard - SIMPLE</code></p>\n<p>All connections from all apps, including DNS, will be routed to a single, active\nWireGuard VPN. Other active WireGuard VPNs, if any, will be stopped.</p>\n<p>If you tap SIMPLE, you can see the name of your VPN, check your Logs, and see\nyour Peer connection.(your device that participates in the VPN network)</p>\n<hr />\n<p><strong>ADVANCED</strong></p>\n<p>Same as above but tap <code>ADVANCED</code> before enabling the toggle. This lets you\nchoose which apps will be routed through the VPN while the rest are routed as\nusual.</p>\n<p>This Mode also lets you enable:</p>\n<ul>\n<li>\n<p><strong>Lockdown</strong>: Selected apps will only be routed through this WireGuard VPN,\nregardless of whether the VPN is active or disabled.</p>\n</li>\n<li>\n<p><strong>Always-on</strong>: All connections and apps not routed by other WireGuard VPNs\nwill be routed by this one.</p>\n</li>\n<li>\n<p><strong>Mobile only</strong>: Use this WireGuard exclusively over mobile data.</p>\n</li>\n</ul>\n<p>After you configure your Advanced settings as needed, enable the toggle.</p>\n<p>Always make sure to watch your Logs as well as test with something like\n&lt;dnsleaktest.com&gt;, you shouldn‚Äôt see your actual Public IP anywhere. It‚Äôs\nadvisable to check for WebRTC Leaks as well if you have that enabled.</p>\n<p><strong>Troubleshooting VPN issues</strong></p>\n<p>There are a few Proxy settings in <code>Configure -&gt; Network -&gt; PROXY</code>, where you\ncan:</p>\n<ul>\n<li>\n<p>Enable <code>Do not randomize WireGuard listen port</code>: Keep WireGuard listen ports\nfixed (no randomization) in Advanced mode.</p>\n</li>\n<li>\n<p>Enable <code>Endpoint-Independent mapping</code>: When enabled, UDP sockets maintain a\nfixed address and port for all destinations.</p>\n</li>\n</ul>\n<p><strong>Check your Logs</strong></p>\n<p>In <code>Configure -&gt; Proxy -&gt; Setup WireGuard</code>, click on your VPN which will give\nyou access to the <code>LOGS</code>.</p>\n<p>Click the top entry, it will bring up the IP address and domain and show your\nrules the app. You can click the dropdown menu‚Äôs to set new Universal Firewall\nrules, as well as block/trust rules for IPs and domains.</p>\n<hr />\n<h3><a href=\"#logs\">Logs</a></h3>\n<p>On-device logging is on by default. You can find it in <code>Configure -&gt; Settings</code>.\nFrom there, you can set the log level and choose a notification action.</p>\n<p>If anyone else uses your phone, it‚Äôs probably a good idea to enable app lock.</p>\n<p>Go to <code>Configure -&gt; Logs</code>, and try to access the app that‚Äôs not working. You\nshould see said app at the top of the Network Logs, click it. In the top right\nof the tab, you‚Äôll see the reason why it‚Äôs not working such as: <code>App Blocked</code>,\nor <code>DNS Bypass</code>.</p>\n<p>This <code>DNS Bypass</code> means that the App in question is trying to bypass the Rethink\nTunnel and being actively blocked. You can search for said app and try setting\nIP or Port Trust rules.</p>\n<p>You can also go to <code>Home -&gt; Apps</code> and search for the App you need, click on it\nand at the bottom of the screen you will see <code>IP Logs</code>, and <code>Domain Logs</code>.</p>\n<p>Once you click on the log of the app in question, you‚Äôll be given 3 drop down\noptions. If you set an app to Bypass DNS and Firewall settings, you will see\nthat in the first dropdown box.</p>\n<p>The next drop down is <code>Block,trust this IP for this app</code> where you can set a\nrule to <code>Block</code> or <code>Trust</code>.</p>\n<hr />\n<h3><a href=\"#resources\">Resources</a></h3>\n<details>\n<summary>\n‚úîÔ∏è Click to Expand Resources\n</summary>\n<p>Things change frequently in the privacy/security relm, many sites provide an RSS\nfeed that automatically updates when they post new content. I‚Äôve listed a few\nfeeds that are good to follow IMO.</p>\n<p><strong>RSS</strong> (Really Simple Syndication) is a technology that delivers automatic\nupdates from your favorite websites, blogs, or podcasts in a standardized\nformat. It saves you time by eliminating the need to manually check for new\ncontent. Best of all, your feed includes only what you choose‚Äîno algorithms\ndeciding what you see.</p>\n<p>I personally use <a href=\"https://feeder.co/\">Feeder</a> as my RSS reader, it‚Äôs open-source\nand has been great IMO.</p>\n<ul>\n<li><a href=\"https://www.privacytools.io/privacy-rss-feed-readers\">PrivacyTools privacy-rss-feed-readers</a></li>\n</ul>\n<p><strong>RSS Feeds</strong>:</p>\n<p>With Feeder, you click the 3 dots in the top right and click + Add feed, you can\nthen type the regular address of a site &amp; if it has RSS feeds, Feeder will list\nthem. Most sites that have an RSS feed will have an orange RSS button that you\ncan click on to get the address.</p>\n<ul>\n<li>\n<p>PrivacyTools: <a href=\"https://www.privacytools.io/guides/rss.xml\">https://www.privacytools.io/guides/rss.xml</a></p>\n</li>\n<li>\n<p>Darknet Diaries: <a href=\"https://podcast.darknetdiaries.com/\">https://podcast.darknetdiaries.com/</a></p>\n</li>\n<li>\n<p>Hacker News: <a href=\"https://news.ycombinator.com/rss\">https://news.ycombinator.com/rss</a></p>\n</li>\n<li>\n<p>PrivacyGuides: <a href=\"https://privacyguides.org/rss/\">https://privacyguides.org/rss/</a></p>\n</li>\n<li>\n<p>Tor Project blog: <a href=\"https://blog.torproject.org/feed.xml\">https://blog.torproject.org/feed.xml</a></p>\n</li>\n<li>\n<p>Mozilla Security Blog: <a href=\"https://blog.mozilla.org/security/feed/\">https://blog.mozilla.org/security/feed/</a></p>\n</li>\n<li>\n<p>MDN Blog: <a href=\"https://developer.mozilla.org/en-US/blog/rss.xml\">https://developer.mozilla.org/en-US/blog/rss.xml</a></p>\n</li>\n<li>\n<p>F-Droid Forum - Latest posts: <a href=\"https://forum.f-droid.org/posts.rss\">https://forum.f-droid.org/posts.rss</a></p>\n</li>\n<li>\n<p>Opensource.com: <a href=\"https://opensource.com/feed\">https://opensource.com/feed</a></p>\n</li>\n<li>\n<p>DuckDuckGo Blog: <a href=\"https://spreadprivacy.com/rss/\">https://spreadprivacy.com/rss/</a></p>\n</li>\n<li>\n<p>Electronic Frontier Foundation Deeplinks Blog:\n<a href=\"https://www.eff.org/rss/updates.xml\">https://www.eff.org/rss/updates.xml</a></p>\n</li>\n<li>\n<p>KrebsonSecurity: <a href=\"https://krebsonsecurity.com/feed/\">https://krebsonsecurity.com/feed/</a></p>\n</li>\n<li>\n<p>Arkenfox recent commits:\n<a href=\"https://github.com/arkenfox/user.js/commits/master.atom\">https://github.com/arkenfox/user.js/commits/master.atom</a></p>\n</li>\n<li>\n<p>Arkenfox release notes: <a href=\"https://github.com/arkenfox/user.js/releases.atom\">https://github.com/arkenfox/user.js/releases.atom</a></p>\n</li>\n<li>\n<p>Brave Blog: <a href=\"https://brave.com/blog/index.xml\">https://brave.com/blog/index.xml</a></p>\n</li>\n<li>\n<p>Ars Technica: <a href=\"https://feeds.arstechnica.com/arstechnica/index/\">https://feeds.arstechnica.com/arstechnica/index/</a></p>\n</li>\n<li>\n<p>PrivacySavvy: <a href=\"https://privacysavvy.com/feed/\">https://privacysavvy.com/feed/</a></p>\n<ul>\n<li>PrivacySavvy Security Archive: <a href=\"https://privacysavvy.com/security/feed/\">https://privacysavvy.com/security/feed/</a></li>\n</ul>\n</li>\n</ul>\n<hr />\n<ul>\n<li>\n<p><a href=\"https://research.cloudflare.com/projects/network-privacy/odns/\">Oblivious DNS over HTTPS</a></p>\n</li>\n<li>\n<p><a href=\"https://www.ietf.org/archive/id/draft-denis-dprive-dnscrypt-06.html\">DNSCrypt Protocol</a></p>\n</li>\n<li>\n<p><a href=\"https://www.privacytools.io/\">PrivacyTools.io</a></p>\n</li>\n<li>\n<p><a href=\"https://www.privacyguides.org/articles/2025/04/30/in-praise-of-tor/\">PrivacyGuides In Praise of Tor</a></p>\n</li>\n<li>\n<p><a href=\"https://www.privacyguides.org/en/advanced/tor-overview/\">PrivacyGuides Tor Overview</a></p>\n</li>\n<li>\n<p><a href=\"https://orbot.app/en/\">Orbot app</a></p>\n</li>\n<li>\n<p>Orbot is a free app from the Guardian Project that empowers other apps on your\ndevice to use the internet more securely. Orbot uses Tor to encrypt your\ninternet traffic and hide it by bouncing through a seris of computers around\nthe world.\n‚Äì<a href=\"https://support.torproject.org/glossary/orbot/\">TorProject Orbot</a></p>\n</li>\n<li>\n<p><a href=\"https://guardianproject.info/apps/org.torproject.android/\">Guardian Project Orbot</a></p>\n</li>\n<li>\n<p>WireGuard is an extremely simple yet fast and modern VPN that utilizes\nstate-of-the-art cryptography. ‚Äì<a href=\"https://www.wireguard.com/\">Wireguard.com</a></p>\n</li>\n<li>\n<p><a href=\"https://ssd.eff.org/\">EFF Surveillance Self Defense</a></p>\n</li>\n<li>\n<p><a href=\"https://coveryourtracks.eff.org/\">EFF Cover Your Tracks</a></p>\n</li>\n<li>\n<p><a href=\"https://amiunique.org/\">AmIUnique?</a></p>\n</li>\n<li>\n<p><a href=\"https://noscript.net/\">What is NoScript?</a></p>\n</li>\n<li>\n<p><a href=\"https://www.privacyguides.org/en/dns/\">PrivacyGuides DNS Recommendations</a></p>\n</li>\n<li>\n<p><a href=\"https://www.cloudflare.com/learning/dns/what-is-a-dns-server/\">What is a DNS Server?</a></p>\n</li>\n<li>\n<p><a href=\"https://www.cloudflare.com/learning/dns/what-is-anycast-dns/\">What is Anycast</a></p>\n</li>\n<li>\n<p><a href=\"https://dn.org/anycast-dns-vs-unicast-dns-a-comparative-guide/\">anycast-dns-vs-unicast-dns</a></p>\n</li>\n<li>\n<p><a href=\"https://www.cloudflare.com/learning/ddos/glossary/user-datagram-protocol-udp/\">What is UDP?</a></p>\n</li>\n<li>\n<p><a href=\"https://developer.mozilla.org/en-US/docs/Web/Security/Transport_Layer_Security\">MDN TLS</a></p>\n</li>\n<li>\n<p><a href=\"https://www.cloudflare.com/learning/ssl/transport-layer-security-tls/\">What is TLS</a></p>\n</li>\n<li>\n<p><a href=\"https://network-guides.com/tcp-ip-basics/\">Networking-Guides TCP/IP Basics</a></p>\n</li>\n<li>\n<p><a href=\"https://www.cloudflare.com/learning/dns/what-is-recursive-dns/\">Cloudflare What is recursive DNS?</a></p>\n</li>\n<li>\n<p><a href=\"https://github.com/evilsocket/opensnitch\">OpenSnitch</a></p>\n</li>\n<li>\n<p><a href=\"https://github.com/pi-hole/pi-hole\">pi-hole</a></p>\n</li>\n<li>\n<p><a href=\"https://spyware.neocities.org/\">Sypware Watchdog</a></p>\n</li>\n</ul>\n</details>\n<pre><code class=\"language-nix\">\"goodbye ${ { d = \"world\";}.d}\"\n</code></pre>\n",
      "date_published": "2025-12-07T00:00:00+00:00",
      "author": {
        "name": "saylesss88"
      }
    },
    {
      "id": "/arch/enc_dns.html",
      "url": "/arch/enc_dns.html",
      "title": "Encrypted DNS on Arch",
      "content_html": "<h1>Encrypted DNS ArchLinux with dnscrypt-proxy &amp; dnsmasq</h1>\n<details>\n<summary> ‚úîÔ∏è Click to Expand Table of Contents</summary>\n<!-- toc -->\n</details>\n<blockquote>\n<p>‚ùó NOTE: There are many other ways for someone monitoring your traffic to see\nwhat domain you looked up via DNS that it‚Äôs effectiveness is questionable\nwithout also using Tor or a VPN. Encrypted DNS will not help you hide any of\nyour browsing activity.</p>\n</blockquote>\n<pre><code class=\"language-bash\">sudo pacman -S dnscrypt-proxy\n</code></pre>\n<blockquote>\n<p>NOTE: udp is required for dnscrypt protocol, keep this in mind when\nconfiguring your servers if your output chain is a default drop.</p>\n</blockquote>\n<ul>\n<li>\n<p><a href=\"https://wiki.archlinux.org/title/Dnscrypt-proxy\">Arch Wiki dnscrypt-proxy</a></p>\n</li>\n<li>\n<p><a href=\"https://github.com/DNSCrypt/dnscrypt-proxy/wiki/Configuration\">dnscrypt-proxy Wiki</a></p>\n</li>\n<li>\n<p><a href=\"https://wiki.archlinux.org/title/Domain_name_resolution#Privacy_and_security\">DNS Privacy and Security</a></p>\n</li>\n</ul>\n<p>Edit <code>/etc/dnscrypt-proxy/dnscrypt-proxy.toml</code> to add your chosen resolvers etc.</p>\n<p>For example, to setup ODoH you could do the following:</p>\n<details>\n<summary>\n<p>‚úîÔ∏è Click to Expand example <code>dnscrypt-proxy.toml</code> that is set up with dnsmasq as\nthe local resolver.</p>\n</summary>\n<blockquote>\n<p>‚ùóÔ∏è This isn‚Äôt the whole file, only the parts that were changed.</p>\n</blockquote>\n<pre><code class=\"language-toml\"># DNSCRYPT servers to be forwarded to anon-relays\n# server_names = ['quad9-dnscrypt-ip6-nofilter-pri', 'quad9-dnscrypt-ip4-nofilter-pri', 'quad9-dnscrypt-ip6-nofilter-ecs-pri' ]\n# ODoH servers to be forwarded to odoh-relays\nserver_names = [ 'odoh-cloudflare', 'odoh-snowstorm' ]\n\nlisten_addresses = ['127.0.0.1:53', '[::1]:53']\n\nmax_clients = 250\n\n# Use servers reachable over IPv4\nipv4_servers = true\n\n# Use servers reachable over IPv6 -- Do not enable if you don't have IPv6 connectivity\nipv6_servers = true\n\n# Use servers implementing the DNSCrypt protocol\ndnscrypt_servers = true\n\n# Use servers implementing the DNS-over-HTTPS protocol\ndoh_servers = false\n\n# Use servers implementing the Oblivious DoH protocol\nodoh_servers = true\n\n## Require servers defined by remote sources to satisfy specific properties\n\n# Server must support DNS security extensions (DNSSEC)\nrequire_dnssec = true\n\n# Server must not log user queries (declarative)\nrequire_nolog = true\n\n# Server must not enforce its own blocklist (for parental control, ads blocking...)\nrequire_nofilter = true\n\nbootstrap_resolvers = ['9.9.9.11:53', '1.1.1.1:53']\n\nfallback_resolvers = ['1.0.0.1:53', '9.9.9.9:53']\n\nignore_system_dns = true\n\n\n[sources]\n\n### An example of a remote source from https://github.com/DNSCrypt/dnscrypt-resolvers\n\n# These are just lists of resolvers to choose from\n\n[sources.public-resolvers]\nurls = [\n  'https://raw.githubusercontent.com/DNSCrypt/dnscrypt-resolvers/master/v3/public-resolvers.md',\n  'https://download.dnscrypt.info/resolvers-list/v3/public-resolvers.md',\n]\ncache_file = '/var/cache/dnscrypt-proxy/public-resolvers.md'\nminisign_key = 'RWQf6LRCGA9i53mlYecO4IzT51TGPpvWucNSCh1CBM0QTaLn73Y7GFO3'\nrefresh_delay = 73\nprefix = ''\n\n### Anonymized DNS relays\n\n[sources.relays]\nurls = [\n  'https://raw.githubusercontent.com/DNSCrypt/dnscrypt-resolvers/master/v3/relays.md',\n  'https://download.dnscrypt.info/resolvers-list/v3/relays.md',\n]\ncache_file = '/var/cache/dnscrypt-proxy/relays.md'\nminisign_key = 'RWQf6LRCGA9i53mlYecO4IzT51TGPpvWucNSCh1CBM0QTaLn73Y7GFO3'\nrefresh_delay = 73\nprefix = ''\n\n### ODoH (Oblivious DoH) servers and relays\n\n[sources.odoh-servers]\n  urls = ['https://raw.githubusercontent.com/DNSCrypt/dnscrypt-resolvers/master/v3/odoh-servers.md', 'https://download.dnscrypt.info/resolvers-list/v3/odoh-servers.md']\n  cache_file = '/var/cache/dnscrypt-proxy/odoh-servers.md'\n  minisign_key = 'RWQf6LRCGA9i53mlYecO4IzT51TGPpvWucNSCh1CBM0QTaLn73Y7GFO3'\n  refresh_delay = 73\n  prefix = ''\n[sources.odoh-relays]\n  urls = ['https://raw.githubusercontent.com/DNSCrypt/dnscrypt-resolvers/master/v3/odoh-relays.md', 'https://download.dnscrypt.info/resolvers-list/v3/odoh-relays.md']\n  cache_file = '/var/cache/dnscrypt-proxy/odoh-relays.md'\n  minisign_key = 'RWQf6LRCGA9i53mlYecO4IzT51TGPpvWucNSCh1CBM0QTaLn73Y7GFO3'\n  refresh_delay = 73\n  prefix = ''\n\n### Quad9\n\n[sources.quad9-resolvers]\n  urls = ['https://quad9.net/dnscrypt/quad9-resolvers.md', 'https://raw.githubusercontent.com/Quad9DNS/dnscrypt-settings/main/dnscrypt/quad9-resolvers.md']\n  minisign_key = 'RWTp2E4t64BrL651lEiDLNon+DqzPG4jhZ97pfdNkcq1VDdocLKvl5FW'\n  cache_file = '/var/cache/dnscrypt-proxy/quad9-resolvers.md'\n  prefix = 'quad9-'\n\n[anonymized_dns]\n\n# ODoH Server/ODoH Relay settings\nroutes = [\n    { server_name='odoh-snowstorm', via=['odohrelay-crypto-sx'] },\n    { server_name='odoh-cloudflare', via=['odohrelay-crypto-sx'] }\n]\n\n# DNSCRYPT Server/Anon-Relay Settings\n# routes = [\n#   { server_name='quad9-dnscrypt-ip6-nofilter-pri', via=['anon-cs-berlin', 'anon-cs-dus6'] },\n#   { server_name='quad9-dnscrypt-ip4-nofilter-pri', via=['sdns://gREzNy4xMjAuMjE3Ljc1OjQ0Mw'] },\n#   { server_name='quad9-dnscrypt-ip6-nofilter-ecs-pri', via=['anon-cs-de', 'anon-cs-norway6'] }\n# ]\n\n\n## Skip resolvers incompatible with anonymization instead of using them directly\nskip_incompatible = true\n</code></pre>\n<p>The only\n<a href=\"https://github.com/DNSCrypt/dnscrypt-resolvers/blob/master/v3/odoh-relays.md\">ODoH relay</a>\nlisted is <code>odohrelay-crypto-sx</code> so both ODoH servers are routed through the same\nrelay.</p>\n<p>The commented out <code>server_names</code> and <code>routes</code> are for Anonymous relays, which\nare different from oblivious relays and servers. Check the\n<a href=\"https://github.com/DNSCrypt/dnscrypt-resolvers/blob/master/v3/relays.md\">relays.md</a>\nfor different anon relays.</p>\n<p>Resources:</p>\n<details>\n<summary> ‚úîÔ∏è Click to Expand Resources </summary>\n<ul>\n<li>\n<p><a href=\"https://raw.githubusercontent.com/DNSCrypt/dnscrypt-resolvers/master/v3/public-resolvers.md\">public-resolvers v3</a></p>\n</li>\n<li>\n<p><a href=\"https://dnscrypt.info/public-servers/\">dnscrypt public-servers</a></p>\n</li>\n<li>\n<p><a href=\"https://github.com/DNSCrypt/dnscrypt-proxy/wiki/Oblivious-DoH\">Oblivious DoH</a></p>\n</li>\n<li>\n<p><a href=\"https://github.com/DNSCrypt/dnscrypt-resolvers/blob/master/v3/odoh-servers.md\">List of public ODoH servers</a></p>\n</li>\n<li>\n<p><a href=\"https://github.com/DNSCrypt/dnscrypt-resolvers/blob/master/v3/odoh-relays.md\">List of public ODoH relays</a></p>\n</li>\n<li>\n<p><a href=\"https://raw.githubusercontent.com/Quad9DNS/dnscrypt-settings/main/dnscrypt/quad9-resolvers.md\">List of quad9-resolvers</a></p>\n</li>\n<li>\n<p><a href=\"https://www.dnscry.pt/\">dnscry.pt</a></p>\n</li>\n</ul>\n</details>\n</details>\n<p>Modify <code>/etc/resolv.conf</code>:</p>\n<pre><code class=\"language-conf\">nameserver ::1\nnameserver 127.0.0.1\noptions edns0\n</code></pre>\n<p>Stop it from being overwritten:</p>\n<pre><code class=\"language-bash\">sudo chattr +i /etc/resolv.conf\n</code></pre>\n<p>Disable any services bound to port 53</p>\n<pre><code class=\"language-bash\">ss -lp 'sport = :domain'\n</code></pre>\n<pre><code class=\"language-bash\">sudo systemctl stop systemd-resolved\nsudo systemctl disable systemd-resolved\n</code></pre>\n<p>Enable <code>dnscrypt-proxy</code>:</p>\n<pre><code class=\"language-bash\">sudo systemctl enable dnscrypt-proxy\n</code></pre>\n<p><code>libvirtd</code> is another service that utilizes <code>dnsmasq</code> which uses port 53 and\nconflicts with this setup. Since dnscrypt-proxy uses port 53 by default, it\nmakes using it with <code>libvirtd</code> difficult.</p>\n<hr />\n<h2>dnsmasq as a local DNS server</h2>\n<p>Edit the <code>listen_addresses</code> in <code>/etc/dnscrypt-proxy/dnscrypt-proxy.toml</code>:</p>\n<pre><code class=\"language-toml\">listen_addresses = ['127.0.0.1:5353', '[::1]:5353']\n</code></pre>\n<p>Edit <code>/etc/dnsmasq.conf</code>:</p>\n<pre><code class=\"language-conf\">listen-address=127.0.0.1,::1\nserver=127.0.0.1#5353\nserver=::1#5353\n</code></pre>\n<pre><code class=\"language-bash\">sudo systemctl enable dnsmasq\n</code></pre>\n<pre><code class=\"language-bash\">sudo systemctl restart dnsmasq\nsudo systemctl restart dnscrypt-proxy\n</code></pre>\n<p><strong>How it Works</strong></p>\n<p>We‚Äôve created a two-step process for your DNS queries. Instead of your computer\ndirectly asking a DNS server for a website‚Äôs IP address, it now sends the\nrequest to dnsmasq first.</p>\n<ol>\n<li>\n<p>We configured dnsmasq to listen on 127.0.0.1 (our local machine). This means\nthat all DNS queries from our system are sent to dnsmasq.</p>\n</li>\n<li>\n<p>We told dnsmasq to use dnscrypt-proxy as its upstream DNS server with\n<code>server=127.0.0.1#5353</code>. So, dnsmasq gets the DNS request and immediately\nforwards it to dnscrypt-proxy, which is listening on port 5353.</p>\n</li>\n<li>\n<p>dnscrypt-proxy then takes the forwarded request, encrypts it, and sends it to\na secure DNS resolver on the internet. It receives the IP address back,\ndecrypts it, and sends it back to dnsmasq.</p>\n</li>\n<li>\n<p>Finally, dnsmasq receives the IP address from dnscrypt-proxy and sends it\nback to the program that made the original request (e.g., the browser).</p>\n</li>\n</ol>\n<h2>Add Blocklists</h2>\n<ul>\n<li><a href=\"https://github.com/DNSCrypt/dnscrypt-proxy/wiki/Filters\">dnscrypt-proxy Filters</a></li>\n</ul>\n<p>Configure filter list sources in\n<code>/usr/share/dnscrypt-proxy/utils/generate-domains-blocklist/domains-blocklist.conf</code>:</p>\n<blockquote>\n<p>‚ùóÔ∏è NOTE: Do a bit of research, all of these aren‚Äôt required and will slow down\nyour queries. You can also setup an allowlist for exceptions.</p>\n</blockquote>\n<pre><code class=\"language-conf\"># NextDNS CNAME cloaking list\nhttps://raw.githubusercontent.com/nextdns/cname-cloaking-blocklist/master/domains\n\n# AdGuard Simplified Domain Names filter\nhttps://adguardteam.github.io/AdGuardSDNSFilter/Filters/filter.txt\n\n# OISD Big list\nhttps://big.oisd.nl/domainswild\n\n# HaGeZi Multi PRO\nhttps://raw.githubusercontent.com/hagezi/dns-blocklists/main/wildcard/pro-onlydomains.txt\n\n# HaGeZi Threat Intelligence Feeds\nhttps://raw.githubusercontent.com/hagezi/dns-blocklists/main/wildcard/tif-onlydomains.txt\n</code></pre>\n<pre><code class=\"language-bash\">sudo mkdir -p /etc/dnscrypt-proxy-blocklist\nsudo cp -r /usr/share/dnscrypt-proxy/utils/generate-domains-blocklist/* /etc/dnscrypt-proxy-blocklist/\n</code></pre>\n<p>Save\n<a href=\"https://raw.githubusercontent.com/DNSCrypt/dnscrypt-proxy/master/utils/generate-domains-blocklist/generate-domains-blocklist.py\">generate-domains-blocklist.py</a>\nto <code>/usr/share/dnscrypt-proxy/utils/generate-domains-blocklist</code></p>\n<pre><code class=\"language-bash\">cd /etc/dnscrypt-proxy-blocklist\nsudo python3 generate-domains-blocklist.py -o blocklist.txt\n</code></pre>\n<p>Create a service to download &amp; combine filter lists:\n<code>/etc/systemd/system/dnscrypt-filterlist-update.service</code>:</p>\n<pre><code class=\"language-.service\">[Unit]\nDescription=DNSCrypt Filterlist Update\n\n[Service]\nType=oneshot\nExecStart=/etc/dnscrypt-proxy-blocklist/generate-domains-blocklist -a /etc/dnscrypt-proxy-blocklist/domains-allowlist.txt -o /etc/dnscrypt-proxy-blocklist/blocklist.txt\nExecStartPost=/usr/bin/sleep 2\nExecStartPost=/usr/bin/systemctl restart dnscrypt-proxy.service\n</code></pre>\n<p>Create a timer to run at boot &amp; every 5 hours.\n<code>/etc/systemd/system/dnscrypt-filterlist-update.timer</code>:</p>\n<pre><code class=\"language-.timer\">[Unit]\nDescription=Run filterlist update 15min after boot and every 5h\n\n[Timer]\nOnBootSec=15min\nOnUnitActiveSec=5h\n\n[Install]\nWantedBy=timers.target\n</code></pre>\n<pre><code class=\"language-bash\">sudo systemctl daemon-reload\nsudo systemctl enable dnscrypt-filterlist-update.timer\n</code></pre>\n<p>Configure dnscrypt-proxy to use the blocklist:</p>\n<p><code>/etc/dnscrypt-proxy/dnscrypt-proxy.toml</code>:</p>\n<pre><code class=\"language-toml\">blocked_names_file = \"/usr/share/dnscrypt-proxy/utils/generate-domains-blocklist/blocklist.txt\"\nlog_file = '/var/log/dnscrypt-proxy/blocked-names.log'\n</code></pre>\n<p>For an allow list, you create a list of names you want to allow to bypass your\nblocklist:</p>\n<pre><code class=\"language-toml\">allowed_names_file = \"/usr/share/dnscrypt-proxy/utils/generate-domains-blocklist/allowed-names.txt\"\nlog_file = \"/var/log/dnscrypt-proxy/allowed-names.log\"\n</code></pre>\n<p>Restart the service:</p>\n<pre><code class=\"language-bash\">sudo systemctl restart dnscrypt-proxy\n</code></pre>\n<p>Reboot.</p>\n<p>Verify blocklist works against an address listed in <code>blocklist.txt</code>:</p>\n<pre><code class=\"language-bash\">dig dm.csl.academy @127.0.0.1 -p 53\n</code></pre>\n<p>Output:</p>\n<pre><code class=\"language-bash\">;; ANSWER SECTION:\ndm.csl.academy.         10      IN      HINFO   \"This query has been locally blocked\" \"by dnscrypt-proxy\"\n</code></pre>\n<h2>Testing</h2>\n<p>I tested in Firefox by ensuring that in <code>Settings -&gt; Privacy &amp; Security</code> the DNS\nover HTTPS was set to <code>Status: Off</code>, Enable DNS over HTTPS using: <code>Off</code> Use your\ndefault DNS resolver.</p>\n<p>Then go to <code>https://dnsleaktest.com</code> and perform an Extended Test. If you used\nthe above configuration with Quad9‚Äôs resolvers, you should see all WoodyNet ISPs\nlisted in Germany. If not, something is wrong and you have a DNS leak.</p>\n<p>I have noticed dnsleaktest having issues lately, <code>https://ipleak.net</code> works for\nthis as well.</p>\n<h2>Enable MAC Randomization</h2>\n<pre><code class=\"language-bash\">sudo mkdir -p /etc/NetworkManager/conf.d\nsudo hx /etc/NetworkManager/conf.d/20-mac-randomization.conf\n</code></pre>\n<p>Add the following for randomization (use <code>stable</code> for consistent per-network\nMACs; change to <code>random</code> if preferred)</p>\n<pre><code class=\"language-conf\">[device]\nwifi.scan-rand-mac-address=yes\n\n[connection]\nwifi.cloned-mac-address=random\nethernet.cloned-mac-address=random\n</code></pre>\n<ul>\n<li>\n<p><code>wifi.scan-rand-mac-address=yes</code>: Enables randomization during Wi-Fi scans\n(default, but explicit for clarity).</p>\n</li>\n<li>\n<p><code>wifi.cloned-mac-address=stable</code> / <code>ethernet.cloned-mac-address=stable</code>:\nApplies to Wi-Fi and Ethernet connections.</p>\n</li>\n</ul>\n<p><strong>Verify MAC Randomization</strong></p>\n<p>Check your interface (e.g., <code>wlp3s0</code> for Wi-Fi, find with <code>ip link</code>)</p>\n<pre><code class=\"language-bash\">ip link show wlp3s0 | grep link/ether\n</code></pre>\n<pre><code class=\"language-bash\">nmcli connection down \"YourSSID\"\nnmcli connection up \"YourSSID\"\n</code></pre>\n<p>Check MAC again:</p>\n<pre><code class=\"language-bash\">cat /sys/class/net/wlp3s0/address\n</code></pre>\n<pre><code class=\"language-bash\">sudo systemctl status dnscrypt-proxy dnsmasq\n</code></pre>\n<pre><code class=\"language-bash\">nslookup example.com\n</code></pre>\n<hr />\n<p><strong>Enable dnsmasq caching</strong></p>\n<p><code>/etc/NetworkManager/dnsmasq.d/cache.conf</code>:</p>\n<pre><code class=\"language-conf\">cache-size=1000\n</code></pre>\n<hr />\n<p>This may help with IPv6 connectivity, add the following to\n<code>/etc/NetworkManager/dnsmasq.d/ipv6-listen.conf</code>:</p>\n<pre><code class=\"language-bash\">listen-address=::1\n</code></pre>\n<hr />\n<p><strong>Enable DNSSEC validation</strong>:</p>\n<p><code>/etc/NetworkManager/dnsmasq.d/dnssec.conf</code>:</p>\n<pre><code class=\"language-conf\">conf-file=/usr/share/dnsmasq/trust-anchors.conf\ndnssec\n</code></pre>\n<h2>Enable Privacy Extensions</h2>\n<p>Add this to <code>/etc/sysctl.d/40-ipv6.conf</code>:</p>\n<pre><code class=\"language-conf\"># Enable IPv6 Privacy Extensions\nnet.ipv6.conf.all.use_tempaddr = 2\nnet.ipv6.conf.default.use_tempaddr = 2\nnet.ipv6.conf.nic.use_tempaddr = 2\n</code></pre>\n<pre><code class=\"language-bash\"># find nic\nip link\nnet.ipv6.conf.wlp3s0.use_tempaddr = 2\n</code></pre>\n<pre><code class=\"language-bash\">sudo sysctl --system\n</code></pre>\n<p><code>/etc/NetworkManager/conf.d/ip6-privacy.conf</code>:</p>\n<pre><code class=\"language-conf\">[connection]\nipv6.ip6-privacy=2\n</code></pre>\n",
      "date_published": "2025-12-05T00:00:00+00:00",
      "author": {
        "name": "saylesss88"
      }
    },
    {
      "id": "/index.html",
      "url": "/index.html",
      "title": "index",
      "content_html": "",
      "date_published": "2025-12-03T00:05:27+00:00"
    },
    {
      "id": "/arch/hardening_networking.html",
      "url": "/arch/hardening_networking.html",
      "title": "Hardening Networking",
      "content_html": "<pre><code class=\"language-nix\">2 + 2\n</code></pre>\n<h1>Hardening Networking</h1>\n<p>NetworkManagers global config is <code>/etc/NetworkManager/NetworkManager.conf</code>.\nAdditional config files can be placed in <code>/etc/NetworkManager/conf.d</code>.</p>\n<p>After editing a config file, apply the changes with:</p>\n<pre><code class=\"language-bash\">sudo nmcli general reload\n</code></pre>\n<pre><code class=\"language-bash\">sudo usermod -aG network $USER\n</code></pre>\n<h2>Investigate sockets</h2>\n<p>Display all TCP Sockets with service names:</p>\n<pre><code class=\"language-bash\">ss -at\n</code></pre>\n<p>Display all TCP Sockets with port numbers:</p>\n<pre><code class=\"language-bash\">ss -atn\n</code></pre>\n<p>Display all UDP Sockets:</p>\n<pre><code class=\"language-bash\">ss -au\n</code></pre>\n<h2>Configure NetworkManager to use Quad9s DoT</h2>\n<p>Create <code>/etc/NetworkManager/system-connections/Wi-Fi.nmconnection</code>:</p>\n<pre><code class=\"language-.nmconnection\">[connection]\ndns-over-tls=2\n\n[ipv4]\ndns=9.9.9.9#dns.quad9.net;149.112.112.112#dns.quad9.net;\nignore-auto-dns=true\n\n[ipv6]\ndns=2620:fe::fe#dns.quad9.net;2620:fe::9#dns.quad9.net;\nignore-auto-dns=true\n</code></pre>\n<pre><code class=\"language-bash\">sudo systemctl restart NetworkManager\n</code></pre>\n<p><strong>Wi-Fi MAC randomization</strong></p>\n<p>Add the following to <code>/etc/NetworkManager/conf.d/wifi_rand_mac.conf</code>:</p>\n<pre><code class=\"language-conf\">[device-mac-randomization]\n# \"yes\" is already the default for scanning\nwifi.scan-rand-mac-address=yes\n\n[connection-mac-randomization]\n# Randomize MAC for every ethernet connection\nethernet.cloned-mac-address=random\n# Generate a random MAC every time you connect to a wifi network\nwifi.cloned-mac-address=random\n</code></pre>\n<p><strong>Unique DUID per connection</strong></p>\n<p>Create <code>/etc/NetworkManager/conf.d/duid.conf</code>:</p>\n<pre><code class=\"language-conf\">[connection]\nipv6.dhcp-duid=stable-uuid\n</code></pre>\n<h2>MAC Address spoofing</h2>\n<p>This section demonstrates how to spoof your Media Access Control (MAC) address.</p>\n<p><strong>Manual MAC randomization with macchanger</strong></p>\n<p>Find your device interface and check your current MAC address:</p>\n<pre><code class=\"language-bash\"># find interface\nip add\nsudo iplink show wlp3s0\n</code></pre>\n<p>The address following <code>\"link/ether\"</code> is your MAC, bring it down so we can change\nit:</p>\n<pre><code class=\"language-bash\">sudo ip link set dev wlp3s0 down\n# or\n# sudo ifconfig wlp3s0 down\n</code></pre>\n<p>Install the <code>macchanger</code> package and run:</p>\n<pre><code class=\"language-bash\">sudo macchanger -a wlp3s0\n</code></pre>\n<ul>\n<li>\n<p><code>-a</code>, <code>--another</code>: Set random vendor MAC of the same kind.</p>\n</li>\n<li>\n<p><code>-r</code>, <code>--random</code>: Set fully random MAC.</p>\n</li>\n</ul>\n<p><strong>Automatically with systemd &amp; macchanger</strong></p>\n<p>systemd unit setting a random address while preserving the original NIC vendor\nbytes.</p>\n<p>Create <code>/etc/systemd/system/macspoof@.service</code>:</p>\n<pre><code class=\"language-macspoof@.service\">[Unit]\nDescription=macchanger on %I\nWants=network-pre.target\nBefore=network-pre.target\nBindsTo=sys-subsystem-net-devices-%i.device\nAfter=sys-subsystem-net-devices-%i.device\n\n[Service]\nExecStart=/usr/bin/macchanger -e %I\nType=oneshot\n\n[Install]\nWantedBy=multi-user.target\n</code></pre>\n<ul>\n<li>\n<p>You can use <code>-r</code> to randomize everything but it‚Äôs important that the vendor\nbytes actually match something and aren‚Äôt just random numbers so it‚Äôs less\nrecommended.</p>\n</li>\n<li>\n<p>The <code>@.service</code> pattern allows per-interface instantiation like\n<code>macspoof@wlp3s0.service</code>.</p>\n</li>\n<li>\n<p>The <code>%I</code> variable automatically resolves to your interface name.</p>\n</li>\n<li>\n<p>You only need to append your interface name when enabling the service.</p>\n</li>\n</ul>\n<pre><code class=\"language-bash\">sudo systemctl enable macspoof@wlp3s0.service\n</code></pre>\n<h2>Resources</h2>\n<ul>\n<li>\n<p><a href=\"https://www.kicksecure.com/wiki/MAC_Address\">KickSecure MAC_address</a></p>\n</li>\n<li>\n<p><a href=\"https://wiki.archlinux.org/title/MAC_address_spoofing\">Arch Wiki MAC address spoofing</a></p>\n</li>\n<li>\n<p><a href=\"https://tldp.org/LDP/nag2/index.html\">Linux Network Admin Guide</a></p>\n</li>\n<li>\n<p><a href=\"https://wiki.archlinux.org/title/NetworkManager\">Arch Wiki NetworkManager</a></p>\n</li>\n</ul>\n",
      "date_published": "2025-11-28T00:00:00+00:00",
      "author": {
        "name": "saylesss88"
      }
    },
    {
      "id": "/arch/enc_install.html",
      "url": "/arch/enc_install.html",
      "title": "Encrypted Arch Install",
      "content_html": "<h1>Encrypted Arch Install for UEFI Systems with UKI and Secure Boot</h1>\n<details>\n<summary> ‚úîÔ∏è Click to Expand Table of Contents</summary>\n<!-- toc -->\n</details>\n<p>The ultimate installation resource is always goint to be the:</p>\n<ul>\n<li>\n<p><a href=\"https://wiki.archlinux.org/title/Installation_guide\">Arch Wiki Installation Guide</a></p>\n</li>\n<li>\n<p><a href=\"https://archlinux.org/download/#checksums\">Verify PGP Signatures</a>, the ISO\ndirectory is just the same directory where your Arch Linux ISO file is stored.</p>\n</li>\n</ul>\n<blockquote>\n<p>Always review the Wiki and never just plug random things suggested by me or\nanyone else without first doing your own research.</p>\n</blockquote>\n<p>Edited: 09-25-25 Removed encrypted swap section. Big usability downside IMO.</p>\n<details>\n<summary> ‚úîÔ∏è Verifying Arch Linux ISO on Other Distributions </summary>\n<blockquote>\n<p>‚ùó NOTE: If you only want to verify the ISO once, you can temporarily import\nthe public key, verify the signature, and then you don‚Äôt need to keep the key\npermanently in your keyring or sign it locally. This example is from the last\nrelease, but the process is the same.</p>\n</blockquote>\n<p>With <code>sequoia-sq</code>, you can get the Arch release signing key with:</p>\n<pre><code class=\"language-bash\">sq network wkd search pierre@archlinux.org --output release-key.pgp\n</code></pre>\n<p>Export the chosen key to a <code>.pgp</code> file:</p>\n<pre><code class=\"language-bash\">sq cert export --keyring=release-key.pgp --cert=3E80CA1A8B89F69CBA57D98A76A5EF9054449A5C &gt; pierre-archlinux.pgp\n</code></pre>\n<p>Import into your keychain:</p>\n<pre><code class=\"language-bash\">gpg --import pierre-archlinux.pgp\ngpg: key 0x76A5EF9054449A5C: 9 signatures not checked due to missing keys\ngpg: key 0x76A5EF9054449A5C: public key \"Pierre Schmitz &lt;pierre@archlinux.org&gt;\" imported\ngpg: Total number processed: 1\ngpg:               imported: 1\ngpg: marginals needed: 3  completes needed: 1  trust model: pgp\ngpg: depth: 0  valid:   3  signed:   0  trust: 0-, 0q, 0n, 0m, 0f, 3u\ngpg: next trustdb check due at 2026-08-23\n</code></pre>\n<ul>\n<li>Now, you should see <code>&lt;pierre@archlinux.org&gt;</code> and his keys when you run\n<code>gpg --list-keys</code></li>\n</ul>\n<p>Finally, verify the signature:</p>\n<pre><code class=\"language-bash\">sq verify --signer-file release-key.pgp --signature-file archlinux-2025.08.01-x86_64.iso.sig archlinux-2025.08.01-x86_64.iso\nAuthenticated signature made by 3E80CA1A8B89F69CBA57D98A76A5EF9054449A5C (Pierre Schmitz &lt;pierre@archlinux.org&gt;)\n\n1¬†authenticated signature.\n</code></pre>\n<blockquote>\n<p>‚ùó To ensure the key is authentic and not spoofed, verify that the key\nfingerprint matches the official Arch Linux signing key fingerprint, which can\nis linked below and on the Arch website.</p>\n</blockquote>\n<p>This shows that the signature was made by the key with the ID\n<code>3E80CA1A8B89F69CBA57D98A76A5EF9054449A5C (Pierre Schmitz)</code></p>\n<p>You can check the keys fingerprint with:</p>\n<pre><code class=\"language-bash\">gpg --fingerprint 3E80CA1A8B89F69CBA57D98A76A5EF9054449A5C\n</code></pre>\n<ul>\n<li>Verify it against the\n<a href=\"https://archlinux.org/master-keys/\">Arch Linux master-keys</a></li>\n</ul>\n<p>Verify it against the Arch Linux master-keys</p>\n<p>With the <code>sq verify</code> command GPG authenticated that the signature is valid and\nthat the key used to sign is trusted in our keyring.</p>\n<p><code>1 authenticated signature</code> confirms the files integrity and authenticity.</p>\n<p>We have successfully verified that the file was signed by Pierr‚Äôs official Arch\nLinux key and has not been tampered with.</p>\n<p>The following is only if you currently already have keys on your gpg keyring.</p>\n<details>\n<summary> ‚òëÔ∏è Click to expand Key Signing and Publishing Example </summary>\n<p>List your keys to get the arch keyID:</p>\n<pre><code class=\"language-bash\">gpg --list-keys\n# ... snip ...\npub   ed25519/0x76A5EF9054449A5C 2022-10-31 [SC] [expires: 2037-10-27]\n      Key fingerprint = 3E80 CA1A 8B89 F69C BA57  D98A 76A5 EF90 5444 9A5C\nuid                   [  full  ] Pierre Schmitz &lt;pierre@archlinux.org&gt;\nuid                   [  full  ] Pierre Schmitz &lt;pierre@archlinux.de&gt;\nsub   ed25519/0xD6D13C45BFCFBAFD 2022-10-31 [A] [expires: 2037-10-27]\nsub   cv25519/0x7F56ADE50CA3D899 2022-10-31 [E] [expires: 2037-10-27]\n</code></pre>\n<p>Sign the key:</p>\n<pre><code class=\"language-bash\">gpg --sign-key 0x76A5EF9054449A5C\n</code></pre>\n<p>Now you can export and publish the new public key and send it to a keyserver:</p>\n<pre><code class=\"language-bash\">gpg --export --armor 0x76A5EF9054449A5C &gt; archlinux-signed.asc\ngpg --send-keys 0x76A5EF9054449A5C\n</code></pre>\n<p>The more people that verify, sign, and re-export and publish their keys the\nbetter for the web of trust that gpg uses making the network more secure for\neveryone.</p>\n</details>\n</details>\n<hr />\n<ol>\n<li><strong>Connect to Wi-Fi</strong>:</li>\n</ol>\n<pre><code class=\"language-bash\">iwctl\n[iwd]# device list\n[iwd]# station wlan0 scan\n[iwd]# station wlan0 connect NETGEAR80\n# Enter your Password\n# Check Connection\n[iwd]# station wlan0 show\n[iwd]# exit\n</code></pre>\n<pre><code class=\"language-bash\">ping -c 3 archlinux.org\n</code></pre>\n<hr />\n<ol start=\"2\">\n<li><strong>Update package databases and mirrorlist</strong>:</li>\n</ol>\n<pre><code class=\"language-bash\">pacman -Syyu\n</code></pre>\n<p>Save a backup of your current mirrorlist so we can safely update it:</p>\n<pre><code class=\"language-bash\">cp /etc/pacman.d/mirrorlist /etc/pacman.d/mirrorlist.bak\n</code></pre>\n<pre><code class=\"language-bash\">pacman -S reflector\nreflector --list-countries\n# Example if you live in the US\nreflector -c US --protocol https --age 6 --fastest 5 --sort rate --save /etc/pacman.d/mirrorlist\n</code></pre>\n<p>This actually improves security by only providing <code>HTTPS</code> mirrors, by default\nboth HTTP and HTTPS are used.</p>\n<p>NOTE: This can take a bit and you can expect some failures..</p>\n<hr />\n<ol start=\"3\">\n<li><strong>Set keyboard layout, font, and system clock</strong>:</li>\n</ol>\n<p>Default keymap is US, if you need something different:</p>\n<pre><code class=\"language-bash\">localectl list-keymaps\nloadkeys &lt;chosen-map&gt;\n# Increase font size\nsetfont ter-132b\n</code></pre>\n<pre><code class=\"language-bash\">sudo pacman -S chrony\n</code></pre>\n<p><code>/etc/chrony.conf</code>:</p>\n<pre><code class=\"language-conf\"># Copyright ¬© 2014-2025 GrapheneOS\n\n# Permission is hereby granted, free of charge, to any person obtaining a copy\n# of this software and associated documentation files (the \"Software\"), to deal\n# in the Software without restriction, including without limitation the rights\n# to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n# copies of the Software, and to permit persons to whom the Software is\n# furnished to do so, subject to the following conditions:\n\n# The above copyright notice and this permission notice shall be included in\n# all copies or substantial portions of the Software.\n\n# THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n# AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n# OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n# THE SOFTWARE.\n\nserver time.cloudflare.com iburst nts\nserver ntppool1.time.nl iburst nts\nserver nts.netnod.se iburst nts\nserver ptbtime1.ptb.de iburst nts\nserver time.dfm.dk iburst nts\nserver time.cifelli.xyz iburst nts\n\nminsources 3\nauthselectmode require\n\n# EF\ndscp 46\n\ndriftfile /var/lib/chrony/drift\ndumpdir /var/lib/chrony\nntsdumpdir /var/lib/chrony\n\nleapseclist /usr/share/zoneinfo/leap-seconds.list\nmakestep 1.0 3\n\nrtconutc\nrtcsync\n\ncmdport 0\n\nnoclientlog\n</code></pre>\n<p>The above setup uses Network Time Security (NTS) and is a more modern safer way\nto synchronize time using chrony.</p>\n<pre><code class=\"language-bash\">sudo systemctl disable --now systemd-timesyncd\nsudo systemctl enable --now chronyd\n</code></pre>\n<pre><code class=\"language-bash\">timedatectl set-ntp true\ntimedatectl list-timezones\n# Example\nsudo timedatectl set-timezone America/New_York\n</code></pre>\n<hr />\n<ol start=\"4\">\n<li><strong>Partition your Disk</strong>:</li>\n</ol>\n<p>The only required partitions are one for the root directory <code>/</code> (typically <code>1G</code>)\nand one for booting in UEFI mode, an EFI system partition (typically the rest of\nthe space left).</p>\n<p>In this section, I‚Äôll assume that you‚Äôre starting with a clean slate. If you‚Äôre\nnot, you can use your existing partitions if they meet the above requirements or\ndelete them.</p>\n<p>To delete existing partitions with <code>cfdisk</code>, you launch it on the target\nfilesystem, select the partition you want to delete and Select -&gt; <code>[ Delete ]</code>\nuntil all you see is <code>Free space</code> and a clean slate and <code>[ Write ]</code> &amp; <code>[ Quit ]</code>\nto save your changes.</p>\n<p>Identify your target disk (e.g., <code>/dev/nvme0n1</code>):</p>\n<pre><code class=\"language-bash\">fdisk -l\n</code></pre>\n<pre><code class=\"language-bash\">cfdisk /dev/nvme0n1\n</code></pre>\n<ul>\n<li>\n<p>Select -&gt; <code>[ Free Space ]</code></p>\n<ul>\n<li>\n<p>Select -&gt; <code>[ New ]</code></p>\n</li>\n<li>\n<p>Partition size: <code>1G</code></p>\n</li>\n<li>\n<p>Type -&gt; <code>EFI System</code></p>\n</li>\n</ul>\n</li>\n<li>\n<p>Select -&gt; <code>[ Free Space ]</code></p>\n<ul>\n<li>\n<p>Partition size: The rest of the space</p>\n</li>\n<li>\n<p>Type -&gt; <code>Linux filesystem</code></p>\n</li>\n<li>\n<p>Select -&gt; <code>[ Write ]</code></p>\n</li>\n<li>\n<p>Select -&gt; <code>[ Quit ]</code></p>\n</li>\n</ul>\n</li>\n</ul>\n<hr />\n<ol start=\"5\">\n<li><strong>Format the EFI partition as FAT32</strong>:</li>\n</ol>\n<pre><code class=\"language-bash\">mkfs.fat -F32 /dev/nvme0n1p1\n</code></pre>\n<p>Leave the root partition unformatted for the next step.</p>\n<hr />\n<ol start=\"6\">\n<li><strong>Encrypt the Root partition and Open it</strong>:</li>\n</ol>\n<pre><code class=\"language-bash\">cryptsetup luksFormat /dev/nvme0n1p2\ncryptsetup open /dev/nvme0n1p2 cryptroot\n</code></pre>\n<p>Create a filesystem:</p>\n<pre><code class=\"language-bash\">mkfs.btrfs /dev/mapper/cryptroot\n</code></pre>\n<p>If you mount the filesystem with compression before running <code>genfstab</code>, it will\nautomatically add the chosen compression to the <code>fstab</code>.</p>\n<pre><code class=\"language-bash\">mount /dev/nvme0n1p1 /mnt/boot  # Mount EFI partition at /mnt/boot\nmount -o compress=zstd /dev/mapper/cryptroot /mnt\n</code></pre>\n<hr />\n<h2>Install the Base System on <code>/mnt</code> with <code>pacstrap</code></h2>\n<p>If you prefer Nvim or a hardened kernel, change it here.</p>\n<pre><code class=\"language-bash\">pacstrap -K /mnt base linux-zen linux-zen-headers linux-firmware networkmanager helix lightdm lightdm-gtk-greeter btrfs-progs cryptsetup sudo base-devel efibootmgr systemd-ukify\n</code></pre>\n<hr />\n<ol start=\"7\">\n<li><strong>Generate the Filesystem Table</strong>:</li>\n</ol>\n<p>The EFI and root partitions need to be mounted before you generate the\nfilesystem table in the next step.</p>\n<pre><code class=\"language-bash\">genfstab -U /mnt &gt;&gt; /mnt/etc/fstab\n#\nhx /mnt/etc/fstab\ncat /mnt/etc/fstab\n</code></pre>\n<p>Fix security hole and harden <code>/boot</code> permissions by adding\n<code>fmask=0137, dmask=0027</code>:</p>\n<pre><code class=\"language-bash\">hx /mnt/etc/fstab\n</code></pre>\n<p>Example</p>\n<pre><code class=\"language-fstab\"># Static information about the filesystems.\n# See fstab(5) for details.\n\n# &lt;file system&gt; &lt;dir&gt; &lt;type&gt; &lt;options&gt; &lt;dump&gt; &lt;pass&gt;\n# /dev/mapper/cryptroot\nUUID=6d68a2bf-34ea-4adc-86d5-cb1d56de44a4\t/         \tbtrfs     \trw,relatime,compress=zstd:3,ssd,space_cache=v2,subvol=/\t0 0\n\n# /dev/nvme0n1p1\nUUID=B88B-844F      \t/boot     \tvfat      \trw,relatime,fmask=0137,dmask=0027,codepage=437,iocharset=ascii,shortname=mixed,utf8,errors=remount-ro\t0 2\n</code></pre>\n<pre><code class=\"language-bash\">chmod 700 /boot\nchmod 600 /boot/loader/random-seed\n</code></pre>\n<p><strong>Important</strong>: The <code>fstab</code> should list both partitions, if it doesn‚Äôt you‚Äôll\nneed to ensure both partitions are mounted and regenerate your fstab again with\n<code>genfstab</code>. Also ensure that the root partition was mounted with compression.</p>\n<hr />\n<ol start=\"8\">\n<li><strong>Change Root (<code>chroot</code>) into the New Installation</strong></li>\n</ol>\n<pre><code class=\"language-bash\">arch-chroot /mnt\n</code></pre>\n<p>Create a user:</p>\n<pre><code class=\"language-bash\">useradd -m -G wheel -s /bin/bash yourusername\npasswd yourusername\n</code></pre>\n<p>Create an admin password:</p>\n<pre><code class=\"language-bash\">passwd\n</code></pre>\n<p>Enable sudo for wheel group:</p>\n<p>In <code>/etc/sudoers</code> uncomment the line:</p>\n<pre><code class=\"language-bash\">%wheel ALL=(ALL:All) ALL\n</code></pre>\n<hr />\n<ol start=\"9\">\n<li>Edit <code>/etc/mkinitcpio.conf</code> in the new system to add an <code>sd-encrypt</code> hook\nbefore the <code>filesystems</code> attribute.</li>\n</ol>\n<ul>\n<li>\n<p>Locate the <code>HOOKS</code> line</p>\n</li>\n<li>\n<p>Insert <code>encrypt</code> <strong>before</strong> filesystems</p>\n</li>\n</ul>\n<pre><code class=\"language-bash\">vim /etc/mkinitcpio.conf\n</code></pre>\n<p>To use <code>sd-encrypt</code>, it is necessary to replace <code>udev</code> with <code>systemd</code> and if you\nrequire a different keyboard layout from US <code>sd-vconsole</code> is needed.</p>\n<pre><code class=\"language-bash\"># mkinitcpio.conf\n# *IF* you use an nvme drive\nMODULES=(nvme)\nFILES=(/etc/crypttab.initramfs /etc/vconsole.conf)\n# ... snip ...\nHOOKS=(base systemd autodetect microcode modconf kms keyboard keymap consolefont sd-vconsole block sd-encrypt filesystems fsck systemd-ukify)\n# ... snip ...\n</code></pre>\n<p>Create <code>/etc/crypttab.initramfs</code>:</p>\n<pre><code class=\"language-initramfs\">cryptroot UUID=your-uuid none luks,discard\n</code></pre>\n<hr />\n<p>Create <code>/etc/vconsole.conf</code>:</p>\n<p>For example <code>KEYMAP=fr</code> is french</p>\n<pre><code class=\"language-conf\">KEYMAP=us\nFONT=lat9w-16\n</code></pre>\n<hr />\n<p>Edit <code>/etc/mkinitcpio.d/linux-zen.preset</code>, this enables <code>mkinitcpio -P</code> to\ngenerate a UKI in <code>/boot/EFI/Linux/</code>:</p>\n<pre><code class=\"language-preset\"># mkinitcpio preset file for the 'linux-zen' package\n\nALL_config=\"/etc/mkinitcpio.conf\"\nALL_kver=\"/boot/vmlinuz-linux-zen\"\n\nPRESETS=('default' 'fallback')\n# PRESETS=('default')\n\n# default_config=\"/etc/mkinitcpio.conf\"\n# default_image=\"/boot/initramfs-linux-zen.img\"\ndefault_uki=\"/boot/EFI/Linux/arch-linux-zen.efi\"\ndefault_options=\"--splash /usr/share/systemd/bootctl/splash-arch.bmp\"\n\n#fallback_config=\"/etc/mkinitcpio.conf\"\n#fallback_image=\"/boot/initramfs-linux-zen-fallback.img\"\nfallback_uki=\"/boot/EFI/Linux/arch-linux-zen-fallback.efi\"\nfallback_options=\"-S autodetect\"\n</code></pre>\n<p>Generate the initial RAM Filesystem (initramfs) image.</p>\n<pre><code class=\"language-bash\">mkinitcpio -P\n</code></pre>\n<blockquote>\n<p>‚ùóÔ∏è TIP: If <code>mkinitcpio -P</code> fails, exit <code>arch-chroot</code> and ensure both the boot\n&amp; root partitions are mounted. <code>arch-chroot</code> back into <code>/mnt</code> and try again.\nEnsure that <code>/boot/EFI/Linux/arch-linux-zen.efi</code> and\n<code>/boot/EFI/Linux/arch-linux-zen-fallback.efi</code> exist for your kernel of choice.</p>\n</blockquote>\n<hr />\n<ol start=\"10\">\n<li><strong>Install systemd-boot and setup Unified Kernel Image</strong>, (while still in\nchroot environment):</li>\n</ol>\n<p>Ensure your UEFI variables are accessible:</p>\n<pre><code class=\"language-bash\">efivar --list\n</code></pre>\n<p>This command won‚Äôt work if both partitions aren‚Äôt mounted, ensure they are both\nmounted and if it still doesn‚Äôt work you can use <code>--esp-path=/boot</code> or\n<code>--esp-path=/mnt/boot</code>.</p>\n<pre><code class=\"language-bash\">bootctl install\n</code></pre>\n<p>Edit <code>/etc/kernel/cmdline</code> and add the output of <code>blkid</code> on your root partition.\nFor example:</p>\n<pre><code class=\"language-bash\">blkid /dev/nvme0n1p2 &gt; /tmp/uuid.txt\n</code></pre>\n<p>When you open <code>/etc/kernel/cmdline</code> in vim or helix, run <code>:r /tmp/uuid.txt</code> to\nread the UUID of your root partition into the file. You only need the numbers\nlike so:</p>\n<pre><code class=\"language-cmdline\">rd.luks.name=7b78e942-f4f7-4dde-a015-3a816305483f=cryptroot root=/dev/mapper/cryptroot rw\n</code></pre>\n<p>In the above example, <code>7b78e942-f4f7-4dde-a015-3a816305483f</code> is the UUID\nextracted from the <code>blkid</code> command.</p>\n<p>Create a <code>/boot/loader/entries/arch.conf</code> with the following:</p>\n<pre><code class=\"language-conf\">title Arch Linux\nlinux /vmlinuz-linux-zen\ninitrd /initramfs-linux-zen.img\noptions rd.luks.name=7b78e942-f4f7-4dde-a015-3a816305483f=cryptroot root=/dev/mapper/cryptroot rw quiet\n</code></pre>\n<blockquote>\n<p>‚ùóÔ∏è NOTE: The <code>arch.conf</code> here is redundant because <code>systemd-boot</code> is\nconfigured to autodetect the UKI. It doesn‚Äôt hurt to add it though and can\nprevent issues in the future. Ensure <code>rd.luks.name=</code> contains the UUID from\nthe encrypted root partition. (e.g., <code>blkid /dev/nvme0n1p2</code>).</p>\n</blockquote>\n<p>And finally, a <code>/boot/loader/loader.conf</code>:</p>\n<pre><code class=\"language-conf\">default arch.conf\n# default @saved  # return to last choice\ntimeout 4\nconsole-mode auto\nauto-entries 1\n</code></pre>\n<pre><code class=\"language-bash\">bootctl status\n</code></pre>\n<p>Set a password to protect <code>systemd-boot</code> with <code>systemd-boot-password</code>:</p>\n<pre><code class=\"language-bash\">paru -S systemd-boot-password\n</code></pre>\n<pre><code class=\"language-bash\">sudo sbpctl install /boot\n</code></pre>\n<p>You will now be prompted for your password before you can edit kernel\nparameters.</p>\n<hr />\n<p><strong>systemd-ukify and the Unified Kernel Image</strong>:</p>\n<p>We already added <code>systemd-ukify</code> in the pacstrap command, let‚Äôs add a few more\ntools for this process:</p>\n<pre><code class=\"language-bash\">sudo pacman -S sbsigntools efitools\n</code></pre>\n<p>Copy the existing template to <code>/etc/kernel/uki.conf</code>:</p>\n<pre><code class=\"language-bash\">cp /usr/lib/kernel/uki.conf /etc/kernel/uki.conf\n</code></pre>\n<p>Edit <code>/etc/kernel/uki.conf</code>:</p>\n<pre><code class=\"language-conf\">[UKI]\n#Initrd=\n#Microcode=\n#Splash=\n#PCRPKey=\n#PCRBanks=\n#SecureBootSigningTool=\nSecureBootPrivateKey=/etc/kernel/secure-boot-private-key.pem\nSecureBootCertificate=/etc/kernel/secure-boot-certificate.pem\n#SecureBootCertificateDir=\n#SecureBootCertificateName=\n#SecureBootCertificateValidity=\n#SigningEngine=\nSignKernel=yes\n</code></pre>\n<p>Generate your signing keys:</p>\n<pre><code class=\"language-bash\">ukify genkey --config /etc/kernel/uki.conf\n</code></pre>\n<p>The above command creates <code>/etc/kernel/secure-boot-certificate.pem</code> and\n<code>/etc/kernel/secure-boot-private-key.pem</code>.</p>\n<p>Building the UKIs:</p>\n<pre><code class=\"language-bash\">mkdir -p /boot/EFI/Linux\nmkinitcpio -P\n# Output\nWrote signed /boot/EFI/Linux/arch-linux-zen.efi\n==&gt; Unified kernel image generation successful\n</code></pre>\n<p>Sign the boot loader with the new keys:</p>\n<pre><code class=\"language-bash\">/usr/lib/systemd/systemd-sbsign sign \\\n--private-key /etc/kernel/secure-boot-private-key.pem \\\n--certificate /etc/kernel/secure-boot-certificate.pem \\\n--output /usr/lib/systemd/boot/efi/systemd-bootx64.efi.signed \\\n/usr/lib/systemd/boot/efi/systemd-bootx64.efi\n</code></pre>\n<p>Output:</p>\n<pre><code class=\"language-text\">Wrote signed PE binary to /usr/lib/systemd/boot/efi/systemd-bootx64.efi.signed\n</code></pre>\n<pre><code class=\"language-bash\">sudo bootctl install --secure-boot-auto-enroll yes \\\n--certificate /etc/kernel/secure-boot-certificate.pem \\\n--private-key /etc/kernel/secure-boot-private-key.pem\n</code></pre>\n<p>Output:</p>\n<pre><code class=\"language-text\">Copied \"/usr/lib/systemd/boot/efi/systemd-bootx64.efi.signed\" to \"/boot/EFI/systemd/systemd-bootx64.efi\".\n    3 Copied \"/usr/lib/systemd/boot/efi/systemd-bootx64.efi.signed\" to \"/boot/EFI/BOOT/BOOTX64.EFI\".\n    4 ‚ö†Ô∏è  Mount point '/boot' which backs the random seed file is world accessible, which is a security hole!  ‚ö†Ô∏è\n    5 ‚ö†Ô∏è Random seed file '/boot/loader/random-seed' is world accessible, which is a security hole! ‚ö†Ô∏è\n    6 Random seed file /boot/loader/random-seed successfully refreshed (32 bytes).\n    7 Secure boot auto-enrollment file /boot/loader/keys/auto/PK.auth successfully written.\n    8 Secure boot auto-enrollment file /boot/loader/keys/auto/KEK.auth successfully written.\n    9 Secure boot auto-enrollment file /boot/loader/keys/auto/db.auth successfully written.\n   10 Created EFI boot entry \"Linux Boot Manager\".\n</code></pre>\n<p>Fix the security hole:</p>\n<pre><code class=\"language-bash\">chmod 700 /boot\n</code></pre>\n<p>Add the following to your <code>/boot/loader/loader.conf</code>:</p>\n<pre><code class=\"language-conf\">secure-boot-enroll force\n</code></pre>\n<p>Reboot into setup-mode and it will start an automatic countdown where it enrolls\nyour keys when the time runs out.</p>\n<p>After successful key enrollment, reboot into UEFI again, enable Secure Boot and\nreboot.</p>\n<p>When the desktop launches, check the output of <code>bootctl status</code> to ensure\n<code>Secure Boot: enabled (user)</code></p>\n<p>If your system doesn‚Äôt accept them, you may have to do some conversions. You can\nalso add the keys manually which is what I did.</p>\n<details>\n<summary> ‚úîÔ∏è Click to Expand conversion Examples </summary>\n<pre><code class=\"language-bash\"># Create workspace for certs and outputs\nmkdir -p ~/secureboot/output\n\n# Define certificate location\nCERT_PEM=\"/etc/kernel/secure-boot-certificate.pem\"\n\n# Convert PEM cert to DER format for UEFI enrollment\nsudo openssl x509 -in $CERT_PEM -out ~/secureboot/output/db.cer -outform DER\n\n# Convert PEM cert to EFI Signature List\ncert-to-efi-sig-list $CERT_PEM ~/secureboot/output/db.esl\n\n# Sign the Signature List (run from wherever your private key is; do not copy it)\nsudo sign-efi-sig-list -k /etc/kernel/secure-boot-private-key.pem -c $CERT_PEM db \\\n    ~/secureboot/output/db.esl ~/secureboot/output/db.auth\n</code></pre>\n<p>Manual Key Enrollment:</p>\n<ul>\n<li>\n<p><code>db.cer</code> -&gt; enroll in db (Trusted Signatures), Choose the desired drive, find\nthe file and add it. Save as an <code>Authorized Signature</code> instead of <code>Public Key</code></p>\n</li>\n<li>\n<p><code>PK.cer</code> -&gt; enroll in <code>Platform Key</code>(PK)</p>\n</li>\n<li>\n<p>Keep your <code>secure-boot-private-key.pem</code> <strong>private</strong>, with the above commands\nwe only use it when signing, and otherwise keep it protected.</p>\n</li>\n</ul>\n</details>\n<hr />\n<ol start=\"11\">\n<li><strong>Enable LightDM and NetworkManager</strong></li>\n</ol>\n<pre><code class=\"language-bash\">systemctl enable lightdm\nsystemctl enable NetworkManager\n</code></pre>\n<blockquote>\n<p>‚ùóÔ∏è NOTE: If you‚Äôre ever unable to run the above commands in the chroot\nenvironment, exit chroot and run:</p>\n<pre><code class=\"language-bash\">systemctl --root=/mnt enable lightdm\nsystemctl --root=/mnt enable NetworkManager\n</code></pre>\n</blockquote>\n<p>Configure LightDM greeter, edit <code>/etc/lightdm/lightdm.conf</code> to add:</p>\n<pre><code class=\"language-conf\"># lightdm.conf\n[Seat:*]\ngreeter-session=lightdm-gtk-greeter\n</code></pre>\n<p>Exit <code>arch-chroot</code> with <code>exit</code></p>\n<p>Unmount your partitions and reboot:</p>\n<pre><code class=\"language-bash\">umount /mnt/boot\numount /mnt\ncryptsetup close cryptroot\n</code></pre>\n<hr />\n<ol start=\"12\">\n<li><strong>Reboot</strong></li>\n</ol>\n<pre><code class=\"language-bash\">bootctl status\nSystem:\n      Firmware: UEFI 2.70 (American Megatrends)\n Firmware Arch: x64\n   Secure Boot: enabled (user)\n  TPM2 Support: yes\n  Measured UKI: yes\n  Boot into FW: supported\n</code></pre>\n<hr />\n<h3>Creating a readonly snapshot of your root subvolume:</h3>\n<ul>\n<li><a href=\"https://wiki.archlinux.org/title/System_backup\">Arch Wiki System Backup</a></li>\n</ul>\n<details>\n<summary> ‚úîÔ∏è Click to Expand snapshot & Backup Example </summary>\n<ol>\n<li>Create readonly snapshot of root subvol:</li>\n</ol>\n<pre><code class=\"language-bash\">sudo btrfs subvolume snapshot -r / /root-snapshot-$(date +%Y%m%d%H%M%S)\n</code></pre>\n<ol start=\"2\">\n<li>Mount your external backup disk:</li>\n</ol>\n<pre><code class=\"language-bash\">sudo mkdir -p /mnt/backup\nsudo mount /dev/sdc1 /mnt/backup\n</code></pre>\n<ol start=\"3\">\n<li>Use rsync to copy the snapshot to the external drive:</li>\n</ol>\n<p>List the available snapshots and get the exact name:</p>\n<pre><code class=\"language-bash\">sudo btrfs subvolume list /\n</code></pre>\n<pre><code class=\"language-bash\">sudo rsync -aAXv --delete --progress /root-snapshot-20251002135000/ /mnt/backup/root-backup/\n</code></pre>\n<ol start=\"4\">\n<li>Unmount the external drive:</li>\n</ol>\n<pre><code class=\"language-bash\">sudo umount /mnt/backup\n</code></pre>\n<ol start=\"5\">\n<li>Optionally, delete older snapshots to save space:</li>\n</ol>\n<pre><code class=\"language-bash\">sudo btrfs subvolume delete /root-snapshot-OLD_TIMESTAMP\n</code></pre>\n<h3>Restoring from a Backup</h3>\n<p>For this, you mount the partitions but don‚Äôt need to <code>arch-chroot</code> in.</p>\n<ol>\n<li>\n<p>Boot from a live USB</p>\n</li>\n<li>\n<p>Mount your encrypted root partition (unlock if encrypted) and the external\nbackup drive.</p>\n</li>\n<li>\n<p>Move or delete the corrupted data on the root partition.</p>\n</li>\n<li>\n<p>Use rsync to copy the backed-up snapshot from the external disk back to the\nroot partition, preserving permissions and attributes.</p>\n</li>\n</ol>\n<pre><code class=\"language-bash\">sudo rsync -aAXv --delete /mnt/backup/root-backup/ /\n</code></pre>\n<p>Or, the Wiki‚Äôs suggestion, (Much more efficient, Direct backup of a running\nsystem without the need for btrfs snapshots):</p>\n<pre><code class=\"language-bash\">sudo rsync -aAXHv --exclude='/dev/*' --exclude='/proc/*' --exclude='/sys/*' --exclude='/tmp/*' --exclude='/run/*' --exclude='/mnt/*' --exclude='/media/*' --exclude='/lost+found/' / /path/to/backup\n</code></pre>\n<ul>\n<li>\n<p><code>/mnt/backup/root-backup/</code> is the path where the backup snapshot is mounted on\nthe external disk.</p>\n</li>\n<li>\n<p><code>/</code> is the root partition mount point where you want to restore the files.</p>\n</li>\n<li>\n<p>The options:</p>\n<ul>\n<li>\n<p><code>-a</code> archive mode to preserve symbolic links, permissions, timestamps, etc.</p>\n</li>\n<li>\n<p><code>-A</code> preserve ACLs (access control lists).</p>\n</li>\n<li>\n<p><code>-X</code> preserve extended attributes.</p>\n</li>\n<li>\n<p><code>-v</code> verbose output.</p>\n</li>\n<li>\n<p><code>--delete</code> deletes files on the destination that don‚Äôt exist in the source,\nkeeping an exact mirror.</p>\n</li>\n</ul>\n</li>\n</ul>\n<p>If you want to restore a specific snapshot directory (e.g.,\n<code>/root-snapshot-20251002135000</code>), replace the source path accordingly, like:</p>\n<pre><code class=\"language-bash\">sudo rsync -aAXv --delete /mnt/backup/root-snapshot-20251002135000/ /\n</code></pre>\n<ul>\n<li><a href=\"https://wiki.archlinux.org/title/Rsync#As_a_backup_utility\">Arch Wiki rsync</a></li>\n</ul>\n<ol start=\"5\">\n<li>\n<p>Reinstall the bootloader if necessary.</p>\n</li>\n<li>\n<p>Unmount everything and reboot.</p>\n</li>\n</ol>\n<h3>Automated backup</h3>\n<p>Create <code>/etc/cron.daily/backup</code>:</p>\n<pre><code class=\"language-backup\">#!/bin/sh\nrsync -a --delete --quiet /path/to/backup /location/of/backup\n</code></pre>\n<p>Change <code>/path/to/backup</code> to what needs to be backed-up such as <code>/home</code> or <code>/</code></p>\n</details>\n<hr />\n<h3>arch-chroot</h3>\n<details>\n<summary>  ‚úîÔ∏è Click to Expand `arch-chroot` Example </summary>\n<p>Say you forgot something, like forgetting to add a user and password. You reboot\nand go to TTY into your system and are hit with a AHHH I can‚Äôt log in WTF!</p>\n<p>It‚Äôs as easy as repeating some of the steps above. Reboot into the Live\nenvironment, remount your partitions and <code>arch-chroot</code> back in:</p>\n<p>Open the encrypted root partition:</p>\n<pre><code class=\"language-bash\">cryptsetup open /dev/nvme0n1p2 cryptroot\n</code></pre>\n<p>Mount the decrypted root:</p>\n<pre><code class=\"language-bash\">mount /dev/mapper/cryptroot /mnt\n</code></pre>\n<p>Mount the EFI partition:</p>\n<pre><code class=\"language-bash\">mount /dev/nvme0n1p1 /mnt/boot\n</code></pre>\n<p>Chroot into your installed system:</p>\n<pre><code class=\"language-bash\">arch-chroot /mnt\n</code></pre>\n<pre><code class=\"language-bash\">useradd -m -G wheel -s /bin/bash yourusername passwd yourusername\n</code></pre>\n<ul>\n<li>The <code>-s /bin/bash</code> sets your default shell, you can use zsh if you have it\ninstalled.</li>\n</ul>\n<p>Uncomment the line <code>%wheel ALL=(ALL:All) ALL</code> in <code>/etc/sudoers</code></p>\n<p>Exit chroot:</p>\n<pre><code class=\"language-bash\">exit\n</code></pre>\n<p>Unmount and close LUKS:</p>\n<pre><code class=\"language-bash\">umount /mnt/boot\numount /mnt\ncryptsetup close cryptroot\nreboot\n</code></pre>\n</details>\n<h3>Resources</h3>\n<details>\n<summary> ‚úîÔ∏è Click to Expand Resources </summary>\n<ul>\n<li>\n<p><a href=\"https://wiki.archlinux.org/title/Installation_guide\">Arch Wiki Installation Guide</a></p>\n</li>\n<li>\n<p><a href=\"https://wiki.archlinux.org/title/Unified_Extensible_Firmware_Interface/Secure_Boot\">Arch Wiki UKI/SecureBoot</a></p>\n</li>\n<li>\n<p><a href=\"https://wiki.archlinux.org/title/Unified_kernel_image\">Wiki UKI</a></p>\n</li>\n<li>\n<p><a href=\"https://wiki.archlinux.org/title/Systemd-boot\">Wiki systemd-boot</a></p>\n</li>\n</ul>\n</details>\n",
      "date_published": "2025-11-28T00:00:00+00:00",
      "author": {
        "name": "saylesss88"
      }
    },
    {
      "id": "/arch/hardening_firefox.html",
      "url": "/arch/hardening_firefox.html",
      "title": "Hardening Firefox",
      "content_html": "<h1>Hardening Firefox on Arch</h1>\n<details>\n<summary> ‚úîÔ∏è Click to Expand Table of Contents</summary>\n<!-- toc -->\n</details>\n<h2>üîë Key Terms</h2>\n<ul>\n<li>\n<p><strong>Browser hardening</strong> focuses on reducing attack surface and blocking tracking\nby disabling or restricting features like JavaScript, cookies, telemetry, and\nthird-party scripts.</p>\n</li>\n<li>\n<p><strong>Fingerprint protection</strong>, on the other hand, aims to make your browser\nindistinguishable from others. Instead of just blocking data collection, it\nensures that your browser‚Äôs configuration; screen size, fonts, user agent,\netc. matches a large group of users, so you blend in.</p>\n</li>\n<li>\n<p><strong>Browser compartmentalization</strong> is a technique where different browsers are\ndedicated to distinct online activities to isolate cookies, trackers, and\nbrowsing data. For example, Mullvad Browser can be used solely for activities\nwhere fingerprinting resistance is critical, such as anonymous browsing or\nvisiting privacy-sensitive sites. Meanwhile, a hardened LibreWolf or Firefox\ncan be used for general browsing, email, or banking where you want solid\nsecurity and feature flexibility but aren‚Äôt as concerned about fingerprint\nuniqueness.</p>\n</li>\n<li>\n<p><strong>Web APIs</strong>: are sets of rules and protocols that allow browsers or servers\nto communicate and share data or functions over the internet. It lets\ndevelopers access features or data of a web service or application without\nexposing the underlying system details, enabling different software to\ninteract smoothly and securely.</p>\n</li>\n<li>\n<p><strong>Anonymity</strong>: Maximizing anonymity often means restricting or masking\nfeatures (setting a generic fingerprint, disabling browser APIs, blocking\ntrackers) so the browser blends in with many others. This reduces uniqueness\nbut can break website functionality, cause CAPTCHAs, and limit usability.</p>\n</li>\n<li>\n<p><strong>Usability</strong>: Keeping your browser features enabled improves compatibility\nand user experience but increase uniqueness and thus make you easier to track.</p>\n</li>\n<li>\n<p><a href=\"https://en.wikipedia.org/wiki/Entropy_(computing)\">Entropy</a>: in this\ncontext, is a measure of how much unique information a specific browser\nfeature contributes to your fingerprint. It‚Äôs often quantified in <strong>bits of\nentropy</strong>, where higher bits mean more uniqueness (i.e., easier to identify\nyou).</p>\n<ul>\n<li>A ‚Äúbit‚Äù is a basic unit of information for computers. Entropy measuring\nsites results are measured in ‚Äúbits of identifying information‚Äù.</li>\n</ul>\n</li>\n<li>\n<p><a href=\"https://developer.mozilla.org/en-US/docs/Glossary/Origin\">Origin</a>: Web\ncontent‚Äôs <em>origin</em> is defined by the <em>scheme</em> (protocol), <em>hostname</em> (domain),\nand port of the URL used to access it. Two objects have the same origin only\nwhen the scheme, hostname, and port all match.</p>\n</li>\n<li>\n<p><a href=\"https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy\">Same-origin policy</a>:\nis a critical security mechanism that restricts how a document or script\nloaded by one origin can interact with a resource from another origin. It\nhelps isolate potentially malicious documents, reducing possible attack\nvectors.</p>\n</li>\n<li>\n<p><a href=\"https://blog.mozilla.org/security/2021/05/18/introducing-site-isolation-in-firefox/\">Firefox Site-Isolation</a>.\nFirefox does provide site-isolation as well.</p>\n</li>\n<li>\n<p><a href=\"https://www.mozilla.org/en-US/security/advisories/mfsa2018-01/\">Protection from side-channel attacks</a></p>\n</li>\n<li>\n<p><a href=\"https://developer.mozilla.org/en-US/docs/Web/Security/Insecure_passwords\">MDN Insecure passwords</a></p>\n<ul>\n<li><a href=\"https://blog.mozilla.org/tanvi/2016/01/28/no-more-passwords-over-http-please/\">Risks of reused passwords</a></li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<p>Tor Browser is <strong>not</strong> the most secure browser, anonymity, and security can\noften be at odds with each other. Having the exact same browser as many other\npeople isn‚Äôt the best security practice, but it is great for anonymity. Tor is\nalso based on Firefox Esr, which only receives patches for vulnerabilities\nconsidered Critical or High which can be taken advantage of.</p>\n</blockquote>\n<h3>Fingerprinting Explained</h3>\n<p>Modern Web APIs enable highly customized user experiences but also expose\ndetailed device information that attackers can exploit to create browser\nfingerprints, unique identifiers used for covert tracking, even when cookies are\nblocked.</p>\n<p><strong>Entropy</strong>, a measure of randomness or uniqueness in data, is a critical metric\nfor assessing the risk of browser fingerprinting.</p>\n<p>Browser fingerprinting is a tracking technique, often done by third-party\ncompanies that specialize in it. They provide code (usually JavaScript) that a\nwebsite owner can embed on their site. When you visit the site, the script runs\nin the background, silently collecting data about your device and browser.</p>\n<p>There are two main approaches to obfuscating your fingerprint:</p>\n<ul>\n<li>\n<p><strong>Standardization</strong>: Make browsers standardized and therefore have the same\nfingerprint to blend into a crowd. This is what Tor and Mullvad Browser do.\nBest for anonymity; increases the crowd you blend into, but may decrease\nusability (site breakage, CAPTCHAs); adversaries may still find subtle\ndifferences.</p>\n</li>\n<li>\n<p><strong>Randomization</strong>: Randomize fingerprint metrics so it‚Äôs not directly linkable\nto you. Brave has this feature, if you run coveryourtracks with Brave you will\nget a result of ‚Äúyour browser has a randomized fingerprint‚Äù. This is good for\nprivacy but may be detectable by advanced scripts.</p>\n</li>\n</ul>\n<p>Test your browsers fingerprint:</p>\n<ul>\n<li>\n<p><a href=\"https://coveryourtracks.eff.org/\">CoverYourTracks</a></p>\n</li>\n<li>\n<p><a href=\"https://amiunique.org/\">AmIUnique</a></p>\n</li>\n</ul>\n<p>Test how well your browser implements security standards and features:</p>\n<ul>\n<li><a href=\"https://browseraudit.com\">BrowserAudit</a></li>\n</ul>\n<p>Test the sites you visit for trackers:</p>\n<ul>\n<li><a href=\"https://themarkup.org/ask-the-markup/2020/09/22/i-scanned-the-websites-i-visit-with-blacklight-and-its-horrifying-now-what\">Blacklight</a></li>\n</ul>\n<p>Don‚Äôt put too much weight into the results as people often check their\nfingerprint, change one metric and check it again over and over skewing the\nresults. It is helpful for knowing the fingerprint values that trackers track.</p>\n<ul>\n<li>\n<p><a href=\"https://forum.torproject.org/t/browser-fingerprinting/1228/25\">Browser Fingerprinting Tor Forum</a></p>\n</li>\n<li>\n<p><a href=\"https://madaidans-insecurities.github.io/browser-tracking.html\">Madaidans Hot Take on Browser Tracking</a></p>\n</li>\n</ul>\n<p>You can use something like <a href=\"https://noscript.net/\">NoScript</a> to block\nJavaScript, preventing the scripts from running that do most of the\nfingerprinting. Extensions can make you more unique but it‚Äôs a give and take.</p>\n<p>The following website lists the tracking protection mechanisms implemented by\nthe major browsers and browser engines:</p>\n<ul>\n<li><a href=\"https://www.cookiestatus.com/\">Cookie Status</a></li>\n</ul>\n<hr />\n<h2>Metasearch Engines</h2>\n<ul>\n<li><a href=\"https://en.wikipedia.org/wiki/Metasearch_engine\">Wikipedia Metasearch engine</a></li>\n</ul>\n<h3>SearXNG</h3>\n<p><strong>SearXNG</strong> an open-source, privacy-respecting metasearch engine that aggregates\nresults from various search services, such as Google, DuckDuckGo, etc without\ntracking you or profiling your searches. You can add SearXNG to firefox by going\nto <code>about:preferences#search</code> and at the bottom click <code>Add</code>, URL will be\n<code>https://searx.be/search?q=%s</code>.</p>\n<blockquote>\n<p>‚ùóÔ∏è NOTE: The above searx is the default and doesn‚Äôt give many relevant\nresults. To get relevant results find a\n<a href=\"https://searx.space/\">public instance</a> with a good rating from your area and\nadd the <code>search?q=%s</code> to the end of it. For example, I‚Äôm using\n<code>https://priv.au/search?q=%s</code>. This gives much better results than DDG in my\nopinion.</p>\n</blockquote>\n<p>SearXNG is a bit different, you can choose which search engine you want for your\ncurrent search with <code>!ddg search term</code> to use duckduckgo for example.</p>\n<ul>\n<li><a href=\"https://github.com/searxng/searxng?tab=readme-ov-file\">searxng repo</a>\n<ul>\n<li>\n<p><a href=\"https://docs.searxng.org/admin/installation.html\">Install guide</a></p>\n</li>\n<li>\n<p><a href=\"https://docs.searxng.org/admin/settings/index.html\">Configuration guide</a></p>\n</li>\n</ul>\n</li>\n</ul>\n<hr />\n<p><strong>Startpage</strong> is another metasearch engine that I‚Äôve heard good things about.</p>\n<ul>\n<li>\n<p><a href=\"https://www.startpage.com/privacy-please/\">Startpage Privacy Please!</a></p>\n</li>\n<li>\n<p><a href=\"https://www.startpage.com/privacy-please/startpage-articles/easy-privacy-control-across-the-internet-introducing-startpage-privacy-protection\">Startpage Privacy Protection</a></p>\n</li>\n</ul>\n<hr />\n<h2>Defenses</h2>\n<h4>Encrypted DNS</h4>\n<p>DNS (Domain Name System) resolution is the process of translating a website‚Äôs\ndomain name into its corresponding IP address. By default, this traffic isn‚Äôt\nencrypted, which means anyone on the network, from your ISP to potential\nhackers, can see the websites you‚Äôre trying to visit. <strong>Encrypted DNS</strong> uses\nprotocols to scramble this information, protecting your queries and responses\nfrom being intercepted and viewed by others.</p>\n<blockquote>\n<p>‚ùó NOTE: There are many other ways for someone monitoring your traffic to see\nwhat domain you looked up via DNS that it‚Äôs effectiveness is questionable\nwithout also using Tor or a VPN. Encrypted DNS will not help you hide any of\nyour browsing activity.</p>\n</blockquote>\n<p>There are 3 main types of DNS protection:</p>\n<ul>\n<li>\n<p><strong>DNS over HTTPS (DoH)</strong>: Uses the HTTPS protocol to encrypt data between the\nclient and the resolver.</p>\n</li>\n<li>\n<p><strong>DNS over TLS (DoT)</strong>: Similar to (DoH), differs in the methods used for\nencryption and delivery using a separate port from HTTPS.</p>\n</li>\n<li>\n<p><strong>DNSCrypt</strong>: Uses end-to-end encryption with the added benefit of being able\nto prevent DNS spoofing attacks.</p>\n</li>\n</ul>\n<p>Useful resources:</p>\n<details>\n<summary> ‚úîÔ∏è Click to Expand DNS Resources </summary>\n<ul>\n<li>\n<p><a href=\"https://www.cloudflare.com/learning/dns/what-is-dns/\">Domain Name System (DNS)</a></p>\n</li>\n<li>\n<p><a href=\"https://en.wikipedia.org/wiki/DNS_over_HTTPS\">Wikipedia DNS over HTTPS (DoH)</a></p>\n</li>\n<li>\n<p><a href=\"https://en.wikipedia.org/wiki/DNS_over_TLS\">Wikipedia DNS over TLS (DoT)</a></p>\n</li>\n<li>\n<p><a href=\"https://blog.cloudflare.com/dns-encryption-explained/\">Cloudflare Dns Encryption Explained</a></p>\n</li>\n<li>\n<p><a href=\"https://nordvpn.com/blog/encrypted-dns-traffic/\">NordVPN Encrypted Dns Traffic</a></p>\n</li>\n</ul>\n<p><strong>Hot Take</strong>:</p>\n<ul>\n<li><a href=\"https://madaidans-insecurities.github.io/encrypted-dns.html\">Encrypted DNS is ineffective without a VPN or Tor by madaidan</a></li>\n</ul>\n</details>\n<p>I recommend either setting up dnscrypt-proxy:</p>\n<ul>\n<li><a href=\"https://mako088.github.io/arch/enc_dns.html\">dnscrypt-proxy on Arch</a></li>\n</ul>\n<p>Or set Firefox‚Äôs DNS over HTTPS to Max protection with a custom resolver:</p>\n<p>In <code>about:preferences#privacy</code> scroll down to <code>DNS over HTTPS</code>, Select\n<code>Max Protection</code> -&gt; <code>Custom</code> -&gt; <code>https://dns.quad9.net/dns-query</code></p>\n<hr />\n<h4>Enhanced Tracking Protection (ETP)</h4>\n<p>Browsers that have a form of tracking protection typically use lists of known\ntrackers and match each outgoing request against these lists.</p>\n<p>Enhanced Tracking Protection is how you deal with cookies and more on Firefox.</p>\n<ul>\n<li>\n<p><a href=\"https://support.mozilla.org/en-US/kb/enhanced-tracking-protection-firefox-desktop\">Enhanced Tracking Protection (ETP)</a>\nblocks known ‚Äúthird-party requests‚Äù to companies that participate in\nfingerprinting, according to the\n<a href=\"https://disconnect.me/trackerprotection\">Disconnect List</a></p>\n<ul>\n<li>\n<p>In <code>about:preferences#privacy</code>, setting Enhanced Tracking Protection to\neither Strict or Custom enables FPP as well, explained further down.</p>\n</li>\n<li>\n<p><a href=\"https://blog.mozilla.org/mozilla/firefox-rolls-out-total-cookie-protection-by-default-to-all-users-worldwide/\">Total Cookie Protection</a>\nis enabled by default in Standard mode.</p>\n</li>\n<li>\n<p>When you set ETP to Strict, it includes\n<a href=\"https://blog.mozilla.org/security/2021/08/10/firefox-91-introduces-enhanced-cookie-clearing/\">Enhanced Cookie Clearing</a>,\nwhich improves on the removal of third-party cookies, as well as Bounce\nTracking Protection that prevents redirect trackers.</p>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"https://wiki.mozilla.org/Security/FirstPartyIsolation\">First-Party Isolation</a>\nFrom the Tor Uplift Project.</p>\n</li>\n</ul>\n<h3>Resist Fingerprinting</h3>\n<ul>\n<li>\n<p><a href=\"https://wiki.mozilla.org/Security/Fingerprinting\">Fingerprinting</a></p>\n</li>\n<li>\n<p>RFP (Resist Fingerprinting) set in <code>about:config</code> with\n<code>privacy.resistFingerprinting</code>. Resist Fingerprinting alters the following:</p>\n<ul>\n<li>\n<p>The timezone is reported as UTC or Icelandic</p>\n</li>\n<li>\n<p>Locale is reported as en-US</p>\n</li>\n<li>\n<p>Several properties of the navigator object are fixed, including the hardware\nconcurrency value, application version and build ID. The User Agent version\nis reported to be the major version (for example, 119.0 instead of 119.1)</p>\n<ul>\n<li>And much more‚Ä¶</li>\n</ul>\n</li>\n<li>\n<p>You can set <code>privacy.resistFingerprinting.pbMode</code> (private-browsing) without\n<code>privacy.resistFingerprinting</code> and still get certain Resist Fingerprinting\nbehaviors on normal windows, because it‚Äôs impossible to separate these\nbehaviors per-window.</p>\n</li>\n</ul>\n</li>\n<li>\n<p>FPP (Fingerprinting Protection) is enabled in normal browsing when Enhanced\nTracking Protection is set to Strict. Both Known Fingerprinters and Suspected\nFingerprinters Protection are enabled in Private Browsing and when ETP is set\nto strict. On the Custom level of ETP you can toggle on/off different\nfeatures.</p>\n</li>\n</ul>\n<hr />\n<h2>Disable JavaScript</h2>\n<p>Most trackers run on JavaScript, thus blocking JavaScript prevents them from\ngathering much of the info needed to form a browser fingerprint.</p>\n<ul>\n<li>\n<p><a href=\"https://noscript.net/\">NoScript</a> lets you selectively block scripts on\nwebsites. Its core function is to block all scripts by default on websites,\nallowing you to manually enable scripts on trusted sites.</p>\n<p><a href=\"https://blog.jeaye.com/2017/11/30/noscript/\">NoScript PrivacyGuides</a> should</p>\n</li>\n<li>\n<p><a href=\"https://ublockorigin.com/\">uBlock Origin</a> also lets you block JavaScript,\njust be aware that many sites may break so you‚Äôll have to whitelist\nselectively.</p>\n</li>\n</ul>\n<h2>Disable WebRTC</h2>\n<p>The main reason people disable WebRTC is to prevent an IP address leak. WebRTC\nis designed for real-time communication like video calls and file sharing. If\nyou don‚Äôt use those features, it makes sense to disable it.</p>\n<p>Disabling WebRTC eliminates specific data points that trackers use, reducing\nentropy &amp; the uniqueness of your fingerprint.</p>\n<p>In <code>about:preferences#privacy</code> -&gt; <code>Privacy &amp; Security</code> -&gt; <code>Permissions</code>. Click\n<code>Settings</code>.</p>\n<ul>\n<li>\n<p><input disabled=\"\" type=\"checkbox\" checked=\"\"/>\nBlock new requests asking to access your microphone</p>\n</li>\n<li>\n<p><input disabled=\"\" type=\"checkbox\" checked=\"\"/>\nBlock new requests asking to access your camera</p>\n</li>\n<li>\n<p>You may also want to block Location, but that isn‚Äôt involving WebRTC.</p>\n</li>\n</ul>\n<p>You can also use the master switch by going to <code>about:config</code> and setting\n<code>media.peerconnection.enabled</code> to <code>false</code></p>\n<p><code>user.js</code> settings related to WebRTC:</p>\n<pre><code class=\"language-js\">/* 2002: force WebRTC inside the proxy [FF70+] ***/\nuser_pref(\"media.peerconnection.ice.proxy_only_if_behind_proxy\", true);\n * When using a system-wide proxy, it uses the proxy interface\n * [1] https://developer.mozilla.org/docs/Web/API/RTCIceCandidate\n * [2] https://wiki.mozilla.org/Media/WebRTC/Privacy ***/\nuser_pref(\"media.peerconnection.ice.default_address_only\", true);\nuser_pref(\"media.peerconnection.enabled\", false);\nuser_pref(\"media.peerconnection.ice.obfuscate_host_address\", true);\n/* 2004: force exclusion of private IPs from ICE candidates [FF51+]\n * [SETUP-HARDEN] This will protect your private IP even in TRUSTED scenarios after you\n * grant device access, but often results in breakage on video-conferencing platforms ***/\nuser_pref(\"media.peerconnection.ice.no_host\", true);\n</code></pre>\n<hr />\n<h2>Disable Canvas Fingerprinting</h2>\n<p>Canvas Fingerprinting uses the HTML5 <code>&lt;canvas&gt;</code> element to generate a\nfingerprint. It gets your device to render an image or text on a canvas and then\nreads the pixel data. Since devices render things differently, those differences\nare identifiable.</p>\n<p>When the pref <code>privacy.resistFingerprinting</code> is set to <code>true</code>, restricts APIs\ncommonly used for fingerprinting, including the HTML5 Canvas API. When enabled,\nit returns a randomized or generic canvas output to prevent unique\nidentification.</p>\n<hr />\n<h2>Disable WebGL</h2>\n<p>Similar to canvas fingerprinting, this technique uses the WebGL API to render 2D\nand 3D graphics. The way your system renders these graphics provides information\nabout your GPU and graphics drivers, which contributes to your unique\nfingerprint.</p>\n<blockquote>\n<p>‚ùóÔ∏è NOTE: It‚Äôs unnecessary to disable webgl if you‚Äôre already using RFP and\nwill likely make you stand out more because most people don‚Äôt disable it.</p>\n</blockquote>\n<p>It can be disabled in <code>about:config</code> by setting <code>webgl.disabled</code> to <code>true</code>.</p>\n<hr />\n<h2>Install Firefox/LibreWolf &amp; ArkenFox</h2>\n<blockquote>\n<p>‚ö†Ô∏è Firefox offers excellent privacy and customization but falls behind\nChromium-based browsers in isolation and patch timing. Compartmentalization\ncan help balance strong privacy with optimal security by using Brave or\nChromium for high-risk browsing alongside Firefox for general and\nprivacy-focused tasks.</p>\n</blockquote>\n<p>Download Firefox from the\n<a href=\"https://ftp.mozilla.org/pub/firefox/releases/\">Mozilla FTP site</a> if you are\nworried about the download token, the FTP site lets you download the version you\nwant without a token.</p>\n<p>For example, for the latest firefox as of 09-30-25 for the US:</p>\n<p><code>https://download.mozilla.org/?product=firefox-latest&amp;os=linux64&amp;lang=en-US</code></p>\n<p><strong>LibreWolf</strong> is an open-source fork of Firefox with a strong focus on privacy,\nsecurity, and user freedom. LibreWolf enables always HTTPS, includes\nuBlockOrigin, and more providing strong defaults.</p>\n<details>\n<summary> ‚úîÔ∏è Click to Expand Arkenfox How To </summary>\n<p>The process is the same for both Firefox &amp; LibreWolf. I like LibreWolf for it‚Äôs\nstrong defaults but may lag behind Firefox getting security patches.</p>\n<pre><code class=\"language-bash\">paru -S librewolf-bin\n</code></pre>\n<p>Read the <a href=\"https://github.com/arkenfox/user.js/wiki\">ArkenFox Wiki</a></p>\n<h2>Apply</h2>\n<p>Open <code>about:support</code> and look for <code>Profile Directory</code> under <code>Application Basics</code>\nSelect <code>Open Directory</code>, it will bring you to somewhere like\n<code>~/.librewolf/pefoo8xx.default-default/</code> and that is where you place the\n<code>user.js</code>.</p>\n<p>Place the following files in your <code>Profile Directory</code>:</p>\n<ol>\n<li>\n<p><a href=\"https://github.com/arkenfox/user.js/blob/master/user.js\">Arkenfox user.js</a>\nRead through the <code>user.js</code>, not all settings are applied by default such as\nRFP Fingerprinting protection.</p>\n</li>\n<li>\n<p><a href=\"https://github.com/arkenfox/user.js/blob/master/updater.sh\">updater.sh</a></p>\n</li>\n<li>\n<p><a href=\"https://github.com/arkenfox/user.js/blob/master/prefsCleaner.sh\">prefsCleaner.sh</a></p>\n</li>\n<li>\n<p>Also create your own <code>user-overrides.js</code> with any changes you want to make to\nthe default <code>user.js</code>. These changes are amended to the <code>user.js</code> and applied\nlast enabling them to override the default settings. It‚Äôs best to make\nchanges here so that updating the Arkenfox <code>user.js</code> doesn‚Äôt make you lose\nall of your customizations.</p>\n</li>\n</ol>\n<p>Example <code>user-overrides.js</code> spoofing the user agent:</p>\n<blockquote>\n<p>‚ùóÔ∏è This is just an example, always check for common useragent strings\nyourself. Read the Arkenfox Wiki!</p>\n</blockquote>\n<pre><code class=\"language-js\">&lt;!-- user_pref( --&gt;\n  &lt;!-- \"general.useragent.override\", --&gt;\n  &lt;!-- \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36\", --&gt;\n&lt;!-- ); --&gt;\n// Disable Activity Stream on new windows and tab pages\nuser_pref(\"browser.newtab.preload\", false);\n// Enhanced Tracking Protection (ETP)\nuser_pref(\"privacy.bounceTrackingProtection.mode\", 1); // [FF131+] [ETP FF133+]\nuser_pref(\"privacy.trackingprotection.enabled\", true);\n// Resist Fingerprinting (RFP)\nuser_pref(\"privacy.resistFingerprinting\", true); // [FF41+]\nuser_pref(\"privacy.resistFingerprinting.pbmode\", true); // [FF114+]\n// WebRTC\nuser_pref(\"media.peerconnection.enabled\", false);\nuser_pref(\"media.peerconnection.ice.default_address_only\", true);\n// WebGL\nuser_pref(\"webgl.disabled\", true);\n// Geolocation\nuser_pref(\"geo.enabled\", false);\nuser_pref(\"full-screen-api.enabled\", false);\nuser_pref(\n  \"geo.provider.network.url\",\n  \"https://location.services.mozilla.com/v1/geolocate?key=%MOZILLA_API_KEY%\",\n);\n// Disable studies\nuser_pref(\"app.sheild.optoutstudies.enabled\", false);\n// Master Switches, Be Careful\nuser_pref(\"browser.safebrowsing.malware.enabled\", false);\nuser_pref(\"browser.safebrowsing.phishing.enabled\", false);\nuser_pref(\"browser.safebrowsing.provider.google4.gethashURL\", \"\");\nuser_pref(\"browser.safebrowsing.provider.google4.updateURL\", \"\");\nuser_pref(\"browser.safebrowsing.provider.google.gethashURL\", \"\");\nuser_pref(\"browser.safebrowsing.provider.google.updateURL\", \"\");\nuser_pref(\"browser.safebrowsing.provider.google4.dataSharingURL\", \"\");\nuser_pref(\"signon.rememberSignons\", false);\nuser_pref(\"browser.xul.error_pages.expert_bad_cert\", true);\n//* [NOTE] Will cause breakage: older modems/routers and some sites e.g banks, vimeo, icloud, instagram ***/\nuser_pref(\"network.http.referer.XOriginPolicy\", 2);\nuser_pref(\"network.http.sendRefererHeader\", 1);\n// 0 is most strict:\nuser_pref(\"network.http.referer.trimmingPolicy\", 0);\nuser_pref(\"network.http.referer.XOriginTrimmingPolicy\", 2);\n</code></pre>\n<p>To apply your prefs you have to run the <code>updater.sh</code> script.</p>\n<pre><code class=\"language-bash\">~/.mozilla/firefox/v5kwl3c0.default-release&gt; ./updater.sh\n\n                ############################################################################\n                ####                                                                    ####\n                ####                          arkenfox user.js                          ####\n                ####       Hardening the Privacy and Security Settings of Firefox       ####\n                ####           Maintained by @Thorin-Oakenpants and @earthlng           ####\n                ####            Updater for macOS and Linux by @overdodactyl            ####\n                ####                                                                    ####\n                ############################################################################\n\n\nDocumentation for this script is available here: https://github.com/arkenfox/user.js/wiki/5.1-Updater-[Options]#-maclinux\n\nPlease observe the following information:\n    Firefox profile:  /home/jr/.mozilla/firefox/v5kwl3c0.default-release\n    Available online: * version: 140\n    Currently using:  * version: 140\n\n\nThis script will update to the latest user.js file and append any custom configurations from user-overrides.js. Continue Y/N?\ny\n\nStatus: user.js has been backed up and replaced with the latest version!\nStatus: Override file appended: user-overrides.js\n</code></pre>\n<h2>Check</h2>\n<p>Launch LibreWolf or Firefox and press <code>Ctrl-Shift-J</code> to launch Browser Console\nMode, and look for any errors.</p>\n<p>Go to <code>about:config</code> -&gt; [x] <code>Show only modified preferences</code>. You should see\n<code>SUCCESS: No no he's not dead, he's, he's restin'!</code></p>\n</details>\n<h3>User Agent Spoofing</h3>\n<blockquote>\n<p>‚ùóÔ∏è NOTE: Spoofing your useragent alone likely isn‚Äôt worth the protections you\nlose from disabling <code>resistFingerprinting</code>. <code>resistFingerprinting</code> spoofs many\ndifferent fingerprinting aspects. If you don‚Äôt get it right, you will get\ncaptcha requests constantly.</p>\n</blockquote>\n<p>Research what the most common user agent is. You‚Äôll need to disable\n<code>privacy.resistFingerprinting</code> for this to work.</p>\n<p>Place the user agent string in <code>general.useragent.override</code> something like:\n<code>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36</code>\n<a href=\"https://www.whatsmyuseragent.com\">https://www.whatsmyuseragent.com</a></p>\n<p><a href=\"https://www.useragentstring.com\">https://www.useragentstring.com</a></p>\n<hr />\n<h2>uBlock Origin</h2>\n<p>BetterFox does a great job explaining how to use uBlock with solid\nrecommendations.</p>\n<ul>\n<li><a href=\"https://github.com/yokoffing/filterlists?tab=readme-ov-file#guidelines\">BetterFox uBlock filterlists</a></li>\n</ul>\n<p>If you wanted to apply the\n<a href=\"https://github.com/yokoffing/filterlists/blob/main/privacy_essentials.txt\">Privacy Essentials</a>\nlist you would click\n<a href=\"https://subscribe.adblockplus.org/?location=https://raw.githubusercontent.com/yokoffing/filterlists/main/privacy_essentials.txt&amp;title=Privacy%20Essentials\">subscribe</a>,\nwhich launches the uBlock asset viewer where you can see all of the domains that\nwill be blocked before clicking <code>Subscribe</code> again to apply them.</p>\n<h3>Adding other lists</h3>\n<ul>\n<li>\n<p><a href=\"https://github.com/hagezi/dns-blocklists\">Hagezi dns-blocklists</a></p>\n</li>\n<li>\n<p><a href=\"https://github.com/ppfeufer/adguard-filter-list\">adguard-filter-list</a></p>\n</li>\n</ul>\n<p>Click the uBlock logo, Settings, Filter lists, scroll to the bottom and choose\nImport‚Ä¶, Paste the url of your chosen list, and click Apply changes.</p>\n<p>For example, Arkenfox suggests adding the Actually Legitimate URL Shortener\nTool. Add\n<a href=\"https://raw.githubusercontent.com/DandelionSprout/adfilt/master/LegitimateURLShortener.txt\">https://raw.githubusercontent.com/DandelionSprout/adfilt/master/LegitimateURLShortener.txt</a>\nto the Import‚Ä¶ section and click Apply changes. If you scroll up, you‚Äôll see\nthat it was added and chosen.</p>\n<p>Setup your <a href=\"https://github.com/gorhill/uBlock/wiki/Blocking-mode\">Blocking mode</a></p>\n<p>Many opt for\n<a href=\"https://github.com/gorhill/uBlock/wiki/Blocking-mode:-medium-mode\">medium mode</a>.\nTo do so you need to:</p>\n<p><strong>Settings pane</strong>:</p>\n<ul>\n<li>Open the dashboard, and choose I am an advanced user.</li>\n</ul>\n<p><strong>Filter lists pane</strong>:</p>\n<ul>\n<li>\n<p>All of uBO‚Äôs filter lists: checked</p>\n</li>\n<li>\n<p>EasyList: checked</p>\n</li>\n<li>\n<p>Peter Lowe‚Äôs Ad server list: checked</p>\n</li>\n<li>\n<p>EasyPrivacy: checked</p>\n</li>\n<li>\n<p>Online Malicious URL Blocklist: checked</p>\n</li>\n</ul>\n<p><strong>My rules pane (4th pane from the left)</strong>:</p>\n<p>Underneath Temporary rules add, you literally type this in:</p>\n<ul>\n<li>\n<p>Add <code>* * 3p-script block</code></p>\n</li>\n<li>\n<p>Add <code>* * 3p-frame block</code></p>\n</li>\n<li>\n<p>Click <code>Save</code></p>\n</li>\n<li>\n<p>Click <code>&lt;- Commit</code> (Not required on phone)</p>\n</li>\n</ul>\n<p><strong>Fallback to\n<a href=\"https://github.com/gorhill/uBlock/wiki/Blocking-mode:-easy-mode\">easy mode</a></strong></p>\n<p>Click the uBlock logo while on the site you want to use easy mode on. You‚Äôll see\nthe power button to the top right, the Global rules and the Local rules which\nstart 3 boxes from the left. Click the box under the Local rules for 3rd-party\nscripts. The box will change colors, dark gray = NOOP (No Operation). This tells\nuBO to ignore the aggressive global block for this site, and let the normal\nfilter lists handle the blocking.</p>\n<p>You can also disable JavaScript in My rules as needed.</p>\n<hr />\n<h2>Set up a SOCKS5 Proxy with Arti</h2>\n<blockquote>\n<p>‚ùóÔ∏è NOTE: This is one example of using a SOCKS5 proxy to circumvent censorship\nor add additional privacy without the Tor Browser. You can also route other\napps through the proxy, such as email clients, messaging apps, torrent\nclients, and more.</p>\n</blockquote>\n<ol>\n<li>Clone the arti repo:</li>\n</ol>\n<pre><code class=\"language-bash\"># clone the repo\ngit clone https://gitlab.torproject.org/tpo/core/arti.git\n\n# navigate to the directory\ncd arti\n</code></pre>\n<hr />\n<ol start=\"2\">\n<li>To build the Arti binary, compile the code and generate the executable run:</li>\n</ol>\n<p>These are the safer build options so you can leave the arti repo in your home\ndirectory without it leaking your username:</p>\n<pre><code class=\"language-bash\">RUSTFLAGS=\"--remap-path-prefix $HOME/.cargo=.cargo --remap-path-prefix $(pwd)=.\" \\\n   cargo build --release -p arti\n</code></pre>\n<hr />\n<ol start=\"3\">\n<li>To allow Arti SOCKS proxy traffic you need to add a rule permitting incoming\nconnections to port 9150.</li>\n</ol>\n<p>For nftables, you would open <code>/etc/nftables.conf</code> and add:</p>\n<pre><code class=\"language-conf\">chain input {\n  # ...snip...\n\n  # Allow Arti SOCKS proxy (port 9150)\n    tcp dport 9150 ct state new accept\n\n  # ...snip...\n}\n</code></pre>\n<p>Enable it with <code>sudo nft -f /etc/nftables.conf</code></p>\n<hr />\n<ol start=\"4\">\n<li>To run Arti as a SOCKS proxy on port <code>9150</code>, execute:</li>\n</ol>\n<pre><code class=\"language-bash\">./target/release/arti proxy\n</code></pre>\n<hr />\n<ol start=\"5\">\n<li>Configure LibreWolf/Firefox to use the Arti proxy:</li>\n</ol>\n<p>Open LibreWolf or Firefox</p>\n<p>Go to the menu and open <code>Preferences/Settings</code>.</p>\n<p>Scroll to the bottom <code>Network Settings</code> section.</p>\n<p>Click on ‚Äú<code>Settings...</code>‚Äù under Network Settings.</p>\n<p>In the connection settings dialog:</p>\n<p>Select ‚Äú<code>Manual proxy configuration</code>‚Äù.</p>\n<p>For ‚ÄúSOCKS Host‚Äù, enter <code>127.0.0.1</code>.</p>\n<p>For the port next to SOCKS Host, enter <code>9150</code>.</p>\n<p>Select the SOCKS version 5 option (<code>SOCKS v5</code>).</p>\n<p>Optionally check the box ‚Äú<code>Proxy DNS when using SOCKS v5</code>‚Äù to route DNS queries\nthrough the proxy for enhanced privacy.</p>\n<p>Click ‚Äú<code>OK</code>‚Äù to apply the settings.</p>\n<hr />\n<ol start=\"6\">\n<li>Verify Your Proxy Setup Open a new tab and visit <code>https://dnsleaktest.com</code>\nand run an <code>Extended Test</code>.</li>\n</ol>\n<p>Your IP address should now appear as a Tor exit node IP, indicating your traffic\nis routed through the Arti proxy.</p>\n<ul>\n<li>\n<p>Make sure Arti is running in its terminal or background before you start\nbrowsing.</p>\n</li>\n<li>\n<p>If you close the terminal or stop Arti, your browser will lose the proxy\nconnection.</p>\n</li>\n</ul>\n<p>This setup only proxies the configured browser traffic; other apps are not\naffected unless configured similarly.</p>\n<p>This setup turns LibreWolf or Firefox into a Tor-enabled browser without\ninstalling the Tor Browser Bundle, using the Arti SOCKS proxy instead. It can be\nuseful if you want to use a more customizable or alternative browser while still\naccessing the Tor network securely.</p>\n<blockquote>\n<p>‚ö†Ô∏è While using LibreWolf with the Arti SOCKS5 proxy provides network-level\nanonymity by routing traffic through the Tor network, it does not include the\nextensive browser-level privacy and security enhancements found in the\nofficial Tor Browser. For casual or moderate privacy needs the SOCKS proxy can\nbe useful but for stronger anonymity guarantees and protection, the Tor\nBrowser is recommended.</p>\n</blockquote>\n<h2>Setup an Arti service to run in the background</h2>\n<blockquote>\n<p>Be careful here, its not as easy to tell if Arti failed for some reason.</p>\n</blockquote>\n<p>Create a service file at <code>/etc/systemd/system/arti.service</code>:</p>\n<p>Replace <code>your-username</code> with your username</p>\n<pre><code class=\"language-.service\">[Unit]\nDescription=Arti Tor Proxy Service\nAfter=network.target\n\n[Service]\nExecStart=/home/your-username/arti/target/release/arti proxy\nRestart=on-failure\nUser=jr\nGroup=jr\nWorkingDirectory=/home/your-username/arti\nEnvironment=RUSTFLAGS=\"--remap-path-prefix $HOME/.cargo=.cargo --remap-path-prefix $(pwd)=.\"\n\n[Install]\nWantedBy=multi-user.target\n</code></pre>\n<p>Enable &amp; Start the service:</p>\n<pre><code class=\"language-bash\">sudo systemctl enable arti\nsudo systemctl start arti --now\n</code></pre>\n<p>Ensure its running:</p>\n<pre><code class=\"language-bash\">sudo systemctl status arti\n</code></pre>\n<hr />\n<details>\n<summary> ‚úîÔ∏è Click to Expand Resources </summary>\n<ul>\n<li>\n<p><a href=\"https://docs.searxng.org/\">Welcome to SearXNG</a></p>\n</li>\n<li>\n<p><a href=\"https://brainfucksec.github.io/firefox-hardening-guide\">Firefox Hardening Guide</a></p>\n</li>\n<li>\n<p><a href=\"https://www.ghacks.net/2015/08/18/a-comprehensive-list-of-firefox-privacy-and-security-settings/\">Firefox ghacks</a></p>\n</li>\n<li>\n<p><a href=\"https://github.com/arkenfox/user.js\">ArkenFox user.js</a> Just right IMO.</p>\n</li>\n<li>\n<p><a href=\"https://github.com/yokoffing/Betterfox\">BetterFox user.js</a> Easiest to use\nwith less breakage.</p>\n</li>\n<li>\n<p><a href=\"https://codeberg.org/Narsil/user.js/src/branch/main/desktop\">Narsil user.js</a>\nMost hardened.</p>\n</li>\n<li>\n<p><a href=\"https://www.privacytools.io/private-browser\">PrivacyTools.io</a></p>\n</li>\n<li>\n<p><a href=\"https://privacytests.org/\">PrivacyTests.org</a></p>\n</li>\n<li>\n<p><a href=\"https://github.com/simeononsecurity/FireFox-Privacy-Script\">simeononsecurity Firefox-Privacy-Script</a></p>\n</li>\n<li>\n<p><a href=\"https://anhkhoakz.neocities.org/blog/browsers-for-daily-using/#firefox-but-hardened\">Browsers for Daily Using</a></p>\n</li>\n<li>\n<p><a href=\"https://brainfucksec.github.io/firefox-hardening-guide\">brianfucksec firefox-hardening-Guide 2023</a></p>\n</li>\n<li>\n<p><a href=\"https://simeononsecurity.com/guides/enhance-firefox-security-configuring-guide/\">STIG Firefox Hardening</a></p>\n</li>\n</ul>\n<blockquote>\n<p>If you should trust the U.S. Governments recommendations is another story but\nit can be good to compare and contrast with other trusted resources. You‚Äôll\nhave to think whether the CISA recommending that everyone uses Signal is solid\nadvice or guiding you towards a honeypot, I can‚Äôt say for sure.</p>\n</blockquote>\n<ul>\n<li>\n<p><a href=\"https://stigviewer.com/stigs/mozilla_firefox\">Mozilla Firefox Security Technical Implementation Guide</a>\nThe STIG for Mozilla Firefox (Security Technical Implementation Guide) is a\nset of security configuration standards developed by the U.S. Department of\nDefense. They are created by the Defense Information Systems Agency (DISA) to\nsecure and harden DoD information systems and software.</p>\n</li>\n<li>\n<p><a href=\"https://thenewoil.org/en/guides/prologue/why/\">Privacy, The New Oil (Why Privacy &amp; Security Matter)</a></p>\n</li>\n<li>\n<p><a href=\"https://www.privacyguides.org/en/\">PrivacyGuides</a></p>\n</li>\n<li>\n<p><a href=\"https://relay.firefox.com/accounts/profile/\">Firefox Relay</a> can be used to\ncreate email aliases that forward to your real email address. The paid plan\nalso lets you create phone number aliases that forward to your phone number.</p>\n</li>\n<li>\n<p><a href=\"https://zebracrossing.narwhalacademy.org/\">Zebra Crossing digital safety checklist</a></p>\n</li>\n<li>\n<p><a href=\"https://datadetoxkit.org/en/privacy/essentials#step-1\">DataDetoxKit</a></p>\n</li>\n<li>\n<p><a href=\"https://datadetoxkit.org/en/privacy/degooglise/\">DataDetox Degooglise</a></p>\n</li>\n<li>\n<p><a href=\"https://tb-manual.torproject.org/\">Tor Browser User Manual</a></p>\n</li>\n<li>\n<p><a href=\"https://gitlab.torproject.org/tpo/team/-/wikis/home\">Tor Wiki</a></p>\n</li>\n<li>\n<p><a href=\"https://blog.torproject.org/\">Tor Blog</a></p>\n</li>\n<li>\n<p><a href=\"https://gitlab.torproject.org/tpo/core/arti/#why-rewrite-tor-in-rust\">Arti why-rewrite-tor-in-rust</a></p>\n</li>\n<li>\n<p><a href=\"https://wiki.mozilla.org/Security/Tor_Uplift/Tracking\">The Tor Uplift Project</a></p>\n</li>\n<li>\n<p><a href=\"https://www.browsercat.com/post/browser-fingerprint-spoofing-explained\">BrowserCat Fingerprint Spoofing</a></p>\n</li>\n<li>\n<p><a href=\"https://cyberinsider.com/firefox-privacy/\">cyberinsider Firefox privacy 2025</a></p>\n</li>\n<li>\n<p><a href=\"https://cyberinsider.com/browser-fingerprinting/\">cyberinsider Browser Fingerprinting</a></p>\n</li>\n<li>\n<p><a href=\"https://developer.mozilla.org/en-US/docs/Web/Privacy\">Mozilla Web Docs Privacy on the web</a></p>\n</li>\n<li>\n<p><a href=\"https://adguard-dns.io/en/blog/techtok-9-browser-extensions-and-firewall.html\">Adguard Blog Browser Extensions and Firewalls explained</a></p>\n</li>\n<li>\n<p><a href=\"https://searchfox.org/firefox-main/source/toolkit/components/resistfingerprinting/RFPTargetsDefault.inc\">searchfox RFPTargetsDefault</a></p>\n</li>\n<li>\n<p><a href=\"https://en.wikipedia.org/wiki/Entropy_(computing)\">Wikipedia Entropy (computing)</a></p>\n</li>\n<li>\n<p><a href=\"https://brave.com/blog/\">Brave Blog</a></p>\n</li>\n</ul>\n<p><strong>Cheatsheets</strong></p>\n<ul>\n<li>\n<p><a href=\"https://cheatsheetseries.owasp.org/cheatsheets/HTTP_Headers_Cheat_Sheet.html\">HTTP Security Response Headers Cheat Sheet</a></p>\n</li>\n<li>\n<p><a href=\"https://cheatsheetseries.owasp.org/cheatsheets/Zero_Trust_Architecture_Cheat_Sheet.html\">Zero Trust Architecture Cheat Sheet</a></p>\n</li>\n<li>\n<p><a href=\"https://we.riseup.net/riseup+tech/entropy\">riseup entropy</a></p>\n</li>\n<li>\n<p><a href=\"https://www.kicksecure.com/wiki/Dev/Entropy\">kicksecure entropy</a></p>\n</li>\n<li>\n<p><a href=\"https://riseup.net/en/security\">riseup Digital Security</a></p>\n</li>\n</ul>\n</details>\n",
      "date_published": "2025-11-28T00:00:00+00:00",
      "author": {
        "name": "saylesss88"
      }
    },
    {
      "id": "/arch/hardening_arch.html",
      "url": "/arch/hardening_arch.html",
      "title": "Hardening Arch",
      "content_html": "<h1>Hardening Arch Linux</h1>\n<details>\n<summary> ‚úîÔ∏è Click to Expand Table of Contents</summary>\n<!-- toc -->\n</details>\n<blockquote>\n<p>‚ö†Ô∏è Warning: I am not a security expert. This guide presents various options\nfor hardening Arch Linux, but it is your responsibility to evaluate whether\neach adjustment suits your specific needs and environment. Security hardening\nand process isolation can introduce stability challenges, compatibility\nissues, or unexpected behavior. Additionally, these protections often come\nwith performance tradeoffs. Always conduct thorough research, there are no\nplug and play one size fits all security solutions.</p>\n</blockquote>\n<blockquote>\n<p>Much of this guide draws inspiration or recommendations from the well-known\n<a href=\"https://madaidans-insecurities.github.io/guides/linux-hardening.html\">Linux Hardening Guide</a>\nby Madaidan‚Äôs Insecurities and the Arch Wiki. Arch is great but when anonymity\ntruly matters, use Whonix or Tails. The Whonix Docs have a specific section or\nArch with KVM that is an excellent resource.</p>\n</blockquote>\n<ul>\n<li><a href=\"https://www.whonix.org/wiki/KVM#Arch_Linux\">Whonix KVM#Arch_Linux</a>, if you\nplan on using this think twice before enabling <code>dnscrypt-proxy</code> and you might\nwant to consider ufw firewall rather than the nftables I share in this guide\nbecause of Port conflicts.</li>\n</ul>\n<p>Keep in mind that Arch‚Äôs security posture is ultimately constrained by the\nbroader limitations of Linux security mechanisms, upstream tooling, and ongoing\ndevelopment priorities.</p>\n<p>I will assume that you‚Äôre using a UKI with Secure Boot enabled with systemd-boot\nfor this section. If you don‚Äôt and want to, you can follow the\n<a href=\"https://mako088.github.io/arch/enc_install.html\">Guide</a> that I wrote or more\nobviously, the Wiki.</p>\n<h2>The Basics</h2>\n<p>Check the <a href=\"https://security.archlinux.org/\">Arch Linux Security Tracker</a> for\ninformation about known vulnerabilities affecting Arch packages. It lists CVEs\n(Common Vulnerabilities and Exposures) affecting packages, the severity, the\nfixed versions, and advisory details.</p>\n<p>Backup your system regularly, many guides consider the data already lost if it\nisn‚Äôt backed up because without a backup, any data loss event (hardware failure,\nransomware attack, accidental deletion, natural disaster) becomes irreversible.\nBackups act as a critical safety net that enables recovery. Without them, once\ndata is corrupted, deleted, or encrypted, there is no reliable way to restore\nit, effectively making it lost permanently.</p>\n<p>The 3-2-1 Backup Rule:</p>\n<ul>\n<li>\n<p>3 copies of data. (Ensuring redundancy)</p>\n</li>\n<li>\n<p>2 storage types. (Reduces risk)</p>\n</li>\n<li>\n<p>1 offsite backup. (Protects against cyber threats and natural disasters)</p>\n</li>\n<li>\n<p>There is a backup guide for btrfs in\n<a href=\"https://mako088.github.io/arch/enc_install.html\">enc_install</a></p>\n</li>\n</ul>\n<p>Use Full Disk Encryption to protect your data at rest.</p>\n<p>Encryption is the process of using an algorithm to scramble plaintext data into\nciphertext, making it unreadable except to a person who has the key to decrypt\nit.</p>\n<p><strong>Data at rest</strong> is data in storage, such as a computer‚Äôs or a servers hard\ndisk.</p>\n<p><strong>Data at rest encryption</strong> (typically hard disk encryption), secures the\ndocuments, directories, and files behind an encryption key. Encrypting your data\nat rest prevents data leakage, physical theft, unauthorized access, and more as\nlong as the key management scheme isn‚Äôt compromised.</p>\n<p>Enable a UEFI password or Administrator password where it requires\nauthentication in order to access the UEFI/BIOS.</p>\n<p>Use a different password/passphrase for encryption and userspace.(i.e., user\npasswd)</p>\n<p>Use Secure Boot, with a Unified Kernel Image (UKI). TPM can, in some ways\nincrease security; I may add a section in the future.</p>\n<p>When Secure Boot is used with a Unified Kernel Image, it provides enhanced\nprotection compared to traditional boot methods because when Secure Boot\nverifies the UKI‚Äôs signature, it ensures the integrity and authenticity of:</p>\n<ul>\n<li>\n<p>The kernel itself,</p>\n</li>\n<li>\n<p>The <code>initramfs</code>,</p>\n</li>\n<li>\n<p>The kernel command line parameters,</p>\n</li>\n<li>\n<p>And indirectly, the bootloader that loads the UKI (since the bootloader\nverifies the UKI signature before execution).</p>\n</li>\n<li>\n<p>Secure boot doesn‚Äôt protect against runtime kernel exploits.</p>\n</li>\n</ul>\n<p>This means that any tampering with these components, such as injecting malware\ninto the <code>initramfs</code>, altering boot parameters, or swapping the kernel would\nbreak the signature verification and prevent the system from booting.</p>\n<p><code>systemd-boot</code> has a smaller attack surface and is often recommended over GRUB\nfor hardened systems.</p>\n<ul>\n<li><a href=\"https://mako088.github.io/arch/enc_install.html\">Encrypted Install Guide w/ systemd-boot and UKI Secure Boot</a></li>\n</ul>\n<p>Useful Resources:</p>\n<details>\n<summary> ‚úîÔ∏è Click to Expand Secure Boot Resources </summary>\n<ul>\n<li>\n<p><a href=\"https://0pointer.net/blog/authenticated-boot-and-disk-encryption-on-linux.html\">The Strange State of Authenticated Boot and Encryption</a></p>\n</li>\n<li>\n<p>When using a UKI with Secure Boot, the initrd is authenticated because it‚Äôs a\nsealed component of the single signed image.</p>\n</li>\n</ul>\n</details>\n<hr />\n<h3>Best Practices and Standards</h3>\n<p>It‚Äôs crucial to <strong>document every system change</strong> meticulously. Since Arch Linux\ntypically relies on manual configuration and does not use full declarative\nversion control by default, maintaining clear records, such as detailed\nchangelogs, notes, or Git repositories for your config files is essential.</p>\n<p>A few options to version control some of your dotfiles:</p>\n<p>Tools like <a href=\"https://www.gnu.org/s/stow/manual/stow.html\">GNU Stow</a> and\n<a href=\"https://chezmoi.io/install/\">chezmoi</a> help bring structure and version control\nto manual configurations in Arch Linux.</p>\n<ul>\n<li>\n<p>GNU Stow uses a symlink farm approach to manage dotfiles and configuration\ndirectories cleanly, making it easy to track and revert changes by organizing\nfiles under a single version-controlled directory.</p>\n</li>\n<li>\n<p><a href=\"https://www.chezmoi.io/\">chezmoi</a> is a powerful dotfile manager focused on\nreproducible, encrypted, and template-driven config management. It simplifies\napplying changes across multiple machines and maintaining a documented history\nof modifications.</p>\n</li>\n</ul>\n<p>Using these tools enhances your ability to maintain clear, version-controlled\nrecords of system changes. Consider making your dotfiles repo private if you‚Äôre\nunsure what you need to protect.</p>\n<p>By breaking changes into smaller, manageable tasks and documenting them with\ndescriptive messages, you create a clear history of modifications. This makes it\nfar simpler to troubleshoot issues, revert problematic changes, and maintain\nsecurity best practices over time.</p>\n<p><strong>User and Permission Management</strong></p>\n<ul>\n<li>\n<p><strong>Implement distinct user accounts</strong> to minimize the risk associated with\ncompromised accounts.</p>\n</li>\n<li>\n<p><strong>Execute Specific Commands</strong>: Always execute the specific command that\nrequires elevation, rather than using sudo to open an entire root shell:</p>\n<ul>\n<li>\n<p><strong>Good</strong>: <code>sudo pacman -Syu</code></p>\n</li>\n<li>\n<p><strong>Bad</strong>: Running <code>sudo su -</code> and then running <code>pacman -Syu</code></p>\n</li>\n</ul>\n</li>\n<li>\n<p>Consider using a more secure or minimal form of privilege escalation like\n<code>doas</code>, <code>sudo-rs</code>, or <code>run0</code> instead of standard <code>sudo</code>.</p>\n</li>\n</ul>\n<hr />\n<h3>User and group management &amp; Strong Passwords</h3>\n<ul>\n<li>\n<p>Users and groups are used as a form of\n<a href=\"https://en.wikipedia.org/wiki/access_control#Computer_security\">access control</a>.\nThey control access to the system‚Äôs files, directories, and peripherals. This\nis a security feature that limits access in certain specific ways.</p>\n<ul>\n<li>When granting access to a resource, create a specific group and add only the\nnecessary users to it, rather than granting broad access to all root or\nwheel users. Demonstrated in: <strong><a href=\"#doas-over-sudo\">Doas over sudo</a></strong>.</li>\n</ul>\n</li>\n<li>\n<p>Apply the principle of least privilege by assigning users only the permissions\nthey actually need.</p>\n</li>\n<li>\n<p>Avoid running services or applications as root; use dedicated service accounts\nwhere possible.</p>\n</li>\n</ul>\n<p><strong>Passwords/Password Quality</strong></p>\n<pre><code class=\"language-bash\">sudo pacman -S libpwquality\n</code></pre>\n<p>Edit <code>/etc/pam.d/passwd</code> file to read as:</p>\n<pre><code class=\"language-passwd\">#%PAM-1.0\npassword required pam_pwquality.so retry=2 minlen=10 difok=6 dcredit=-1 ucredit=-1 ocredit=-1 lcredit=-1 [badwords=myservice mydomain] enforce_for_root\npassword required pam_unix.so use_authtok sha512 shadow\n</code></pre>\n<p>The <code>/etc/pam.d/passwd</code> file with <code>pam_pwquality.so</code> specifies the enforcement\ndirectives and some immediate password rules, which apply dynamically during\npassword changes.</p>\n<ul>\n<li>\n<p><a href=\"https://man.archlinux.org/man/pam_pwquality.8\">pam_pwuality(8)</a></p>\n</li>\n<li>\n<p><a href=\"https://man.archlinux.org/man/pam_unix.8\">pam_unix(8)</a></p>\n</li>\n<li>\n<p>Use strong passwords and a password manager. The Arch Wiki\n<a href=\"https://wiki.archlinux.org/title/Security\">Security</a> section goes in depth\nabout this.</p>\n</li>\n<li>\n<p>Regularly review group memberships and file permissions, especially on\nsensitive system files.</p>\n</li>\n</ul>\n<p>Edit <code>/etc/security/pwquality.conf</code> to read as:</p>\n<pre><code class=\"language-pwquality.conf\">minlen = 15\n# digit\ndcredit = -1\n# uppercase\nucredit = -1\n# lowercase\nlcredit = -1\n# Special character\nocredit = -1\n# dictionary checks\ndictcheck = 1\n# username checks\nusercheck = 1\nusersubstr = 5\nenforcing = 1\n# check roots pwquality\nenforce_for_root\n</code></pre>\n<p>The <code>/etc/security/pwquality.conf</code> file holds system-wide default parameters\nthat cannot all be easy expressed on the PAM line. This is a bit more\ncomprehensive than <code>/etc/pam.d/passwd</code>.</p>\n<p>Setting <code>enforcing = 0</code> disables enforcement.</p>\n<ul>\n<li>\n<p>Using negative values like <code>dcredit = -1</code>, <code>ucredit = -1</code>, <code>lcredit = -1</code>, and\n<code>ocredit = -1</code> requires at least one digit, uppercase, lowercase, and other\n(special) character respectively.</p>\n</li>\n<li>\n<p><code>dictcheck = 1</code> and <code>usercheck = 1</code> enable dictionary checks and user name\nchecks to prevent weak or related passwords.</p>\n</li>\n</ul>\n<hr />\n<p><strong>Package Management and System Minimalism</strong></p>\n<ul>\n<li>\n<p>Favor packages from the official Arch repositories managed with pacman, as\nthey are cryptographically signed and vetted by trusted Arch developers.</p>\n</li>\n<li>\n<p>Use AUR packages cautiously; they lack official cryptographic signatures and\nrequire manual review and vetting before installation.</p>\n</li>\n<li>\n<p>Install only the software and services you truly need to reduce the attack\nsurface and minimize vulnerabilities.</p>\n</li>\n<li>\n<p>Remove unused packages and disable unnecessary services to free up resources\nand limit potential entry points.</p>\n</li>\n<li>\n<p>Consider using <code>arch-audit</code> to find packages with vulnerabilities and patch\nsaid vulnerabilities.</p>\n</li>\n</ul>\n<hr />\n<p><strong>Network and Privacy Best Practices</strong></p>\n<p>On a hardened Linux system, the browser is most often the weakest link exposed\nto the internet, and so security, privacy, and anti-tracking features of\nbrowsers are now as important, or even more important than platform-level\nprotections.</p>\n<ul>\n<li>\n<p><a href=\"https://mako088.github.io/arch/hardening_firefox.html\">Hardening Firefox/Librewolf Guide</a></p>\n</li>\n<li>\n<p>Prefer software and hardware with privacy-respecting defaults and a strong\nsecurity posture.</p>\n</li>\n<li>\n<p>Use encrypted DNS and VPNs where possible: encrypted DNS protects your\nqueries, while VPNs hide your IP address. Note that VPNs do not provide\nanonymity on their own and fingerprinting techniques can still reveal\ninformation.</p>\n<ul>\n<li><a href=\"https://mako088.github.io/arch/enc_dns.html\">dnscrypt-proxy w/ dnsmasq guide</a></li>\n</ul>\n</li>\n<li>\n<p>Implement a firewall to control inbound and outbound network traffic based on\npredefined security rules. Firewalls serve as a critical layer of defense to\nreduce attack surfaces and monitor suspicious activity.</p>\n</li>\n<li>\n<p>Secure SSH access by disabling root login, changing default ports, and\nenforcing public-key authentication to prevent brute-force and unauthorized\naccess attempts.</p>\n</li>\n</ul>\n<hr />\n<p><strong>Cryptography and Future-Proofing</strong></p>\n<ul>\n<li>\n<p>The\n<a href=\"https://www.nsa.gov/Press-Room/Press-Releases-Statements/Press-Release-View/Article/3498776/post-quantum-cryptography-cisa-nist-and-nsa-recommend-how-to-prepare-now/\">NSA, CISA, and NIST warn</a>\nthat nation-state actors are likely stockpiling encrypted data now, preparing\nfor a future when quantum computers could break today‚Äôs most widely used\nencryption algorithms. Sensitive data with long-term secrecy needs is\nespecially at risk.</p>\n</li>\n<li>\n<p>This is a wake-up call to use the strongest encryption available today and to\nplan early for post-quantum security.</p>\n</li>\n<li>\n<p><a href=\"https://www.nist.gov/news-events/news/2024/08/nist-releases-first-3-finalized-post-quantum-encryption-standards\">NIST First 3 Post-Quantum Encryption Standards</a>\nOrganizations and individuals should prepare to migrate cryptographic systems\nto these new standards as soon as practical.</p>\n</li>\n<li>\n<p>They chose\n<a href=\"https://www.nist.gov/news-events/news/2022/07/nist-announces-first-four-quantum-resistant-cryptographic-algorithms\">Four Quantum-Resistant Cryptographic Algorithms</a>\nwarning that public-key cryptography is especially vulnerable and widely used\nto protect digital information.</p>\n</li>\n<li>\n<p>Follow developments from entities like\n<a href=\"https://www.nist.gov/news-events/news/2024/08/nist-releases-first-3-finalized-post-quantum-encryption-standards\">NIST‚Äôs post-quantum encryption standards</a>\nand implement recommendations as soon as practical.</p>\n</li>\n<li>\n<p>Stay informed of quantum-resistant algorithm updates, especially for\npublic-key cryptography, as recommended by NIST and security agencies.</p>\n</li>\n</ul>\n<hr />\n<h2>Hardening/Sandboxing systemd</h2>\n<ul>\n<li><a href=\"https://wiki.archlinux.org/title/Systemd/Sandboxing\">Arch Wiki systemd/sandboxing</a></li>\n</ul>\n<p><code>systemd</code> is the core ‚Äúinit system‚Äù and service manager that controls how\nservices, daemons, and basic system processes are started, stopped and\nsupervised on modern Linux distributions, including Arch. It provides a suite of\nbasic building blocks for a Linux system as well as a system and service manager\nthat runs as <code>PID 1</code> and starts the rest of the system.</p>\n<p>Because it launches and supervises almost all system services, hardening systemd\nmeans raising the baseline security of your entire system.</p>\n<pre><code class=\"language-bash\">sudo systemd-analyze security\n# ...snip\nsystemd-hostnamed.service                 1.7 OK        üôÇ\nsystemd-importd.service                   5.0 MEDIUM    üòê\nsystemd-journald.service                  4.9 OK        üôÇ\nsystemd-logind.service                    2.8 OK        üôÇ\nsystemd-machined.service                  6.2 MEDIUM    üòê\n</code></pre>\n<p>Check a specific unit:</p>\n<pre><code class=\"language-bash\">sudo systemd-analyze security NetworkManager\n</code></pre>\n<pre><code class=\"language-bash\">sudo systemctl edit NetworkManager.service\n‚Üí Overall exposure level for NetworkManager.service: 9.6 UNSAFE    üò®\n</code></pre>\n<p>The following file will open in your $EDITOR, these settings take it from UNSAFE\nto OK:</p>\n<pre><code class=\"language-conf\">[Service]\nNoNewPrivileges = true\nProtectHome = true\nProtectKernelModules = true\nProtectKernelLogs = true\nProtectControlGroups = true\nProtectClock = true\nProtectHostname = true\nProtectProc = \"invisible\"\nProtectKernelTunables=yes\nPrivateTmp = true\nRestrictRealtime = true\nSystemCallFilter=~@mount ~@module ~@swap ~@obsolete ~@cpu-emulation ptrace\nCapabilityBoundingSet=~CAP_KILL ~CAP_SYS_CHROOT ~CAP_AUDIT_* ~CAP_SETUID ~CAP_SETGID ~CAP_SETPCAP ~CAP_SYS_ADMIN ~CAP_NET_BIND_SERVICE ~CAP_NET_BROADCAST ~CAP_NET_RAW ~CAP_DAC_OVERRIDE ~CAP\n_FOWNER ~CAP_IPC_OWNER\n\n# Allow only the essential families (AF_PACKET and exotic ones are blocked by omission)\n#RestrictAddressFamilies=AF_UNIX AF_NETLINK AF_INET AF_INET6\nRestrictNamespaces = true\nRestrictSUIDSGID = true\nMemoryDenyWriteExecute = true\nSystemCallArchitectures = \"native\"\nLockPersonality= true\nUMask=0077\nUser=root\nPrivateDevices=yes\n\n### Edits below this comment will be discarded\n</code></pre>\n<pre><code class=\"language-bash\">sudo systemctl daemon-reload\nsudo systemctl restart NetworkManager\n</code></pre>\n<p>Sometimes you may need to reboot for the changes to take effect.</p>\n<pre><code class=\"language-bash\">sudo systemd-analyze security NetworkManager\n‚Üí Overall exposure level for NetworkManager.service: 4.5 OK üôÇ\n</code></pre>\n<blockquote>\n<p>‚ùóÔ∏è This is just one example of the many services that you can harden if you so\nchoose.</p>\n</blockquote>\n<p>Further reading on systemd:</p>\n<details>\n<summary> ‚úîÔ∏è Click to Expand Systemd Resources </summary>\n<ul>\n<li>\n<p><a href=\"https://systemd.io/\">systemd.io</a></p>\n</li>\n<li>\n<p><a href=\"https://0pointer.de/blog/projects/systemd.html\">Rethinking PID 1</a></p>\n</li>\n<li>\n<p><a href=\"https://0pointer.de/blog/projects/the-biggest-myths.html\">Biggest Myths about Systemd</a></p>\n</li>\n</ul>\n</details>\n<hr />\n<h2>Lynis and other tools</h2>\n<p>Lynis is a security auditing tool for systems based on UNIX like Linux, macOS,\nBSD, and others.‚Äì<a href=\"https://github.com/CISOfy/lynis\">lynis repo</a></p>\n<pre><code class=\"language-bash\">sudo pacman -S lynis\n</code></pre>\n<p>List commands:</p>\n<pre><code class=\"language-bash\">sudo lynis show commands\nCommands:\nlynis audit\nlynis configure\nlynis generate\nlynis show\nlynis update\nlynis upload-only\n</code></pre>\n<p>Audit the system:</p>\n<pre><code class=\"language-bash\">sudo lynis audit system\n Lynis security scan details:\n\n  Hardening index : 83 [################    ]\n  Tests performed : 255\n  Plugins enabled : 0\n</code></pre>\n<ul>\n<li>\n<p>The ‚ÄúLynis hardening index‚Äù is an overall impression on how well a system is\nhardened. However, this is just an indicator on measures taken - not a\npercentage of how safe a system might be. A score over 75 typically indicates\na system with more than average safety measures implemented.</p>\n</li>\n<li>\n<p>Lynis will give you more recommendations for securing your system as well.</p>\n</li>\n</ul>\n<hr />\n<p><strong>rkhunter</strong> (Rootkit Hunter):</p>\n<ul>\n<li><a href=\"https://wiki.archlinux.org/title/Rkhunter\">Arch Wiki RKhunter</a></li>\n</ul>\n<pre><code class=\"language-bash\">sudo pacman -S rkhunter\n</code></pre>\n<p>Update the file properties database:</p>\n<pre><code class=\"language-bash\">sudo rkhunter --propupd\n</code></pre>\n<p>Keep rkhunters data files up-to-date with:</p>\n<pre><code class=\"language-bash\">sudo rkhunter --update\n</code></pre>\n<p>Run a system check:</p>\n<pre><code class=\"language-bash\">sudo rkhunter --check --sk\n</code></pre>\n<p>Validate the config files:</p>\n<pre><code class=\"language-bash\">sudo rkhunter --config-check\n</code></pre>\n<p>Get rid of false positives by adding the following to <code>/etc/rkhunter.conf</code>:</p>\n<pre><code class=\"language-conf\">SCRIPTWHITELIST=/usr/bin/egrep\nSCRIPTWHITELIST=/usr/bin/fgrep\nSCRIPTWHITELIST=/usr/bin/ldd\nSCRIPTWHITELIST=/usr/bin/vendor_perl/GET\n</code></pre>\n<p>Run a config check:</p>\n<pre><code class=\"language-bash\">sudo rkhunter --config-check\n</code></pre>\n<hr />\n<p><strong>ClamAV</strong></p>\n<ul>\n<li>\n<p>Malware stands for malicious software. A computer virus is an undesirable\nprogram running on the user‚Äôs computer often without their consent or even\nwithout their knowledge.</p>\n</li>\n<li>\n<p><a href=\"https://wiki.archlinux.org/title/ClamAV\">Arch Wiki ClamAV</a></p>\n</li>\n</ul>\n<pre><code class=\"language-bash\">sudo pacman -S clamav\n</code></pre>\n<p>Update the virus databases manually:</p>\n<pre><code class=\"language-bash\">sudo freshclam\n</code></pre>\n<p>Scan your system:</p>\n<pre><code class=\"language-bash\">sudo clamscan -r ~\n----------- SCAN SUMMARY -----------\nKnown viruses: 8708646\nEngine version: 1.4.3\nScanned directories: 6505\nScanned files: 79796\nInfected files: 0\nData scanned: 4387.29 MB\nData read: 5191.41 MB (ratio 0.85:1)\nTime: 1748.802 sec (29 m 8 s)\nStart Date: 2025:10:03 14:32:58\nEnd Date:   2025:10:03 15:02:07\n</code></pre>\n<blockquote>\n<p>‚ùóÔ∏è NOTE: This can take a while, I recommend using <code>caffeine-ng</code> or <code>caffeine</code>\nfor this to prevent your system going to sleep while the scan completes.</p>\n</blockquote>\n<pre><code class=\"language-bash\">paru -S caffeine-ng\n</code></pre>\n<p>This creates a coffee cup icon in your bar config on next reboot. If you‚Äôre in\nthe middle of something and don‚Äôt want to reboot run:</p>\n<pre><code class=\"language-bash\">caffeine &amp;\n</code></pre>\n<p>Click the icon and <code>Enable Caffeine</code> to prevent sleep.</p>\n<hr />\n<h2>Hardening the Kernel</h2>\n<p>Given the kernel‚Äôs central role, it‚Äôs a frequent target for malicious actors,\nmaking robust hardening essential.</p>\n<p>You can use the <code>linux-hardened</code> kernel to have a kernel that prioritizes\nsecurity over anything else:</p>\n<pre><code class=\"language-bash\">sudo pacman -S linux-hardened linux-hardened-headers\n</code></pre>\n<p>Generate the <code>initramfs</code> for the hardened kernel:</p>\n<pre><code class=\"language-bash\">sudo mkinitcpio -p linux-hardened\n</code></pre>\n<p>Configure systemd-boot to boot the hardened kernel, the entries are configured\nunder <code>/boot/loader/entries/</code>. Create or edit an entry file, for example\n<code>/boot/loader/entries/arch-linux-hardened.conf</code>:</p>\n<pre><code class=\"language-text\">title   Arch Linux Hardened\nlinux   /vmlinuz-linux-hardened\ninitrd  /initramfs-linux-hardened.img\noptions rd.luks.name=YOUR_UUID=cryptroot root=/dev/mapper/cryptroot rw quiet\n</code></pre>\n<p>Replace <code>YOUR_UUID</code> with the UUID of the encrypted root partition (from <code>blkid</code>)</p>\n<p>To set this as the default boot entry and enable booting the last selected\nkernel automatically, edit <code>/boot/loader/loader.conf</code>:</p>\n<pre><code class=\"language-text\">default arch-linux-hardened.conf\ntimeout 4\nconsole-mode auto\n</code></pre>\n<p>Edit <code>/etc/mkinitcpio.d/linux-hardened.preset</code>:</p>\n<pre><code class=\"language-preset\"># mkinitcpio preset file for the 'linux-hardened' package\n\nALL_config=\"/etc/mkinitcpio.conf\"\nALL_kver=\"/boot/vmlinuz-linux-hardened\"\n\nPRESETS=('default' 'fallback')\n\n#default_config=\"/etc/mkinitcpio.conf\"\n# default_image=\"/boot/initramfs-linux-hardened.img\"\ndefault_uki=\"/boot/EFI/Linux/arch-linux-hardened.efi\"\ndefault_options=\"--splash /usr/share/systemd/bootctl/splash-arch.bmp\"\n\n#fallback_config=\"/etc/mkinitcpio.conf\"\n# fallback_image=\"/boot/initramfs-linux-hardened-fallback.img\"\nfallback_uki=\"/boot/EFI/Linux/arch-linux-hardened-fallback.efi\"\nfallback_options=\"-S autodetect\"\n</code></pre>\n<p>Reboot and <code>linux-hardened</code> should be chosen by default. You can also choose\nadditional kernels if needed.</p>\n<hr />\n<h2>Hardening your current Kernel</h2>\n<p>Sometimes <code>linux-hardened</code> just won‚Äôt work on your system without some serious\ndigging. You can harden your current kernel, or even better would be to harden\nthe Long-Term Support (LTS) kernel.</p>\n<p>The Linux kernel is typically released under two forms: stable and long-term\nsupport (LTS). Choosing either has consequences, do your research.\n<a href=\"https://madaidans-insecurities.github.io/guides/linux-hardening.html#stable-vs-lts\">Stable vs. LTS kernels</a></p>\n<ul>\n<li><a href=\"https://www.kernel.org/category/releases.html\">The Linux Kernel Archives Active kernel releases</a></li>\n</ul>\n<p>See which kernel you‚Äôre currently using with:</p>\n<pre><code class=\"language-bash\"># show the kernel release\nuname -r\n# show kernel version, hostname, and architecture\nuname -a\n</code></pre>\n<p>Show the configuration of your current kernel:</p>\n<pre><code class=\"language-bash\">zcat /proc/config.gz\n</code></pre>\n<p><code>sysctl</code> is a tool that allows you to view or modify kernel settings and\nenable/disable different features.</p>\n<p>Check what each setting does <a href=\"https://sysctl-explorer.net/\">sysctl-explorer</a></p>\n<p>Refer to\n<a href=\"https://madaidans-insecurities.github.io/guides/linux-hardening.html#sysctl-kernel\">madadaidans-insecurities#sysctl-kernel</a>\nfor the following settings and their explainations.</p>\n<p>Create a file <code>/etc/sysctl.d/99-custom.conf</code>, since files are read in\nlexicographical order this file will be read last, allowing it to override any\nsettings from earlier files.</p>\n<p>To check if a parameter is already set:</p>\n<pre><code class=\"language-bash\">sysctl fs.protected_symlinks\nsysctl -a | grep fs.protected\n</code></pre>\n<p>To list all parameters:</p>\n<pre><code class=\"language-bash\">sysctl -a &gt; params.txt\n</code></pre>\n<ul>\n<li>\n<p><code>1</code> typically means enable</p>\n</li>\n<li>\n<p><code>0</code> typically means disable</p>\n</li>\n</ul>\n<p>Example, both of these were the default in the zen-kernel:</p>\n<pre><code class=\"language-bash\"># 99-custom.conf\n# prevent hardlink misuse\nfs.protected_hardlinks = 1\n# prevent symlink misuse\nfs.protected_symlinks = 1\n</code></pre>\n<p>Apply the changes immediately:</p>\n<pre><code class=\"language-bash\">sudo sysctl --system\n</code></pre>\n<p>Check Active Linux Security Modules:</p>\n<pre><code class=\"language-bash\">cat /sys/kernel/security/lsm\n# Output:\nFile: /sys/kernel/security/lsm\ncapability,landlock,yama,bpf,apparmor\n</code></pre>\n<p>Check Kernel Configuration Options:</p>\n<pre><code class=\"language-bash\">zcat /proc/config.gz | grep CONFIG_SECURITY_SELINUX\nzcat /proc/config.gz | grep CONFIG_HARDENED_USERCOPY\nzcat /proc/config.gz | grep CONFIG_STACKPROTECTOR\n</code></pre>\n<pre><code class=\"language-bash\">sudo pacman -S kernel-hardening-checker\n</code></pre>\n<p>While in the same directory as the <code>params.txt</code> that we created earlier, run:</p>\n<pre><code class=\"language-bash\">kernel-hardening-checker -l /proc/cmdline -c /proc/config.gz -s ./params.txt\n</code></pre>\n<p>Only the warnings listed with <code>| sysctl |</code> can be edited with the above method.</p>\n<p>Example <code>99-custom.conf</code> with some settings to prevent breakage:</p>\n<details>\n<summary> ‚úîÔ∏è Click to Expand `99-custom.conf` example </summary>\n<blockquote>\n<p>‚ö†Ô∏è WARNING: Always do your own research, you can find explanations to the\nfollowing settings in:\n<a href=\"https://madaidans-insecurities.github.io/guides/linux-hardening.html#sysctl-kernel\">madaidans insecurities Linux Hardening guide</a>.</p>\n</blockquote>\n<p>You can apply these on top of the hardened kernel as well:</p>\n<pre><code class=\"language-conf\"># Kernel Security Hardening\n# ----------------------------------------------------------------------\n# allow set-user-ID processes to dump core\nfs.suid_dumpable = 2\n\n# prevent pointer leaks\nkernel.kptr_restrict = 2\n\n# restrict kernel log to CAP_SYSLOG capability\nkernel.dmesg_restrict = 1\n\n# Note: certian container runtimes or browser sandboxes might rely on the following\n# restrict eBPF to the CAP_BPF capability\nkernel.unprivileged_bpf_disabled = 1\n\n# should be enabled along with bpf above\n# net.core.bpf_jit_harden = 2\n\n# restrict loading TTY line disciplines to the CAP_SYS_MODULE\ndev.tty.ldisk_autoload = 0\n\n# prevent exploit of use-after-free flaws\nvm.unprivileged_userfaultfd = 0\n\n# kexec is used to boot another kernel during runtime and can be abused\nkernel.kexec_load_disabled = 1\n\n# Kernel self-protection\n# SysRq exposes a lot of potentially dangerous debugging functionality to unprivileged users\n# 4 makes it so a user can only use the secure attention key. A value of 0 would disable completely\nkernel.sysrq = 4\n\n# disable unprivileged user namespaces, Note: Docker and other apps may need this\n# kernel.unprivileged_userns_clone = 0 # commented out because it makes apps I need fail\n\n# restrict all usage of performance events to the CAP_PERFMON capability\nkernel.perf_event_paranoid = 3\n\n# Network Security Hardening\n# ----------------------------------------------------------------------\n\n# protect against SYN flood attacks (denial of service attack)\nnet.ipv4.tcp_syncookies = 1\n\n# protection against TIME-WAIT assassination\nnet.ipv4.tcp_rfc1337 = 1\n\n# enable source validation of packets received (prevents IP spoofing)\nnet.ipv4.conf.default.rp_filter = 1\nnet.ipv4.conf.all.rp_filter = 1\n\n# Disable ICMP redirects for IPv4\nnet.ipv4.conf.all.accept_redirects = 0\nnet.ipv4.conf.default.accept_redirects = 0\nnet.ipv4.conf.all.secure_redirects = 0\nnet.ipv4.conf.default.secure_redirects = 0\n\n# Disable ICMP redirects for IPv6 (Protect against IP spoofing)\nnet.ipv6.conf.all.accept_redirects = 0\nnet.ipv6.conf.default.accept_redirects = 0\nnet.ipv4.conf.all.send_redirects = 0\nnet.ipv4.conf.default.send_redirects = 0\n\n# prevent man-in-the-middle attacks (by ignoring ICMP echo requests)\nnet.ipv4.icmp_echo_ignore_all = 1\n\n# ignore bogus ICMP errors, helps avoid Smurf attacks\nnet.ipv4.icmp_ignore_bogus_error_responses = 1\n\n# Disable IP forwarding\nnet.ipv4.conf.all.forwarding = 0\n\n# Disable acceptance of source-routed packets for IPv4\nnet.ipv4.conf.default.accept_source_route = 0\nnet.ipv4.conf.all.accept_source_route = 0\n\n# Disable acceptance of source-routed packets for IPv6\nnet.ipv6.conf.all.accept_source_route = 0\nnet.ipv6.conf.default.accept_source_route = 0\n\n# Disable IPv6 forwarding\nnet.ipv6.conf.all.forwarding = 0\n\n# Disable Router Advertisements acceptance\nnet.ipv6.conf.all.accept_ra = 0\nnet.ipv6.conf.default.accept_ra = 0\n\n# TCP Hardening\n# ----------------------------------------------------------------------\n\n# Disable TCP SACK (Selective Acknowledgement)\nnet.ipv4.tcp_sack = 0\nnet.ipv4.tcp_dsack = 0\nnet.ipv4.tcp_fack = 0\n\n# Userspace/Memory Security\n# ----------------------------------------------------------------------\n\n# restrict usage of ptrace\nkernel.yama.ptrace_scope = 2\n\n# ASLR memory protection (64-bit systems)\nvm.mmap_rnd_bits = 32\nvm.mmap_rnd_compat_bits = 16\n\n# only permit symlinks to be followed when outside of a world-writable sticky directory\nfs.protected_symlinks = 1\nfs.protected_hardlinks = 1\n\n# Prevent creating files in potentially attacker-controlled environments\nfs.protected_fifos = 2\nfs.protected_regular = 2\n\n# Randomize memory\nkernel.randomize_va_space = 2\n\n# Exec Shield (Stack protection)\n# NOTE: This is generally deprecated/obsolete on modern kernels that use other hardening measures\n# kernel.exec-shield = 1\n\n# TCP Optimization\n# ----------------------------------------------------------------------\n\n# TCP Fast Open: 3 = enable for both incoming and outgoing connections\nnet.ipv4.tcp_fastopen = 3\n\n# Bufferbloat mitigations + slight improvement in throughput &amp; latency\nnet.ipv4.tcp_congestion_control = bbr\nnet.core.default_qdisc = cake\n</code></pre>\n<h2>Disable Core Dumps</h2>\n<p>A core dump consists of the recorded state of the working memory of a computer\nprogram at a specific time, generally when a program crashes or terminates\nabnormally. They can be useful for debugging but can also contain sensitive\ninformation, to disable core dumps:</p>\n<p>Create <code>/etc/sysctl.d/50-coredump.conf</code>:</p>\n<pre><code class=\"language-conf\"># disable coredumps\nkernel.core_pattern = |/bin/false\n# disable core dumps from setuid binaries\nfs.suid_dumpable = 0\n</code></pre>\n<p>Apply with:</p>\n<pre><code class=\"language-bash\">sudo sysctl --system\n# or\nsudo sysctl -p /etc/sysctl.d/50-coredump.conf\n</code></pre>\n<p>Arch uses <code>systemd-coredump</code> by default, which still intercepts dumps. To fully\ndisable that component, create <code>/etc/systemd/coredump.conf/custom.conf</code>:</p>\n<pre><code class=\"language-conf\">[Coredump]\nStorage=none\nProcessSizeMax=0\n</code></pre>\n<p>Then reload systemd:</p>\n<pre><code class=\"language-bash\">sudo systemctl daemon-reload\nsudo systemctl mask systemd-coredump.socket\n</code></pre>\n</details>\n<h2>Kernel and Namespace Hardening and Blacklisting</h2>\n<ul>\n<li>\n<p><strong>Protect the kernel image</strong>:</p>\n<ul>\n<li>\n<p>Enable Secure Boot to ensure only trusted boot components are loaded.</p>\n</li>\n<li>\n<p>Enforce kernel module signature verification by adding\n<code>module.sig_enforce=1</code> to your kernel parameters (e.g., create\n<code>/etc/cmdline.d/security.conf</code> with this line). This restricts loading\nunsigned kernel modules.</p>\n</li>\n<li>\n<p>NOTE: This setting is strict and may break compatibility with some drivers\nor modules. Thorough testing and research are recommended before enforcing\nit.</p>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>Protect the <code>/boot</code> partition</strong>:</p>\n<ul>\n<li>\n<p>The above setting is fairly strict and will break some things. Do research\nbefore going so strict.</p>\n</li>\n<li>\n<p>Make <code>/boot</code> read-only if you have a high threat model. It can cause issues\nthough, setting more strict permissions helps.</p>\n</li>\n</ul>\n</li>\n<li>\n<p>Lock kernel modules (optional):</p>\n<ul>\n<li>Set <code>module.sig_enforce=1</code> in kernel parameters.(i.e.,\n<code>/etc/cmdline.d/security.conf</code>)</li>\n</ul>\n</li>\n</ul>\n<p>Blacklist unneeded modules in <code>/etc/modprobe.d/blacklist.conf</code>:</p>\n<pre><code class=\"language-conf\">blacklist dccp          # Datagram Congestion Control Protocol\nblacklist sctp          # Stream Control Transmission Protocol\nblacklist rds           # Reliable Datagram Sockets\nblacklist tipc          # Transparent Inter-Process Communication\nblacklist n_hdlc        # High-level Data Link Control\nblacklist ax25          # Amateur X.25\nblacklist netrom        # NetRom\nblacklist x25           # X.25\nblacklist rose\nblacklist decnet\nblacklist econet\nblacklist af_802154     # IEE 802.15.4\nblacklist ipx           # Internetwork Packet Exchange\nblacklist appletalk\nblacklist psnap         # SubnetworkAccess Protocol\nblacklist p8023         # Novell raw IEE 802.3\nblacklist p8022         # IEE 802.3\nblacklist can           # Controller Area Network\nblacklist atm\n# Various rare filesystems\nblacklist cramfs\nblacklist freevxfs\nblacklist jffs2\nblacklist hfs\nblacklist hfsplus\nblacklist udf\n# Less rare but often recommended\n# Optionally blacklist squashfs, cifs, nfs etc. by uncommenting:\n# blacklist squashfs\n# blacklist cifs\n# blacklist nfs\n# blacklist nfsv3\n# blacklist nfsv4\n# blacklist ksmbd\n# blacklist gfs2\n# blacklist vivid\n</code></pre>\n<p>There are more suggestions in the madaidans insecurities guide.</p>\n<p>Apply the changes:</p>\n<pre><code class=\"language-bash\">sudo mkinitcpio -P\n</code></pre>\n<p>Check which modules were included in the initramfs (Long Output):</p>\n<pre><code class=\"language-bash\">mkinitcpio -v &gt; /tmp/mk.txt\n</code></pre>\n<p>Then search through the file and ensure they weren‚Äôt loaded.</p>\n<blockquote>\n<p>‚ùóÔ∏è Note: This may break some networking and virtualization tools.</p>\n</blockquote>\n<ul>\n<li>\n<p>Force-enable PTI (Page Table Isolation):</p>\n<ul>\n<li>Add <code>pti=on</code> to the kernel command line.</li>\n</ul>\n</li>\n<li>\n<p>User namespaces:</p>\n<ul>\n<li>\n<p>Do <strong>not</strong> set <code>kernel.unprivileged_userns_clone=0</code> if desktop\nsandboxing/containers are used.</p>\n</li>\n<li>\n<p>Set <code>kernel.unprivileged_userns_clone=0</code> in <code>/etc/sysctl.d/</code> to disable if\ncontainers are not required.</p>\n</li>\n</ul>\n</li>\n<li>\n<p>SMT/Hyperthreading policy:</p>\n<ul>\n<li>\n<p>For extra isolation, add <code>nosmt</code> to kernel parameters.</p>\n</li>\n<li>\n<p>Disabling SMT reduces performance.</p>\n</li>\n</ul>\n</li>\n</ul>\n<hr />\n<h2>Firewall</h2>\n<p><strong>nftables</strong> is designed to replace <strong>iptables</strong> by providing a modern,\nsimplified, and unified packet filtering and classification framework in the\nLinux kernel. It reuses the underlying Netfilter infrastructure but introduces a\nnew kernel API and completely different user-space tool (<code>nft</code>).</p>\n<ul>\n<li><a href=\"https://wiki.archlinux.org/title/Nftables\">Arch Wiki nftables</a></li>\n</ul>\n<p><strong>Installation</strong>:</p>\n<pre><code class=\"language-bash\">sudo pacman -S nftables\n</code></pre>\n<p>There is an example firewall ruleset located at <code>/etc/nftables.conf</code> and more\nexamples located in <code>/usr/share/nftables/</code> and\n<code>/usr/share/doc/nftables/examples/</code></p>\n<p>Flush existing iptables Rules &amp; Disable iptables if necessary.</p>\n<p><strong>Create nftables ruleset</strong>:</p>\n<pre><code class=\"language-bash\">#-----------------------------------------------------------------------------\n# Flush existing rules: ensure a clean slate before loading new rules\n#-----------------------------------------------------------------------------\nflush ruleset\ntable inet filter {\n    # -------------------------------------------------------------------------\n    # INPUT CHAIN (Incoming Traffic destined for this host)\n    # Default is to DROP all incoming traffic\n    # -------------------------------------------------------------------------\n    chain input {\n        type filter hook input priority filter; policy drop;\n\n        # Drop invalid packets (e.g., malformed or out-of-state)\n        ct state invalid drop\n\n        # Allow loopback traffic (localhost to localhost)\n        iif \"lo\" accept\n\n        # Allow established and related connections (replies to outgoing, FTP helper)\n        ct state established,related accept\n\n        # Allow specific ICMP types for IPv4\n        ip protocol icmp icmp type { echo-request, echo-reply, destination-unreachable, time-exceeded } accept\n\n        # Allow critical ICMPv6 types for IPv6 (essential for network function)\n        ip6 nexthdr icmpv6 icmpv6 type { echo-request, echo-reply, destination-unreachable, packet-too-big, time-exceeded, parameter-problem, nd-router-advert, nd-router-solicit, nd-neighbor-solicit, nd-neighbor-advert } accept\n\n        # Allow SSH (port 2222) with rate-limiting to prevent brute-force attacks\n        tcp dport 2222 ct state new limit rate 15/minute accept\n\n        # Allow HTTP and HTTPS (ports 80 and 443)\n        tcp dport { 80, 443 } ct state new accept\n\n        # Log packets that reach the end of the chain before they are dropped by the policy (optional)\n        log prefix \"nft-input-drop: \"\n    }\n\n    # -------------------------------------------------------------------------\n    # FORWARD CHAIN (Routed Traffic passing through this host)\n    # Default is to DROP all routed traffic (host-based firewall)\n    # -------------------------------------------------------------------------\n    chain forward {\n        type filter hook forward priority filter; policy drop;\n\n        # Drop invalid packets\n        ct state invalid drop\n\n        # Allow established and related connections\n        ct state established,related accept\n\n        # Add specific FORWARD rules here if the machine is acting as a router/gateway\n    }\n\n    # -------------------------------------------------------------------------\n    # OUTPUT CHAIN (Outgoing Traffic originating from this host)\n    # Default is to DROP all outgoing traffic for maximum security\n    # -------------------------------------------------------------------------\n    chain output {\n    type filter hook output priority filter; policy drop;\n\n    # Allow essential local communication\n    oif \"lo\" accept\n\n    # Allow replies for established and related connections (critical)\n    ct state established,related accept\n\n    # Allow DNS queries (UDP and TCP)\n    udp dport 53 accept\n    tcp dport 53 accept\n\n    # Allow general outbound web access (e.g., for updates, API calls)\n    tcp dport { 80, 443 } accept\n\n    # Allow Git (and general SSH client) outgoing connections\n    tcp dport 22 ct state new accept\n\n    # Allow NTP (Network Time Protocol) for time synchronization\n    udp dport 123 accept\n\n    # Use meta l4proto to correctly match MLDv2 Type 143 packets\n    meta l4proto ipv6-icmp icmpv6 type {\n        echo-request,\n        destination-unreachable,\n        time-exceeded,\n        parameter-problem,\n        nd-neighbor-solicit,\n        nd-neighbor-advert,\n        mld2-listener-report\n    } accept\n\n    # Log packets that reach the end of the chain before they are dropped by the policy (optional)\n    log prefix \"nft-output-drop: \"\n    }\n}\n</code></pre>\n<blockquote>\n<p>‚ùóÔ∏è Most desktop firewalls default to <strong>allow all outgoing traffic</strong>\n(<code>policy accept</code> on the output chain). This is done for convenience, as it\nprevents applications from breaking. However, for a system practicing zero\ntrust, the best practice is to enforce a <strong>default deny</strong>(<code>policy drop</code>) on\nthe output chain and <strong>only explicitly allow</strong> the services the system needs.</p>\n</blockquote>\n<pre><code class=\"language-bash\">sudo systemctl enable nftables.service\nsudo systemctl start nftables.service\n</code></pre>\n<p>Load and test the rules if in a different location than the default:</p>\n<pre><code class=\"language-bash\">sudo nft -f /path/to/your/nftables.conf\n</code></pre>\n<p>or in default location:</p>\n<pre><code class=\"language-bash\">sudo nft -f /etc/nftables.conf\n</code></pre>\n<blockquote>\n<p>‚ùóÔ∏è If you don‚Äôt use SSH or host a web server or any service, don‚Äôt allow SSH\nand HTTP/HTTPS.</p>\n</blockquote>\n<pre><code class=\"language-bash\">sudo nft list ruleset\n</code></pre>\n<hr />\n<h2>SSH &amp; GPG Key Generation and Safety</h2>\n<h3>ssh-keygen</h3>\n<p>The <code>ed25519</code> algorithm is significantly faster and more secure when compared to\n<code>RSA</code>. You can also specify the key derivation function (KDF) rounds to\nstrengthen protection even more.</p>\n<p>For example, to generate a strong key for MdBook:</p>\n<pre><code class=\"language-bash\">ssh-keygen -t ed25519 -a 32\n</code></pre>\n<p>Or more specifically:</p>\n<pre><code class=\"language-bash\">ssh-keygen -t ed25519 -a 32 -f ~/.ssh/id_ed25519_github_$(date +%Y-%m-%d) -C \"SSH Key for GitHub\"\n</code></pre>\n<ul>\n<li>\n<p><code>-t</code> is for type</p>\n</li>\n<li>\n<p><code>-a 32</code> sets the number of KDF rounds. The standard is usually good enough,\nadding extra rounds can make it harder to brute-force.</p>\n</li>\n<li>\n<p><code>-f</code> is for filename</p>\n</li>\n</ul>\n<hr />\n<h3>GnuPG and gpg-agent</h3>\n<details>\n<summary> ‚úîÔ∏è Click to Expand GnuPG section </summary>\n<p><code>gpg --full-generate-key</code> can be used to generate a basic keypair.</p>\n<p><code>gpg --expert --full-generate-key</code> can be used for keys that require more\ncapabilities.</p>\n<blockquote>\n<p>‚ùó NOTE: We will first generate our GPG primary key that is required to\natleast have sign capabilities, we will then derive subkeys from said primary\nkey and use them for signing and encrypting. It is recommended to generate a\nrevoke certificate right after creating your primary key.</p>\n</blockquote>\n<p>To generate your gpg primary key you can do the following:</p>\n<pre><code class=\"language-bash\">gpg --full-generate-key\n</code></pre>\n<ul>\n<li>\n<p>Choose <code>(10) (sign only)</code></p>\n</li>\n<li>\n<p>Give it a name and description</p>\n</li>\n<li>\n<p>Give it an expiration date, 1y is common</p>\n</li>\n<li>\n<p>Use a strong passphrase or password</p>\n</li>\n<li>\n<p>Give it a comment, I typically add the date</p>\n</li>\n</ul>\n<p>If you see a warning about incorrect permissions, you can run the following:</p>\n<pre><code class=\"language-bash\">chmod 700 ~/.gnupg\nchmod 600 ~/.gnupg/*\n</code></pre>\n<p>Verify:</p>\n<pre><code class=\"language-bash\">ls -ld ~/.gnupg\n# Should show: drwx------\n\nls -l ~/.gnupg\n# Files should show: -rw-------\n</code></pre>\n<hr />\n<h3>Generate a Revocation Certificate</h3>\n<p><code>mykey</code> must be a key specifier, either the keyID of the primary keypair or any\npart of the user ID that identifies the keypair:</p>\n<p>Replace <code>mykeyID</code> with the keyID of your primary key and store the cert in a\nsafe place:</p>\n<pre><code class=\"language-bash\">gpg --output revoke.asc --gen-revoke mykeyID\nCreate a revocation certificate for this key? (y/N)\nPlease select the reason for the revocation:\n  0 = No reason specified\n  1 = Key has been compromised\n  2 = Key is superseded\n  3 = Key is no longer used\n  Q = Cancel\n(Probably you want to select 1 here)\nYour decision?\n</code></pre>\n<p>The certificate will be output to a file <code>revoke.asc</code>. If the <code>--output</code> is\nommitted, the result will be placed on stdout.</p>\n<p>Since it‚Äôs a short certificate, you can print a hardcopy and store it somewhere\nsafe. The cert shouldn‚Äôt be somewhere that others can access it since anyone\ncould publish the revoke cert and render the corresponding public key useless.</p>\n<p>To apply the revoke cert, import it:</p>\n<pre><code class=\"language-bash\">gpg --import revoke.asc\n# And optionally push the revoked key to public keyservers to notify others:\ngpg --keyserver keyserver.ubuntu.com --send-keys YOUR_KEYID\n</code></pre>\n<hr />\n<h3>Generate Gpg Subkeys</h3>\n<pre><code class=\"language-bash\"># Take note of your public key\ngpg --list-keys --with-fingerprint\n/home/jr/.gnupg/pubring.kbx\n---------------------------\npub   ed25519/0x095782A1B124AF15 2025-08-23 [SCA] [expires: 2026-08-23]\nKey fingerprint = 5908 9C5B FEC8 0D75 FCB0  E206 0958 82C1 A124 CF15\nuid                   [ultimate] Jr (08-23-25) &lt;sayls8@proton.me&gt;\n</code></pre>\n<ul>\n<li>Copy the KeyID, in this example it would be <code>0x095722B2A123CF15</code>. We will use\nit for the command below.</li>\n</ul>\n<p>Now we will generate 2 subkeys, 1 for encryption and 1 for authentication.</p>\n<pre><code class=\"language-bash\">gpg --expert --edit-key 0x095722B2A123CF15\n</code></pre>\n<p>Choose 11 (set your own capabilities) and add A (Authenticate) and type Q.\nCreate another key while still in the menu with only encrypt capabilities.</p>\n<blockquote>\n<p>‚ùó <code>gpg --edit-key</code> has many more capabilities, after launching type <code>help</code>.</p>\n</blockquote>\n<p><strong>Add Keygrip of Authenticate Subkey to <code>sshcontrol</code> for gpg-agent</strong></p>\n<pre><code class=\"language-bash\">gpg --list-secret-keys --with-keygrip --keyid-format LONG\n</code></pre>\n<p>Copy the keygrip of the subkey with Authenticate capabilities</p>\n<pre><code class=\"language-bash\">echo \"6BD11826F3845BC222127FE3D22C92C91BB3FB32\" &gt; ~/.gnupg/sshcontrol\n</code></pre>\n<pre><code class=\"language-bash\">ssh-add -L\n# you should see something like:\nssh-ed25519 AABCC3NzaC1lZDI1NTE5ABBAIHyujgyCjjBTqIuFM3EMUSo6RGklmOXQW3uWRhWdJ1Mm (none)\n</code></pre>\n<ul>\n<li>By itself, a keygrip cannot be used to reconstruct your private key. It‚Äôs\nderived from the public key material, not from the secret key itself so it‚Äôs\nsafe to version control. Don‚Äôt put your keygrip in a public repo if you don‚Äôt\nwant people to know you use that key for signing/authentication. It‚Äôs not a\nsecurity risk, but it leaks a tiny bit of metadata.</li>\n</ul>\n<p>The following article mentions the keygrip being computed from public elements\nof the key:</p>\n<ul>\n<li><a href=\"https://gnupg-users.gnupg.narkive.com/q5JtahdV/gpg-agent-what-is-a-keygrip\">gnupg-users what-is-a-keygrip</a></li>\n</ul>\n<p>Create a <code>~/.gnupg/gpg.conf</code>:</p>\n<p>Copy the KeyID of the key with Authenticate capabilities and use it as your\ndefault-key in <code>gpg.conf</code>:</p>\n<ul>\n<li><a href=\"https://riseup.net/ru/security/message-security/openpgp/gpg-best-practices\">RiseUp GPG Best Practices</a></li>\n</ul>\n<pre><code class=\"language-bash\">#\n# This is an implementation of the Riseup OpenPGP Best Practices\n# https://help.riseup.net/en/security/message-security/openpgp/best-practices\n#\n\n\n#-----------------------------\n# default key\n#-----------------------------\n\n# The default key to sign with. If this option is not used, the default key is\n# the first key found in the secret keyring\n\n#default-key 0xD8692123C4065DEA5E0F3AB5249B39D24F25E3B6\n\n\n#-----------------------------\n# behavior\n#-----------------------------\n\n# Disable inclusion of the version string in ASCII armored output\nno-emit-version\n\n# Disable comment string in clear text signatures and ASCII armored messages\nno-comments\n\n# Display long key IDs\nkeyid-format 0xlong\n\n# List all keys (or the specified ones) along with their fingerprints\nwith-fingerprint\n\n# Display the calculated validity of user IDs during key listings\nlist-options show-uid-validity\nverify-options show-uid-validity\n\n# Try to use the GnuPG-Agent. With this option, GnuPG first tries to connect to\n# the agent before it asks for a passphrase.\nuse-agent\n\n\n#-----------------------------\n# keyserver\n#-----------------------------\n\n# This is the server that --recv-keys, --send-keys, and --search-keys will\n# communicate with to receive keys from, send keys to, and search for keys on\nkeyserver hkps://keys.openpgp.org/\n\n# Set the proxy to use for HTTP and HKP keyservers - default to the standard\n# local Tor socks proxy\n# It is encouraged to use Tor for improved anonymity. Preferrably use either a\n# dedicated SOCKSPort for GnuPG and/or enable IsolateDestPort and\n# IsolateDestAddr\n#keyserver-options http-proxy=socks5-hostname://127.0.0.1:9050\n\n# Don't leak DNS, see https://trac.torproject.org/projects/tor/ticket/2846\nkeyserver-options no-try-dns-srv\n\n# When using --refresh-keys, if the key in question has a preferred keyserver\n# URL, then disable use of that preferred keyserver to refresh the key from\nkeyserver-options no-honor-keyserver-url\n\n# When searching for a key with --search-keys, include keys that are marked on\n# the keyserver as revoked\nkeyserver-options include-revoked\n\n\n#-----------------------------\n# algorithm and ciphers\n#-----------------------------\n\n# list of personal digest preferences. When multiple digests are supported by\n# all recipients, choose the strongest one\npersonal-cipher-preferences AES256 AES192 AES CAST5\n\n# list of personal digest preferences. When multiple ciphers are supported by\n# all recipients, choose the strongest one\npersonal-digest-preferences SHA512 SHA384 SHA256 SHA224\n\n# message digest algorithm used when signing a key\ncert-digest-algo SHA512\n\n# This preference list is used for new keys and becomes the default for\n# \"setpref\" in the edit menu\ndefault-preference-list SHA512 SHA384 SHA256 SHA224 AES256 AES192 AES CAST5 ZLIB BZIP2 ZIP Uncompressed\n</code></pre>\n<p>Add the following to your shell config, either <code>.bashrc</code> or <code>.zshrc</code>:</p>\n<pre><code class=\"language-zsh\">GPG_TTY=$(tty)\nexport GPG_TTY\nexport SSH_AUTH_SOCK=$(gpgconf --list-dirs agent-ssh-socket)\ngpgconf --launch gpg-agent\n</code></pre>\n<p>Rebuild and then restart <code>gpg-agent</code> if necessary:</p>\n<pre><code class=\"language-bash\">gpgconf --kill gpg-agent\ngpgconf --launch gpg-agent\n</code></pre>\n<p>Test, these should match:</p>\n<pre><code class=\"language-bash\">echo \"$SSH_AUTH_SOCK\"\n# output\n/run/user/1000/gnupg/d.wft5hcsny4qqq3g31c76534j/S.gpg-agent.ssh\n\ngpgconf --list-dirs agent-ssh-socket\n# output\n/run/user/1000/gnupg/d.wft5hcsny4qqq3g31c76834j/S.gpg-agent.ssh\n</code></pre>\n<pre><code class=\"language-bash\">ssh-add -L\n# Copy the entire following line:\nssh-ed25519 AABBC3NzaC1lZDI1NTE5AAAAIGXwhVokJ6cKgodYT+0+0ZrU0sBqMPPRDPJqFxqRtM+I (none)\n</code></pre>\n<ul>\n<li>It shows <code>(none)</code> because the comment field is blank on subkeys.</li>\n</ul>\n<h3>Backing up Your Keys</h3>\n<pre><code class=\"language-bash\">gpg --export-secret-keys --armor --output my-private-key-backup.gpg\n</code></pre>\n<p>Your private keys will be encrypted with a passphrase into a .gpg file. Store\nthis backup in a secure location line an encrypted USB drive. This can prevent\nyou from losing access to your keys in the case of disk failure or accidents.</p>\n<p>You can export your public keys and publish them publicly if you choose:</p>\n<pre><code class=\"language-bash\">gpg --export --armor --output my-public-keys.gpg\n</code></pre>\n<p>Now if your keys ever get lost or corrupted, you can import these backups.</p>\n<hr />\n<h3>Remove and Store your Primary Key offline</h3>\n<blockquote>\n<p>‚ùó NOTE: After you remove your primary key, you will no longer be able to\nderive subkeys from it or sign keys unless you re-import it.</p>\n</blockquote>\n<pre><code class=\"language-bash\"># extract the primary key\ngpg -a --export-secret-key sayls8@proton.me &gt; secret_key\n# extract the subkeys, which we will reimport later\ngpg -a --export-secret-subkeys sayls8@proton.me &gt; secret_subkeys.gpg\n# delete the secret keys from the keyring, so only subkeys are left\ngpg --delete-secret-keys sayls8@proton.me\nDelete this key from the keyring? (y/N) y\nThis is a secret key! - really delete? (y/N) y\n# reimport the subkeys\ngpg --import secret_subkeys.gpg\n# verify everything is in order\ngpg --list-secret-keys\n# remove the subkeys from disk\nrm secret_subkeys.gpg\n</code></pre>\n<p>I recommend also keeping a <code>.gpg</code> version to make it easy to re-import your\nprimary key: <code>gpg --export-secret-keys --armor --output private-key-bak.gpg</code></p>\n<p>Then store <code>secret_key</code> on an encrypted USB drive or somewhere offline. If you\nwant to protect it for now, you can just use the encryption subkey that we\ncreated to encrypt <code>secret_key</code> with a passphrase:</p>\n<pre><code class=\"language-bash\">gpg --list-keys --keyid-format LONG\n</code></pre>\n<p>Copy the KeyID of the subkey with encrypt capabilities for the following\ncommand:</p>\n<pre><code class=\"language-bash\"># Encrypting your secret key for yourself\ngpg --encrypt --recipient Ox37ACA569C5C44787 secret_key\n</code></pre>\n<p>You can check that the secret key material is missing with\n<code>gpg --list-secret-keys</code>, you should see <code>sec#</code> instead of <code>sec</code>.</p>\n<pre><code class=\"language-bash\">gpg --list-secret-keys\n# Output:\nsec#  ed25519/0x\n# ...snip...\n</code></pre>\n<p>The above set of commands are from the\n<a href=\"https://riseup.net/ru/security/message-security/openpgp/gpg-best-practices#keep-your-primary-key-entirely-offline\">RiseUp Keep your primary key offline</a></p>\n</details>\n<hr />\n<h2>Hardening OpenSSH</h2>\n<p>OpenSSH is a tool that allows you to remotely connect to your machine with the\nSSH protocol. It encrypts all traffic to prevent eavesdropping, connection\nhijacking, and other attacks.</p>\n<ul>\n<li>\n<p><a href=\"https://wiki.archlinux.org/title/OpenSSH\">Arch Wiki OpenSSH</a></p>\n</li>\n<li>\n<p><a href=\"https://www.openssh.com/\">OpenSSH</a></p>\n</li>\n</ul>\n<p>Install and configure fail2ban:</p>\n<pre><code class=\"language-bash\">sudo pacman -S fail2ban\n</code></pre>\n<p>Create a <code>/etc/fail2ban/jail.local</code> file:</p>\n<pre><code class=\"language-bash\">[sshd]\nenabled = true\nport = ssh\nfilter = sshd\nlogpath = /var/log/auth.log\nmaxretry = 5\nbantime = 3600  # 1 hour in seconds\nfindtime = 600\nignoreip = 127.0.0.1/8 ::1\nbanaction = iptables-multiport\n</code></pre>\n<p>Start and enable the service:</p>\n<pre><code class=\"language-bash\">sudo systemctl enable fail2ban\nsudo systemctl start fail2ban\n</code></pre>\n<p>Harden OpenSSH settings in <code>/etc/ssh/sshd_config</code>:</p>\n<pre><code class=\"language-bash\">PasswordAuthentication no\nPermitEmptyPasswords no\nPubkeyAuthentication yes\nAuthorizedKeysFile     %h/.ssh/authorized_keys\nUsePAM yes\nPermitTunnel no\nUseDNS no\nKbdInteractiveAuthentication no\nX11Forwarding no  # or yes if you have X server enabled\nMaxAuthTries 3\nMaxSessions 2\nClientAliveInterval 300\nClientAliveCountMax 0\nAllowUsers your-user\nTCPKeepAlive no\nAllowTcpForwarding no\nAllowAgentForwarding no\nLogLevel VERBOSE\nPermitRootLogin no\nKexAlgorithms curve25519-sha256@libssh.org,ecdh-sha2-nistp521,ecdh-sha2-nistp384,ecdh-sha2-nistp256,diffie-hellman-group-exchange-sha256\nCiphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr\nMACs hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com,umac-128-etm@openssh.com,hmac-sha2-512,hmac-sha2-256,umac-128@openssh.com\n</code></pre>\n<p>Enable and start sshd:</p>\n<pre><code class=\"language-bash\">sudo systemctl enable sshd\nsudo systemctl start sshd\n</code></pre>\n<p>Ensure all of the permissions are correct:</p>\n<pre><code class=\"language-bash\">chmod 755 $HOME\nchmod 700 $HOME/.ssh\n</code></pre>\n<p>Add the output of <code>ssh-add -L</code> to <code>~/.ssh/authorized_keys</code></p>\n<pre><code class=\"language-bash\">echo \"ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIGXwhVokJ6cKgodYT+0+0ZrU0sBqMPPRDPJqFxqRtM+I (none)\" &gt; ~/.ssh/authorized_keys\n</code></pre>\n<p>After adding the <code>authorized_key</code>, adjust the permission:</p>\n<pre><code class=\"language-bash\">chmod 600 $HOME/.ssh/authorized_keys\n</code></pre>\n<p>Finally, test an ssh connection:</p>\n<pre><code class=\"language-bash\">ssh user@hostname\n# Example\nssh jr@archlinux\n# Specify the port\nssh -p 22 user@hostname\n</code></pre>\n<hr />\n<h4>Tip Change the Default Port</h4>\n<blockquote>\n<p>‚ö†Ô∏è Critical Warning: Do not close your existing SSH session until you\nsuccessfully connect using the new port. If you make a mistake and get locked\nout, you‚Äôll need console access to your server to fix it</p>\n</blockquote>\n<p>Edit <code>/etc/ssh/sshd_config</code> to add the line:</p>\n<pre><code class=\"language-config\">Port 2222\n</code></pre>\n<p>Update the Firewall Rules in <code>/etc/nftables.conf</code>:</p>\n<p>Replace this line:</p>\n<pre><code class=\"language-conf\">tcp dport ssh accept comment \"allow sshd\"\n</code></pre>\n<p>with:</p>\n<pre><code class=\"language-conf\">tcp dport 2222 accept comment \"allow sshd on port 2222\"\n</code></pre>\n<p>This change explicitly allows new incomming TCP connections on port 2222 for\nSSH, ensuring remote access will work through the firewall.</p>\n<p>Reload the Firewall:</p>\n<pre><code class=\"language-bash\">sudo nft -f /etc/nftables.conf\n</code></pre>\n<p>Restart sshd:</p>\n<pre><code class=\"language-bash\">sudo systemctl restart sshd\n</code></pre>\n<p>Finally, text a connection:</p>\n<pre><code class=\"language-bash\">ssh -p 2222 user@hostname\n</code></pre>\n<hr />\n<h2>USB Port Protection</h2>\n<ul>\n<li><a href=\"https://wiki.archlinux.org/title/USBGuard\">Arch Wiki USBGuard</a></li>\n</ul>\n<p>It‚Äôs important to protect your USB ports to prevent BadUSB attacks, data\nexfiltration, unauthorized device access, malware injection, etc.</p>\n<p>To get a list of your connected USB devices you can use <code>lsusb</code> from the\n<code>usbutils</code> package.</p>\n<pre><code class=\"language-bash\">lsusb\n</code></pre>\n<p>Install usbguard:</p>\n<pre><code class=\"language-bash\">sudo pacman -S usbguard\n# Optionally; paru -S usbguard-notifier fails with bad keys\n# paru -S usbguard-notifier-git\n</code></pre>\n<p>Create a <code>usbguard</code> group and add your user to it:</p>\n<pre><code class=\"language-bash\">sudo groupadd usbguard\nsudo usermod -aG usbguard username\n</code></pre>\n<p>Generate a policy based on your currently attached USB devices with:</p>\n<pre><code class=\"language-bash\">sudo usbguard generate-policy | sudo tee /etc/usbguard/rules.conf\n# Or if everything else fails\n# sudo bash -c \"usbguard generate-policy &gt; /etc/usbguard/rules.conf\"\n</code></pre>\n<pre><code class=\"language-bash\">sudo chmod 600 /etc/usbguard/rules.d/99-policy.conf\n</code></pre>\n<h3>USBGuard Daemon</h3>\n<blockquote>\n<p>‚ùóÔ∏è If practicing zero-trust, you would want to change your default policy to\n<code>apply-policy</code>. This way any device that isn‚Äôt explicitly allowed will be\nblocked. It‚Äôs easy to lock yourself out if done incorrectly.</p>\n</blockquote>\n<p>Edit <code>/etc/usbguard/usbguard-daemon.conf</code> to set the policy to allow devices\nthat are already connected for members of the <code>usbguard</code> group:</p>\n<pre><code class=\"language-conf\"># ...snip...\nRuleFile=/etc/usbguard/rules.conf\n\n# Default policy for devices that were already connected when the daemon started.\n# Supported values: apply-policy, allow, block, reject, keep.\nPresentDevicePolicy=allow\n\n# A list of users and groups that are allowed to interact with the daemon\n# via the IPC interface.\n#IPCAllowedUsers=root your-user\nIPCAllowedUsers=usbguard\n</code></pre>\n<p>From the above file we can see that it expects its configuration file to be\nlocated at <code>/etc/usbguard/rules.d/</code>:</p>\n<pre><code class=\"language-bash\">sudo mkdir -p /etc/usbguard/rules.d\n</code></pre>\n<p>Create a file <code>/etc/usbguard/rules.d/99-policy.conf</code>:</p>\n<pre><code class=\"language-conf\"># allow `only` devices with mass storage interfaces (USB Mass Storage)\nallow with-interface equals { 08:*:* }\n\n# allow mice and keyboards\n# allow with-interface equals { 03:*:* }\n\n# Reject devices with suspicious combination of interfaces\nreject with-interface all-of { 08:*:* 03:00:* }\nreject with-interface all-of { 08:*:* 03:01:* }\nreject with-interface all-of { 08:*:* e0:*:* }\nreject with-interface all-of { 08:*:* 02:*:* }\n</code></pre>\n<p>The above policy can be found in\n<a href=\"https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/7/html/security_guide/sec-using-usbguard\">RedHat UsbGuard</a></p>\n<p>The only allow rule is for devices with only mass storage interfaces (08:<em>:</em>)\ni.e., USB Mass storage devices, devices like keyboards and mice (which use\ninterface class <code>03:*:*</code>) implicitly not allowed.(commented out)</p>\n<p>The reject rules reject devices with a suspicious combination of interfaces. A\nUSB drive that implements a keyboard or a network interface is very suspicious,\nthese reject rules prevent that.</p>\n<p>The <code>presentDevicePolicy = \"allow\"</code> allows any device that is present at daemon\nstart up even if they‚Äôre not explicitly allowed. However, newly plugged in\ndevices must match an allow rule or get denied implicitly.</p>\n<p>Enable/Start <code>usbguard.service</code>:</p>\n<pre><code class=\"language-bash\">sudo systemctl enable usbguard\nsudo systemctl start usbguard --now\n</code></pre>\n<ul>\n<li>Sometimes a reboot is required. If your keyboard doesn‚Äôt work, after entering\nyour encryption passphrase, enter the TTY with <code>Alt+Ctrl+F2</code> and ensure the\n<code>usbguard</code> group exists and your user is a member.</li>\n</ul>\n<p>Check status:</p>\n<pre><code class=\"language-bash\">sudo systemctl status usbguard\n</code></pre>\n<pre><code class=\"language-bash\">sudo usbguard list-devices\n</code></pre>\n<ul>\n<li>\n<p>If you plug something new in and it doesn‚Äôt work, this is why. Remember this!</p>\n</li>\n<li>\n<p><a href=\"https://docs.kernel.org/usb/authorization.html\">Authorizing (or not) USB devices</a></p>\n</li>\n</ul>\n<hr />\n<h3>Firejail</h3>\n<blockquote>\n<p>‚ùóÔ∏è Critics such as madaidan say that Firejail worsens security by acting as a\nprivilege escalation hole. Firejail requires the executable to be setuid,\nmeaning it runs with root privileges. Experienced users are encouraged to use\nbubblewrap for it‚Äôs minimal design and specificity of its purpose.</p>\n</blockquote>\n<p>A <strong>setuid binary</strong> is an executable file with a special permission bit set\ncalled ‚Äúset user ID‚Äù (setuid). When a user runs a setuid binary, the program\nexecutes with the permissions of the binary‚Äôs owner, rather than the permissions\nof the user running it.</p>\n<p>There are mitigations for the above risks I will share further down.</p>\n<p>Another option here is <a href=\"https://wiki.archlinux.org/title/Bubblewrap\">Bubblewrap</a></p>\n<ul>\n<li>\n<p><a href=\"https://wiki.archlinux.org/title/Firejail\">Arch Wiki Firejail</a></p>\n</li>\n<li>\n<p><a href=\"https://madaidans-insecurities.github.io/linux.html#firejail\">Firejail weaknesses</a></p>\n</li>\n</ul>\n<pre><code class=\"language-bash\">sudo pacman -S firejail\n</code></pre>\n<p>Usage:</p>\n<pre><code class=\"language-bash\">firejail librewolf\n</code></pre>\n<p>Using by default:</p>\n<pre><code class=\"language-bash\">sudo firecfg\n</code></pre>\n<p>fix <code>.desktop</code> files with:</p>\n<pre><code class=\"language-bash\">firecfg --fix\n</code></pre>\n<p>This creates symbolic links in <code>/usr/local/bin/</code> pointing to <code>/usr/bin/firejail</code>\nfor programs for which Firejail has default or self-created profiles.</p>\n<p>You can inspect <code>/etc/firejail/</code> to see all the pre-baked profiles available.</p>\n<h2>Hardening Firejail</h2>\n<p>Add the following line to <code>/etc/firejail/firejail.config</code>:</p>\n<pre><code class=\"language-config\">force-nonewprivs yes\n</code></pre>\n<ul>\n<li>The above setting prevents Firejail and its child processes from gaining new\nprivileges after the sandbox is started.\n<ul>\n<li>Changing the owner and group to <code>root:firejail</code> and permissions to <code>4750</code>\nmeans Firejail runs with setuid root but only allows execution by users in\nthe firejail group reducing the attack surface.</li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<p>‚ùóÔ∏è This breaks some apps such as VirtualBox which I don‚Äôt recommend and if\nusing the hardened kernel, Wireshark and Chromium-based browsers are also\naffected.</p>\n</blockquote>\n<ul>\n<li><a href=\"https://www.whonix.org/wiki/KVM#Why_Use_KVM_Over_VirtualBox?\">Why Use KVM over VirtualBox</a></li>\n</ul>\n<p>Add a pacman hook to automatically change firejail owner and mode. Create\n<code>/etc/pacman.d/hooks/firejail-permissions.hook</code> and place the following in it:</p>\n<pre><code class=\"language-hook\">[Trigger]\nOperation = Install\nOperation = Upgrade\nType = Package\nTarget = firejail\n[Action]\nDepends = coreutils\nDepends = bash\nWhen = PostTransaction\nExec = /usr/bin/sh -c \"chown root:firejail /usr/bin/firejail &amp;&amp; chmod 4750 /usr/bin/firejail\"\nDescription = Setting /usr/bin/firejail owner to \"root:firejail\" and mode \"4750\"\n</code></pre>\n<p>Create a <code>firejail</code> group:</p>\n<pre><code class=\"language-bash\">sudo groupadd firejail\n</code></pre>\n<p>and add your user to it:</p>\n<pre><code class=\"language-bash\">sudo gpasswd -a $USER firejail\n</code></pre>\n<p><strong>Verify Firejail‚Äôs being used</strong>:</p>\n<p>Launch the program that you want to ensure is running sandboxed and run:</p>\n<pre><code class=\"language-bash\">firejail --list\n# or more comprehensive\nfirejail --tree\n</code></pre>\n<p><strong>Enable AppArmor support</strong>:</p>\n<pre><code class=\"language-bash\">sudo apparmor_parser -r /etc/apparmor.d/firejail-default\n</code></pre>\n<p>With firejail running, I noticed that none of my browsers would allow me to\ndownload anything. A fix for this is to run:</p>\n<pre><code class=\"language-bash\">sudo firejail --noprofile firefox\n</code></pre>\n<p>Download your file, close firefox and run again in the firejail sandbox.</p>\n<blockquote>\n<p>Tip from Arch Wiki <code>/etc/pacman.d/hooks/firejail.hook</code></p>\n<p>For cases where you need to manually modify the <code>Exec=</code> line of the .desktop\nfile in <code>~/.local/share/applications</code> to explicitly call Firejail.</p>\n<pre><code class=\"language-hook\"> [Trigger]\n Type = Path\n Operation = Install\n Operation = Upgrade\n Operation = Remove\n Target = usr/bin/*\n Target = usr/share/applications/*.desktop\n\n [Action]\n Description = Configure symlinks in /usr/local/bin based on firecfg.config...\n When = PostTransaction\n Depends = firejail\n Exec = /bin/sh -c 'firecfg &gt;/dev/null 2&gt;&amp;1'\n</code></pre>\n</blockquote>\n<p>To manually map individual applications, execute:</p>\n<pre><code class=\"language-bash\">sudo ln -s /usr/bin/firejail /usr/local/bin/application-to-sandbox\n</code></pre>\n<h3>Remove Firejail symlinks</h3>\n<pre><code class=\"language-bash\">sudo firecfg --clean\n</code></pre>\n<p>If you would rather confine an app with AppArmor or Bubblewrap:</p>\n<pre><code class=\"language-bash\">sudo rm /usr/local/bin/application\n</code></pre>\n<p>Also, comment out <code>application</code> in the <code>/etc/firejail/firecfg.config</code> to prevent\nit from being added if you run <code>firecfg</code> again.</p>\n<details>\n<summary> ‚úîÔ∏è Click to Expand Firejail Resources </summary>\n<ul>\n<li>\n<p><a href=\"https://wiki.archlinux.org/title/Firejail\">Arch Wiki Firejail</a></p>\n</li>\n<li>\n<p><a href=\"https://github.com/netblue30/firejail/issues/2507\">Profiles not in firecfg</a></p>\n</li>\n<li>\n<p><a href=\"https://firejail.wordpress.com/documentation-2/\">Firejail Docs</a></p>\n</li>\n<li>\n<p><a href=\"https://github.com/netblue30/firejail/wiki/Debugging-Firejail\">Debugging Firejail</a></p>\n</li>\n<li>\n<p><a href=\"https://debugging.works/blog/debugging-firejail/\">How to debug a firejail sandbox</a></p>\n</li>\n</ul>\n</details>\n<hr />\n<h2>AppArmor</h2>\n<p><a href=\"https://apparmor.net/\">AppArmor</a> is a\n<a href=\"https://wiki.archlinux.org/title/Mandatory_Access_Control\">Mandatory Access Control</a>\n(MAC) system, implemented upon the\n<a href=\"https://en.wikipedia.org/wiki/Linux_Security_Modules\">Linux Security Modules</a>(LSM)\n‚Äì Arch Wiki</p>\n<p>MAC systems generally block all access by default, only permitting actions that\nare explicitly defined as allowed in their security policy or access profiles.</p>\n<p>This is why, if you read about creating your own policy that they recommend\nsetting AppArmor to complain mode while you use said app using all functionality\nand APIs you can think of before setting to enforce. Within a policy everything\nis default-deny so any action not covered in the above steps will be blocked by\ndefault.</p>\n<blockquote>\n<p>‚ùóÔ∏è The AppArmor policy con only be considered default deny if it is deployed\nas a complete system policy which we don‚Äôt do here. The apps and parts of the\nsystem that don‚Äôt have pre-defined policies aren‚Äôt covered by AppArmor so are\ntherefore default allow. You can get there in time but it‚Äôs beyond the scope\nof this section.</p>\n</blockquote>\n<p>Install:</p>\n<pre><code class=\"language-bash\">sudo pacman -S apparmor\n</code></pre>\n<p>Edit <code>/etc/cmdline.d/security.conf</code>:</p>\n<pre><code class=\"language-conf\"># enable apparmor\nlsm=landlock,lockdown,yama,integrity,apparmor,bpf audit=1 audit_backlog_limit=256\n</code></pre>\n<p>Save &amp; Reboot</p>\n<p>Start/Enable AppArmor:</p>\n<pre><code class=\"language-bash\">sudo systemctl enable apparmor\nsudo systemctl start apparmor\n</code></pre>\n<p>Ensure the LSM is loaded with:</p>\n<pre><code class=\"language-bash\">zgrep CONFIG_LSM=/proc/config.gz\n# &amp;\ncat /sys/kernel/security/lsm\n</code></pre>\n<p>Reboot, and run <code>sudo aa-enabled</code>, and <code>sudo aa-status</code>. You should see many\nprofiles in enforce mode.</p>\n<h3>Switching an app from unconfined mode to enforce</h3>\n<ul>\n<li>First, ensure a profile exists</li>\n</ul>\n<p>Check AppArmor log messages:</p>\n<p>Each time AppArmor denies applications from doing something potentially harmful\nthe event is logged.</p>\n<pre><code class=\"language-bash\">sudo journalctl -fx\n</code></pre>\n<p>NOTE: Your firewall can also trigger this.</p>\n<h3>Disabling AppArmor</h3>\n<p>Disable AppArmor by unloading all profiles for the current session:</p>\n<pre><code class=\"language-bash\">sudo aa-teardown\n</code></pre>\n<p>Further reading:</p>\n<ul>\n<li>\n<p><a href=\"https://apparmor.net/\">AppArmor Quick Intro</a></p>\n</li>\n<li>\n<p><a href=\"https://gitlab.com/apparmor/apparmor/-/wikis/home\">AppArmor Wiki</a></p>\n</li>\n<li>\n<p><a href=\"https://wiki.archlinux.org/title/AppArmor\">Arch Wiki AppArmor</a></p>\n</li>\n</ul>\n<h2>Creating or adding profiles that aren‚Äôt pre-configured</h2>\n<p>For example, thunderbird came with a profile that just allowed everything.\nRather than creating my own profile I cloned the <code>apparmor-profiles</code> repo and\ngot it from there.</p>\n<pre><code class=\"language-bash\">mkdir aa &amp;&amp; cd aa\ngit clone git://git.launchpad.net/apparmor-profiles\n</code></pre>\n<pre><code class=\"language-bash\">sudo cp ~/aa/apparmor-profiles/thunderbird /etc/apparmor.d/usr.bin.thunderbird\n</code></pre>\n<p>Create a local override file, this is where you will make your personal changes\nto existing profiles:</p>\n<pre><code class=\"language-bash\">sudo mkdir -p /etc/apparmor.d/local\nsudo touch /etc/apparmor.d/local/usr.bin.thunderbird\n</code></pre>\n<p>Set the new profile to enforce mode:</p>\n<pre><code class=\"language-bash\">sudo aa-enforce /etc/apparmor.d/usr.bin.thunderbird\n</code></pre>\n<hr />\n<p><strong>Creating a new profile</strong></p>\n<ul>\n<li><a href=\"https://gitlab.com/apparmor/apparmor/-/wikis/Profiling_with_tools\">Profiling_with_tools</a></li>\n</ul>\n<ol>\n<li>Temporarily disable kernel rate limiting on logs:</li>\n</ol>\n<pre><code class=\"language-bash\">sudo sysctl -w kernel.printk_ratelimit=0\n</code></pre>\n<ol start=\"2\">\n<li>Start <code>aa-genprof</code>:</li>\n</ol>\n<pre><code class=\"language-bash\">sudo aa-genprof &lt;path-to-executable&gt;\n# Example\nsudo aa-genprof /usr/bin/brave\n</code></pre>\n<ol start=\"3\">\n<li>Execute a test plan, open and close brave, download a file through brave,\nadjust settings, do anything you can think of with brave.</li>\n</ol>\n<ul>\n<li>\n<p>Press S to Scan system log for AppArmor events</p>\n</li>\n<li>\n<p>Press F to Finish</p>\n</li>\n</ul>\n<p>This simple example created this profile in <code>/etc/apparmor.d/usr.bin.brave</code>:</p>\n<pre><code class=\"language-text\"># Last Modified: Wed Oct  8 09:29:51 2025\nabi &lt;abi/4.0&gt;,\n\ninclude &lt;tunables/global&gt;\n\n/usr/bin/brave flags=(complain) {\n  include &lt;abstractions/base&gt;\n\n  /usr/bin/brave r,\n  /usr/bin/env ix,\n\n}\n</code></pre>\n<h3>Profiling by Hand</h3>\n<p>Disable kernel rate limiting:</p>\n<pre><code class=\"language-bash\">sysctl -w kernel.printk_ratelimit=0\n</code></pre>\n<p>Lets pick up from our /usr/bin/brave example:</p>\n<p>Create a preliminary profile</p>\n<pre><code class=\"language-text\"># Last Modified: Wed Oct  8 09:29:51 2025\nabi &lt;abi/4.0&gt;,\n\ninclude &lt;tunables/global&gt;\n\n/usr/bin/brave flags=(complain) {\n  include &lt;abstractions/base&gt;\n\n  /usr/bin/brave r,\n  /usr/bin/env ix,\n\n}\n\n</code></pre>\n<h3>Auditd</h3>\n<p>Linux audit makes your system more secure by providing you the means to analyze\nwhat‚Äôs going on in your system in great detail. It does not provide any security\nitself, but instead is useful for tracking these issues and helps you take\nadditional security measures to prevent them.</p>\n<p>Install with:</p>\n<pre><code class=\"language-bash\">sudo pacman -S audit\n</code></pre>\n<ul>\n<li>Enable audit at boot-time by setting <code>audit=1</code> as a kernel parameter,\ntypically either in <code>/etc/kernel/cmdline</code> or <code>/etc/cmdline.d/security.conf</code>\nfor UKIs.</li>\n</ul>\n<p>For example, this is my <code>/etc/cmdline.d/security.conf</code>:</p>\n<pre><code class=\"language-conf\"># enable apparmor                               # enable audit\nlsm=landlock,lockdown,yama,integrity,apparmor,bpf audit=1 audit_backlog_limit=256\n</code></pre>\n<p>Create a group to follow principle of least privilege:</p>\n<pre><code class=\"language-bash\">sudo groupadd audit-view\nsudo usermod -a -G audit-view $USER\n</code></pre>\n<p>In <code>/etc/audit/auditd.conf</code>, change <code>log_group = root</code> to:</p>\n<pre><code class=\"language-conf\">log_group = audit-view\n</code></pre>\n<p>Enable:</p>\n<pre><code class=\"language-bash\">sudo systemctl enable auditd\nsudo systemctl start auditd --now\n</code></pre>\n<p>To create new profiles, <code>auditd</code> should be running. AppArmor can use kernel\naudit logs from the userspace auditd daemon, allowing you to build new profiles.</p>\n<ul>\n<li>\n<p><a href=\"https://wiki.archlinux.org/title/Audit_framework\">Audit Framework</a></p>\n</li>\n<li>\n<p><a href=\"https://man.archlinux.org/man/auditd.8.en\">Arch manpage auditd</a></p>\n</li>\n</ul>\n<p>A basic set of rules could be to create a <code>/etc/audit/rules.d/audit.rules</code> with\nthe following contents:</p>\n<pre><code class=\"language-audit.rules\"># Clear existing rules\n-D\n\n# Set buffer size\n-b 8192\n\n# Monitor /etc/passwd for modifications\n-w /etc/passwd -p wa -k passwd_changes\n\n# Monitor sudo command execution\n-w /usr/bin/sudo -p x -k sudo_usage\n\n# Enable auditing\n-e 1\n\n# Make rules immutable\n-e 2\n</code></pre>\n<p>Validate and load the rules, this will populate <code>/etc/audit/audit.rules</code> with\nthe rules we just set:</p>\n<pre><code class=\"language-bash\">sudo augenrules --load\n</code></pre>\n<p>Ensure <code>auditd</code> is running:</p>\n<pre><code class=\"language-bash\">sudo systemctl status auditd\n</code></pre>\n<p>Since we set a watch rule for sudo let‚Äôs run an update and check the auditd\nlogs:</p>\n<pre><code class=\"language-bash\">sudo pacman -Syu\n</code></pre>\n<p>View the logs:</p>\n<pre><code class=\"language-bash\">sudo ausearch -k sudo_usage\n</code></pre>\n<p>View the Summary Report:</p>\n<pre><code class=\"language-bash\">sudo aureport\nsudo aureport --auth\nman aureport\n</code></pre>\n<p>Verify the rules are loaded:</p>\n<pre><code class=\"language-bash\">sudo auditctl -l\n</code></pre>\n<p>Be careful here, if you enable <code>auditd</code> and don‚Äôt iron out the kinks I‚Äôve found\nthat it freezes after you enter your cryptroot passphrase. If this happens to\nyou, follow the chroot steps but skip the <code>arch-chroot /mnt</code> step and instead\nrun:</p>\n<pre><code class=\"language-bash\">systemctl --root=/mnt disable auditd\n</code></pre>\n<p>Unmount the partitions, close cryptroot, and Reboot.</p>\n<hr />\n<h3>Doas over sudo</h3>\n<blockquote>\n<p>‚ùóÔ∏è Removing sudo may cause compatibility issues with some scripts/tools that\nexpect it, I haven‚Äôt had many issues but you should test before completely\nremoving it.</p>\n</blockquote>\n<p>For a more minimalist version of <code>sudo</code> with a smaller codebase and attack\nsurface, consider <code>doas</code>:</p>\n<pre><code class=\"language-bash\">sudo pacman -S opendoas\n</code></pre>\n<p>Create a <code>doas</code> group:</p>\n<pre><code class=\"language-bash\">sudo groupadd doas\n</code></pre>\n<p>Add your user to the <code>doas</code> group:</p>\n<pre><code class=\"language-bash\">sudo usermod -aG doas $USER\n</code></pre>\n<p>Create <code>/etc/doas.conf</code> with the following contents:</p>\n<pre><code class=\"language-conf\">permit setenv {PATH=/usr/local/bin:/usr/local/sbin:/usr/bin:/usr/sbin} :doas\n</code></pre>\n<p>You can add a line below that one like <code>permit nopass your-username as root:</code>\nEnabling your user passwordless usage, it‚Äôs much less secure but an option.</p>\n<p>Alternatively, you can setup the doas persist feature with the following:</p>\n<pre><code class=\"language-conf\">permit persist setenv {PATH=/usr/local/bin:/usr/local/sbin:/usr/bin:/usr/sbin} :doas\n</code></pre>\n<ul>\n<li>\n<p>With the above setting, after you successfully authenticate. You won‚Äôt be\nasked for your password for the next 5 minutes. It‚Äôs disabled by default\nbecause it can be dangerous if used in the wrong environment.</p>\n</li>\n<li>\n<p>You may need to either reboot or do a soft-reset for the groups to take\neffect.</p>\n</li>\n</ul>\n<p>For <code>yay</code>, you can run:</p>\n<pre><code class=\"language-bash\">yay --sudo doas --save\n</code></pre>\n<p>For <code>paru</code>, edit <code>/etc/paru.conf</code>. Near bottom:</p>\n<pre><code class=\"language-conf\">Sudo = doas\n</code></pre>\n<p>Edit <code>/etc/mkepkg.conf</code>:</p>\n<pre><code class=\"language-bash\">doas hx /etc/makepkg.conf\n</code></pre>\n<p>At the bottom of the file uncomment <code>PACMAN_AUTH=()</code> and add <code>doas</code>:</p>\n<pre><code class=\"language-conf\">PACMAN_AUTH=(doas)\n</code></pre>\n<p>Secure the <code>doas.conf</code>:</p>\n<pre><code class=\"language-conf\">doas chown -c root:root /etc/doas.conf\ndoas chmod -c 0400 /etc/doas.conf\n</code></pre>\n<pre><code class=\"language-bash\">doas pacman -Syu\n</code></pre>\n<p>Test and ensure most commands that you use work before removing sudo so you‚Äôre\naware of potential issues. To benefit from the smaller codebase and attack\nsurface, you have to remove sudo.</p>\n<pre><code class=\"language-bash\">doas pacman -R sudo base-devel\n</code></pre>\n<p>Create a symlink replacing sudo with doas:</p>\n<pre><code class=\"language-bash\">ln -s $(which doas) /usr/bin/sudo\n</code></pre>\n<p>Now, when you run <code>sudo</code>, <code>doas</code> will be executed. There are some compatibility\nissues with this method but not super common.</p>\n<h2>Intrusion Detection</h2>\n<details>\n<summary> ‚úîÔ∏è Click to Expand AIDE Example </summary>\n<p>From what I‚Äôve seen, this would work best if you‚Äôre running a server or self\nhosting where your system will be running without you there tweaking settings\nand AIDE will alert you if anything changes in the meantime.</p>\n<pre><code class=\"language-bash\">paru -S aide\n</code></pre>\n<ul>\n<li>\n<p><a href=\"https://aide.github.io/doc/\">AIDE Manual</a></p>\n</li>\n<li>\n<p><a href=\"https://wiki.archlinux.org/title/AIDE\">Arch Wiki AIDE</a></p>\n</li>\n</ul>\n<p>AIDE is an intrusion detection system (IDS) that will notify us whenever it\ndetects that a potential intrusion has occurred. When a system is compromised,\nattackers typically will try to change file permissions and escalate to the root\nuser account and start to modify system files, AIDE can detect this.</p>\n<p>To set up AIDE on your system follow these steps:</p>\n<ol>\n<li>\n<p>There is a default config at <code>/etc/aide.conf</code>:</p>\n</li>\n<li>\n<p>Initialize the database:</p>\n</li>\n</ol>\n<pre><code class=\"language-bash\">sudo aide -i\n</code></pre>\n<p>You will see in the output of the above command that\n<code>AIDE successfully initialized database. New AIDE database written to /var/lib/aide/aide.db.new.gz</code></p>\n<ol start=\"3\">\n<li>Move the new database and remove the <code>.new</code>:</li>\n</ol>\n<pre><code class=\"language-bash\">sudo mv /var/lib/aide/aide.db.new.gz /var/lib/aide/aide.db.gz\n</code></pre>\n<ol start=\"4\">\n<li>Check the system against the baseline database:</li>\n</ol>\n<pre><code class=\"language-bash\">sudo aide -C\n</code></pre>\n<ol start=\"5\">\n<li>Whenever you make changes to system files, or especially after running a\nsystem update or installing new tools, you have to rescan all files to update\ntheir checksums in the AIDE database:</li>\n</ol>\n<pre><code class=\"language-bash\">sudo aide -u\n</code></pre>\n<p>Unfortunately, AIDE doesn‚Äôt automatically replace the old database so you have\nto rename the new one again:</p>\n<pre><code class=\"language-bash\">sudo mv /var/lib/aide/aide.db.new.gz /var/lib/aide/aide.db.gz\n</code></pre>\n<p>And finally check again:</p>\n<pre><code class=\"language-bash\">sudo aide -C\nStart timestamp: 2025-10-02 14:57:49 -0400 (AIDE 0.19.2)\nAIDE found NO differences between database and filesystem. Looks okay!!\n</code></pre>\n<ul>\n<li>\n<p>The default settings are fairly strict, I kept getting reports of changes\ndetected because the mtime and ctime of a directory changed. It‚Äôs fairly easy\nto set ignore rules by adding a <code>!</code> in front of the path.</p>\n</li>\n<li>\n<p><a href=\"https://linux.die.net/man/1/aide\">aide(1) man page</a></p>\n</li>\n</ul>\n<p>Create the logfile:</p>\n<pre><code class=\"language-bash\">sudo mkdir -p /var/log/aide\nsudo touch /var/log/aide/aide.log\n</code></pre>\n</details>\n<h3>Resources</h3>\n<details>\n<summary> ‚úîÔ∏è Click to Expand Resources </summary>\n<ul>\n<li>\n<p><a href=\"https://wiki.archlinux.org/title/Unified_Extensible_Firmware_Interface/Secure_Boot\">Arch Wiki Secure Boot</a></p>\n</li>\n<li>\n<p><a href=\"https://wiki.archlinux.org/title/OpenVAS\">Arch Wiki OpenVAS</a></p>\n</li>\n<li>\n<p><a href=\"https://wiki.archlinux.org/title/AppArmor\">Arch Wiki AppArmor</a></p>\n</li>\n<li>\n<p><a href=\"https://wiki.archlinux.org/title/SELinux\">Arch Wiki SELinux</a></p>\n</li>\n<li>\n<p><a href=\"https://wiki.archlinux.org/title/Security\">Arch Wiki Security</a></p>\n</li>\n<li>\n<p><a href=\"https://github.com/archlinuxhardened/selinux\">archlinuxhardened/selinux</a></p>\n</li>\n<li>\n<p><a href=\"https://wiki.gentoo.org/wiki/Security_Handbook/Concepts\">Gentoo Security_Handbook Concepts</a></p>\n</li>\n<li>\n<p>STIGs are configuration standards developed by the Defense Information Systems\nAgency (DISA) to secure systems and software for the U.S. Department of\nDefense (DoD). They are considered a highly authoritative source for system\nhardening.There are recommendations for hardening all kinds of software in the\n<a href=\"https://stigviewer.com/stigs\">Stig Viewer</a></p>\n</li>\n<li>\n<p><a href=\"https://www.cisecurity.org/cis-benchmarks\">CIS Benchmarks</a></p>\n</li>\n<li>\n<p><a href=\"https://github.com/nsacyber\">NSA Cybersecurity Directorate</a></p>\n</li>\n<li>\n<p><a href=\"https://www.rodsbooks.com/efi-bootloaders/secureboot.html\">rodsbooks Secure Boot</a></p>\n</li>\n<li>\n<p><a href=\"https://web.archive.org/web/20140422190914/https://securityinabox.org/en/truecrypt_main\">TrueCrypt Guide</a></p>\n</li>\n<li>\n<p><a href=\"https://web.archive.org/web/20140220055801/http://crunchbang.org:80/forums/viewtopic.php?id=24722\">#! Paranoid Security Guide</a></p>\n</li>\n<li>\n<p><a href=\"https://cybersecuritynews.com/hardening-linux-servers\">Hardening-Linux-Servers</a></p>\n</li>\n<li>\n<p><a href=\"https://linux-audit.com/linux-server-hardening-most-important-steps-to-secure-systems/\">linux-audit Linux Server hardening best practices</a></p>\n</li>\n<li>\n<p><a href=\"https://linux-audit.com/linux-security-guide-extended-version/\">linux-audit Linux security guide extended</a></p>\n</li>\n<li>\n<p><a href=\"https://madaidans-insecurities.github.io/linux.html\">madaidans-insecurities</a></p>\n</li>\n<li>\n<p><a href=\"https://madaidans-insecurities.github.io/guides/linux-hardening.html\">madaidans-insecurities Linux Hardening Guide</a></p>\n</li>\n<li>\n<p><a href=\"https://zebracrossing.narwhalacademy.org/\">Zebra Crossing digital safety checklist</a></p>\n</li>\n<li>\n<p><a href=\"https://datadetoxkit.org/en/privacy/essentials#step-1\">DataDetoxKit</a></p>\n</li>\n<li>\n<p><a href=\"https://datadetoxkit.org/en/privacy/degooglise/\">DataDetox Degooglise</a></p>\n</li>\n<li>\n<p><a href=\"https://tb-manual.torproject.org/\">Tor Browser User Manual</a></p>\n</li>\n<li>\n<p><a href=\"https://gitlab.torproject.org/tpo/team/-/wikis/home\">Tor Wiki</a></p>\n</li>\n<li>\n<p><a href=\"https://onionshare.org/\">VeraCrypt Beginners Tutorial</a></p>\n</li>\n</ul>\n</details>\n",
      "date_published": "2025-11-28T00:00:00+00:00",
      "author": {
        "name": "saylesss88"
      }
    }
  ]
}